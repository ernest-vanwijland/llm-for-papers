\documentclass[a4paper,UKenglish,cleveref,hyperref,autoref]{lipics-v2021}





\bibliographystyle{plainurl}

\title{Mim-Width is paraNP-complete}
\titlerunning{Mim-Width is paraNP-complete}



\author{Benjamin Bergougnoux}{LIS, Aix-Marseille Université, France \and \url{https://benjaminbergougnoux.github.io/}}{benjamin.bergougnoux@gmail.com}{https://orcid.org/0000-0002-6270-3663}{}
\author{\'{E}douard Bonnet}{CNRS, ENS de Lyon, Universit\'e Claude Bernard Lyon 1, LIP UMR 5668, Lyon, France \and \url{http://perso.ens-lyon.fr/edouard.bonnet}}{edouard.bonnet@ens-lyon.fr}{https://orcid.org/0000-0002-1653-5822}{}
\author{Julien Duron}{ENS de Lyon, Universit\'e Claude Bernard Lyon 1, LIP UMR 5668, Lyon, France \and \url{http://perso.ens-lyon.fr/julien.duron}}{julien.duron@ens-lyon.fr}{https://orcid.org/0009-0004-0925-9438}{}



\authorrunning{B. Bergougnoux, \'E. Bonnet, and J. Duron}

\Copyright{Benjamin Bergougnoux, Édouard Bonnet, and Julien Duron}





\category{}

\relatedversion{}

\supplement{}

\funding{}

\acknowledgements{}

\nolinenumbers 

\hideLIPIcs  

\EventEditors{John Q. Open and Joan R. Access}
\EventNoEds{2}
\EventLongTitle{42nd Conference on Very Important Topics (CVIT 2016)}
\EventShortTitle{CVIT 2016}
\EventAcronym{CVIT}
\EventYear{2016}
\EventDate{December 24--27, 2016}
\EventLocation{Little Whinging, United Kingdom}
\EventLogo{}
\SeriesVolume{42}
\ArticleNo{23}

\usepackage[utf8]{inputenc}  

\usepackage[T1]{fontenc}
\usepackage{lmodern}
\usepackage[colorinlistoftodos,bordercolor=orange,backgroundcolor=orange!20,linecolor=orange,textsize=normalsize]{todonotes}
\usepackage{amsmath}  
\usepackage{amssymb}
\usepackage{bbm}
\usepackage{accents}
\usepackage{complexity}
\usepackage{booktabs}
\usepackage{bm}
\usepackage{paralist}
\usepackage{fixmath}
\usepackage{tcolorbox}

\makeatletter
\newtheorem*{rep@theorem}{\rep@title}
\newcommand{\newreptheorem}[2]{\newenvironment{rep#1}[1]{\def\rep@title{#2 \ref{##1}}\begin{rep@theorem}}{\end{rep@theorem}}}
\makeatother

\newreptheorem{theorem}{Theorem}
\newreptheorem{lemma}{Lemma}

\usepackage{xspace}
\usepackage{tikz}
\usepackage[ruled,vlined,linesnumbered]{algorithm2e}

\usetikzlibrary{fit}
\usetikzlibrary{arrows}
\usetikzlibrary{patterns}
\usetikzlibrary{calc}
\usetikzlibrary{shapes}
\usetikzlibrary{positioning}
\usetikzlibrary{math}
\usetikzlibrary{shapes.symbols}
\usetikzlibrary{decorations.pathreplacing,calligraphy}
\usetikzlibrary{arrows.meta}
\usetikzlibrary{shapes.geometric}
\usepackage[scr=boondox,scrscaled=1.05]{mathalfa}

\newcommand{\mis}{\textsc{Max Independent Set}\xspace}
\newcommand{\smis}{\textsc{MIS}\xspace}

\renewcommand{\geq}{\geqslant}
\renewcommand{\leq}{\leqslant}
\renewcommand{\preceq}{\preccurlyeq}
\renewcommand{\succeq}{\succcurlyeq}
\renewcommand{\le}{\leq}
\renewcommand{\ge}{\geq}
\newcommand{\Nn}{\mathbb{N}}

\newcommand{\Aux}{\text{Aux}}

\newcommand{\defparproblem}[
4]{
  \vspace{1mm}
  \begin{tcolorbox}[
    colframe=black,        colback=white,         boxrule=0.5pt,         arc=4pt,               left=6pt, right=6pt,   top=6pt, bottom=6pt    ]
    \begin{tabular*}{\textwidth}{@{\extracolsep{\fill}}lr}
      #1 & {\bf{Parameter:}} #3 \\
    \end{tabular*} \\
    {\bf{Input:}} #2 \\
    {\bf{Question:}} #4
  \end{tcolorbox}
  \vspace{1mm}
}

\newcommand{\paraNP}{\ensuremath{\mathrm{paraNP}}}

\newcommand{\arxiv}[1]{\href{http://arxiv.org/abs/#1}{arXiv:#1}}

\newcommand{\card}[1]{|{#1}|}

\DeclareMathOperator*{\bigland}{\bigwedge}
\DeclareMathOperator*{\biglor}{\bigvee}

\newtheorem{question}{Question}

\newenvironment{proofofclaim}{\noindent \textsc{Proof:}}{\hfill$\Diamond$\medskip}

\newcommand\abs[1]{\lvert #1\rvert}
\newcommand\spn[1]{\langle #1 \rangle}

\newcommand\subd[1]{#1\text{-subd}}
\newcommand\dig{D_{\prec}}
\newcommand\tw{\text{tw}}
\newcommand\bn{\text{bn}}

\newcommand{\mim}{\text{mim}}
\newcommand{\ssim}{\text{sim}}
\newcommand{\omim}{\text{omim}}
\newcommand{\lmim}{\text{lmim}}

\newcommand{\mimw}{\text{mimw}}
\newcommand{\lmimw}{\text{lmimw}}
\newcommand{\omimw}{\text{omimw}}
\newcommand{\lomimw}{\text{lomimw}}
\newcommand{\simw}{\text{simw}}
\newcommand{\lsimw}{\text{lsimw}}
\newcommand{\weight}{\omega}

\newcommand{\ldb}{\textsc{Linear Degree Balancing}\xspace}
\newcommand{\tdb}{\textsc{Tree Degree Balancing}\xspace}
\newcommand{\tmb}{\textsc{Tree Mim-Balancing}\xspace}
\newcommand{\tsb}{\textsc{Tree Sim-Balancing}\xspace}
\newcommand{\lmb}{\textsc{Linear Mim-Balancing}\xspace}
\newcommand{\lsb}{\textsc{Linear Sim-Balancing}\xspace}

\newcommand{\tmap}{tree mapping\xspace}
\newcommand{\tmaps}{tree mappings\xspace}
\newcommand{\pmap}{path mapping\xspace}
\newcommand{\pmaps}{paths mappings\xspace}
\newcommand{\htree}{hybrid tree\xspace}
\newcommand{\htrees}{hybrid trees\xspace}



\newenvironment{edouard}[1]{\textcolor{blue}{É:~#1}}{}
\newenvironment{julien}[1]{\textcolor{purple}{J:~#1}}{}
\newenvironment{benjamin}[1]{\textcolor{red}{B:~#1}}{}
 
\begin{document}

\maketitle

\begin{abstract}
  We show that it is \NP-hard to distinguish graphs of linear mim-width at~most 1211 from graphs of~sim-width at~least 1216.
  This implies that \textsc{Mim-Width}, \textsc{Sim-Width}, \textsc{One-Sided Mim-Width}, and their linear counterparts are all \paraNP-complete, i.e., \NP-complete to compute even when upper bounded by a~constant.
  A key intermediate problem that we introduce and show \NP-complete, \textsc{Linear Degree Balancing}, inputs an edge-weighted graph $G$ and an integer~$\tau$, and asks whether $V(G)$ can be linearly ordered such that every vertex of $G$ has weighted \emph{backward} and \emph{forward} degrees at~most~$\tau$.
\end{abstract}

\section{Introduction}\label{sec:intro}

While it was shown shortly after the inception of these parameters by Vatshelle in 2012~\cite{Vatshelle12,BelmonteV13} that \textsc{Mim-Width} and \textsc{Linear Mim-Width} are W[1]-hard~\cite{SaetherV15,SaetherV16}, whether a~slice-wise polynomial (XP) algorithm\footnote{i.e., for any fixed integer $k$, a~polynomial-time algorithm (whose exponent may depend on~$k$) that decides if the (linear) mim-width of the input graph is at~most~$k$.} can compute (or approximate) the (linear) mim-width of an input graph has been raised as an open question repeatedly over the past twelve years~\cite{Vatshelle12,SaetherV16,JaffkeKT20,JaffkeKST19,BergougnouxPT22,BergougnouxKR23,OtachiST24,BergougnouxDJ23}.
We give a~negative answer to this question (at least for some too-good approximation factor), and similarly settle the parameterized complexity of the related sim-width and one-sided mim-width parameters, as well as their linear variants.
Indeed we show that all these parameters are \paraNP-complete to compute, i.e., \NP-complete even when guaranteed to be upper bounded by a~universal constant.

\begin{theorem}\label{thm:main-csq}
  \textsc{Mim-Width}, \textsc{Sim-Width}, \textsc{One-Sided Mim-Width}, \textsc{Linear Mim-Width}, \textsc{Linear Sim-Width}, and \textsc{Linear One-Sided Mim-Width} are \paraNP-complete.
\end{theorem}

We show~\cref{thm:main-csq} with a~single reduction.

\begin{theorem}\label{thm:main}
  There is a~polynomial-time algorithm that takes an input $\varphi$ of \textsc{4-Occ Not-All-Equal 3-Sat} and builds a~graph $G^*$ such that
  \begin{compactitem}
    \item if $\varphi$ is satisfiable, then $G^*$ has linear mim-width at~most~1211,
    \item if $\varphi$ is unsatisfiable, then $G^*$ has sim-width at~least~1216.
  \end{compactitem}
\end{theorem}

\Cref{thm:main} indeed implies~\cref{thm:main-csq} as the linear mim-width upper bounds the other five parameters, while the sim-width lower bounds the other five parameters.
Our reduction is naturally split into three parts, thereby going through two intermediate problems.
The first intermediate problem may be of independent interest (perhaps especially so, its unweighted version), and we were somewhat surprised not to find it already defined in the literature.
We call it \ldb.

\defparproblem{\ldb}{An edge-weighted $n$-vertex graph~$H$ and a~non-negative integer~$\tau$.}{$\tau$}{Is there a~linear ordering $v_1 \prec v_2 \prec \ldots \prec v_n$ of $V(H)$ such that every vertex~$v_i$ has weighted degree in $H[\{v_1, \ldots, v_i\}]$ and in $H[\{v_i, \ldots, v_n\}]$ at~most~$\tau$?}

We call \emph{$\tau$-balancing order} of~$H$ a~linear order over $V(H)$ witnessing that $H$ is a~positive instance of~\ldb.

\medskip

\textbf{The three steps.}
Our reduction starts with a~\textsc{Not-All-Equal 3-Sat} (\textsc{Nae 3-Sat} for short) instance $\varphi$, and goes through an edge-weighted graph $(H, \weight)$, a~vertex-partitioned graph $(G,\mathcal P)$, and finally an instance $G^*$ of \textsc{Mim-Width}.

First we prove that \ldb is \NP-complete even when $\tau$ is a~constant, and every edge weight is a~positive integer.
For our purpose, we in fact show something stronger.
The first step is a~polynomial-time reduction from \textsc{4-Occ Nae 3-Sat} that maps satisfiable formulas to edge-weighted graphs admitting a~$\tau$-balancing order, and unsatisfiable formulas to negative instances of \tdb, a~tree variant of \ldb, for the larger threshold of $\tau + \gamma$, where $\gamma$ can grow linearly in~$\tau$.

In~\tdb, the vertices of~$H$ are bijectively mapped to the nodes of a~freely-chosen tree $T$ such that for every node $t$ of~$T$ and every edge $e$ incident to $t$, the vertex of $H$ mapped to $t$ has weighted degree at~most the given threshold in the cut of~$H$ defined by the two connected components of~$T-e$. 
A~formal definition is given in~\cref{sec:lin-ord-to-trees}.

The second step turns the weighted degree into the maximum (semi-)induced matching at the expense of mapping \emph{subsets} of vertices of $G$ to nodes of~$T$, in a~way that the nodes of~$T$ jointly hold a~prescribed partition $\mathcal P$ of~$V(G)$.
In~\tmb (resp.~\tsb), for every edge~$e$ of~$T$, the size of a~maximum semi-induced (resp.~induced) matching in the cut of $G$ defined by~$e$ shall remain below the threshold.
Their linear variants force $T$ to be a~path.
See~\cref{sec:im-balancing} for formal definitions.

The third step erases the differences between \tmb and \textsc{Mim-Width}, and between their respective variants.
Intuitively speaking:
\begin{compactitem}
\item for each part of~$\mathcal P$, the corresponding vertices of $G^*$ can be gathered in their own subtree,
\item $T$ can be chosen ternary (i.e., every non leaf node has degree~3),
\item only the leaves of~$T$ need hold a~vertex of~$G^*$.
\end{compactitem}

\Cref{fig:roadmap} summarizes these three steps.
\begin{figure}[h!]
  \centering
  \resizebox{\textwidth}{!}{
  \begin{tikzpicture}[arr/.style={thick, -stealth}]
    \def\s{3.5}
    \def\v{0.8}

    \foreach \i/\j/\c in {-0.35/0.35/blue, 0.35/1.36/purple, 1.36/2.6/yellow, 2.6/3.8/orange}{
      \fill[opacity=0.15, color=\c] (\s * \i, -1.3 * \v) -- (\s * \i,2.5 * \v) -- (\s * \j,2.5 * \v) -- (\s * \j, -1.3 * \v) -- cycle ;
    }

    \foreach \i/\p/\x/\sat/\unsat/\inp in {
      1/\textsc{Nae 3-Sat}/0/satisfiable/unsatisfiable/{$\varphi$},
      2/\textsc{Degree Balancing}/0.87/$\tau$-balancing order/no $(\tau+\gamma)$-balancing tree/{$(H, \weight)$},
      3/\textsc{$\bullet$im-Balancing}/1.95/linear mim-balancing $\leqslant \tau+50$/sim-balancing $> \tau + \gamma$/{$(G,\mathcal P)$},
      4/\textsc{$\bullet$im-Width}/3.2/lin. mim-width $\leqslant \frac{46}{45}\tau +107$/sim-width $> \tau+\gamma$/{$G^*$}}
             {
               \node (p\i) at (\s * \x, 2 * \v) {\p} ;
               \node (s\i) at (\s * \x, \v) {\footnotesize{\sat}} ;
               \node (u\i) at (\s * \x, 0) {\footnotesize{\unsat}} ;
               \node (i\i) at (\s * \x, - .8 * \v) {\inp} ;
    }
    \node[draw, rounded corners, fit=(s1) (u1)] (nae) {} ;
    \foreach \i/\p/\q/\l/\m [count = \ip from 2] in {
      1/lem:sat-to-bo/lem:bo-to-sat/0.95/0.18,
      2/lem:balanced2sim-width/lem:simwidth2balanced/0.2/0.25,
      3/sec:lin-mim-balancing-to-lin-mim-width/sec:sim-width-to-sim-balancing/0.17/1.4}{
      \draw[arr] (s\i) to node[midway] {\hyperref[\p]{\rule[.5ex]{\l cm}{0pt}}} (s\ip) ;
      \draw[arr] (u\i) to node[midway] {\hyperref[\q]{\rule[.5ex]{\m cm}{0pt}}} (u\ip) ;
    }

  \end{tikzpicture}
  }
  \caption{Visual summary of our reduction, split into its three steps.}
  \label{fig:roadmap}
\end{figure}

We now outline each step.

\medskip

\textbf{\textsc{Nae 3-Sat} to \textsc{Degree Balancing}.}
We actually reduce from the positive variant of \textsc{Nae 3-Sat}, where no literal is negated.
We design a~gadget called \emph{bottleneck sequence} that, given three disjoint sets $X, Y, Z \subset V(H)$, forces all vertices of $Y$ to appear in the order after all the vertices of~$X$, and before all the vertices of~$Z$ (or by symmetry after all the vertices of~$Z$, and before all the vertices of~$X$).
Vertices of $Y$ are in one-to-one correspondence with clauses of~$\varphi$.
Similarly, we have a~vertex for each variable of~$\varphi$.
Each \emph{variable} vertex is forced to be placed before $X$ (where it represents being set to true), or after $Z$ (where it represents being set to false).
The weights are designed so that a~\emph{clause} vertex can tolerate two but not three of its \emph{variable} vertices to be on the same side (before or after~it); which exactly captures the semantic of a~not-all-equal 3-clause.

The gap between \emph{at~most~$\tau$} and \emph{at~least~$\tau + \gamma +1$} is obtained by carefully crafting~$\weight$. 
We also add a~padding gadget to raise the minimum degree of~$H$, in such a~way that only two vertices have low-enough degree to be leaves of~$T$.
This forces $T$ to be a~path (the only tree with at~most~two leaves), thus \ldb and \tdb to coincide.

\medskip

\textbf{\textsc{Degree Balancing} to \textsc{\{Linear M, Tree S\}im-Balancing}.}
Every vertex $u$ of~$H$ becomes an independent set $S(u)$ of $G$ and a~part of $\mathcal P$ of size the sum of the weights of edges incident to~$u$.
Adjacencies in~$H$ become induced matchings in $G$, whereas non-adjacencies in~$H$ become bicliques in~$G$ (with some additional twist, see~\cref{fig:matching-and-dummy}).
The density of~$G$ forces large induced matchings to be mainly incident to a~single part~$S(u)$.
Thus, roughly speaking, the maximum induced matchings in $G$ behave like the degree in~$H$.
As the parts $S(u)$ are independent sets, there is in effect no difference between \tmb and \tsb.
The indifference between the tree or the linear variants is inherited from the previous reduction.
The actual arguments incur a~small additive loss (of~50) in the induced matching size, which is eventually outweighed by~$\gamma$.

\medskip

\textbf{\textsc{\{Linear M, Tree S\}im-Balancing} to \textsc{\{Linear M, S\}im-Width}.}
We design a~\emph{part gadget} $\mathcal G(u)$ that simultaneously takes care of the three items above~\cref{fig:roadmap}.
Essentially, every part $S(u)$ is transformed into the 1-subdivision $P_u$ of a~path on $|S(u)|$ vertices, then duplicated a~large (but constant) number of times, concatenated into a~single path, and every pair of vertices in different copies are linked by an edge whenever they do not correspond to the same vertex or neighboring vertices in $P_u$.
On the one hand, this may only increase the linear mim-width (compared to the linear mim-balancing) by an additive constant.
Following the ``spine'' of~$\mathcal G(u)$, one gets a~witness of low linear mim-width for $G^*$ from a~witness of low linear mim-balancing of~$(G,\mathcal P)$.

On the other hand, the dense ``path-like'' structure of $\mathcal G(u)$ ensures that, in an optimal decomposition of~$G^*$, its vertices may as well be placed in order at the leaves of a~caterpillar.
We thus devise a~process that builds a~witness of low sim-balancing for $(G,\mathcal P)$ from a~witness of low sim-width for~$G^*$:
We in turn identify an edge $e$ of the branch decomposition of~$G^*$ that can support $V(\mathcal G(u))$, and in particular $S(u)$, without increasing the width.
We then relocate the vertices of $S(u)$ at a~vertex subdividing~$e$.
Eventually each set $S(u)$ is solidified at a~single node of the tree, and we reach the desired witness for \tsb.

\medskip

\textbf{Remarks and perspectives.}
It can be noted that we had to develop completely new techniques.
Indeed, the known W[1]-hardness~\cite{SaetherV15,SaetherV16} relies on the difficulty of actually computing the value of a~fixed cut, i.e., solving \textsc{Maximum Induced Matching}.
In some sense, the instances produced there are not difficult to solve (a~best decomposition is, on the contrary, suggested by the reduction), but only to evaluate.
In any case, as \textsc{Maximum Induced Matching} is W[1]-hard but admits a~straightforward XP algorithm, we could not use the same idea.

We believe that \textsc{Linear Degree Balancing} could be explored for its own sake.
We emphasize that our techniques could prove useful to show the \paraNP-hardness of other parameters based on branch decompositions such as those recently introduced by Eiben et al.~\cite{Eiben22}, where the \emph{cut function} can combine maximum (semi-)induced matchings, maximum (semi-)induced co-matchings, maximum half-graphs (or ladders).
One would then mainly need to tune the gadgets of the second step (see~\cref{fig:matching-and-dummy}) to fit the particular cut function.

We notice that our reduction from \textsc{4-Occ Not-All-Equal 3-Sat} is linear: $n$-variables instances are mapped to $\Theta(n)$-vertex graphs.
Hence, unless the Exponential-Time Hypothesis (ETH)~\cite{Impagliazzo01} fails,\footnote{the assumption that there is a~$\lambda>0$ such that $n$-variable \textsc{3-Sat} cannot be solved in time $O(\lambda^n)$.} no $2^{o(n)}$-time algorithm can decide if the mim-width (or any of the five variants of mim-width) of an $n$-vertex graph is at~most 1211.
Indeed the absence of $2^{o(n)}$-time algorithm for $n$-variable \textsc{4-Occ Not-All-Equal 3-Sat} (even \textsc{Positive 4-Occ Not-All-Equal 3-Sat}) under the ETH can be derived from the Sparsification Lemma~\cite{sparsification} and classic reductions.

Our focus was to handle all the variants of mim-width at once.
This made the reduction more technical and degraded the constant upper and lower bounds.
Better bounds (than 1211) could be achieved if separately dealing with \textsc{Mim-Width} or with \textsc{Linear Mim-Width}.
For example, the latter problem essentially only requires the first two steps of the reduction.
Still, deciding if the (linear) mim-width of a~graph is at~most~1 (or any 1-digit constant) remains open.
In addition, the question whether an XP $f(\text{OPT})$-approximation algorithm for \textsc{Mim-Width} (and its variants) exists, for some fixed function~$f$ and $\text{OPT}$ being the optimum width, remains open. 

\section{Graph definitions and notation}

For $i$ and $j$ two integers, we denote by $[i,j]$ the set of integers that are at~least~$i$ and at~most~$j$.
For every integer $i$, $[i]$ is a shorthand for $[1,i]$.

\subsection{Standard graph theory}


We denote by $V(G)$ and $E(G)$ the vertex and the edge set, respectively, of a graph~$G$.
If $G$ is a~graph and $S \subseteq V(G)$, we denote by $G[S]$ the subgraph of $G$ induced by~$S$, and use $G-S$ as a~short-hand for $G[V(G) \setminus S]$.
If $e \in E(G)$, we denote by $G-e$ the graph $G$ deprived of edge $e$, but the endpoints of $e$ remain.
More generally, if $F \subseteq E(G)$, $G-F$ is the graph obtained from $G$ by removing all the edges of~$F$ (but not their endpoints).
For $X \subseteq V(G)$, we may denote by $E_G(X)$ the edge set of $G[X]$.
We denote the open and closed neighborhoods of a vertex $v$ in $G$ by $N_G(v)$ and $N_G[v]$, respectively.
For $S \subseteq V(G)$, we set $N_G(S) := \bigcup_{v \in S}N_G(v) \setminus S$ and $N_G[S] := N_G(S) \cup S$.
In every notation with a~graph subscript, we may omit it if the graph is clear from the context.
A~vertex set $S \subseteq V(G)$ \emph{covers} an edge set $F \subseteq E(G)$ if every edge of $F$ has at~least one endpoint in~$S$. 

A~\emph{cut} of a~graph $G$ is a~bipartition $(A,B)$ of~$V(G)$.
The \emph{cut-set} defined by a cut $(A,B)$, denoted by $E(A,B)$, is $\{uv\in E(G)\mid u\in A, v\in B\}$.
We denote by $G[A,B]$ the bipartite subgraph of $G$ with edge set $E(A,B)$.
A \emph{matching} is a set of edges that share no endpoints
and an \emph{induced matching} of $G$ is a matching $M$ such that every edge of $G$ intersects at~most one edge in $M$.
If $A, B \subseteq V(G)$ are two disjoint vertex subsets of $G$, a~\emph{matching between $A$ and $B$} is a~matching where every edge has one endpoint in~$A$ and the other endpoint in~$B$.
An induced matching in $G[A,B]$ is called a \emph{semi-induced} matching of $G$ between $A$ and $B$.

\subsection{Mim-width and its variants}

A~\emph{branch decomposition} or \emph{tree layout} (or simply \emph{layout}) of a~graph $G$ is a pair $(T, f)$ where $T$ is a~ternary tree (i.e., every internal node of~$T$ has degree~3) and $f$ is a~bijection from $V(G)$ to the leaves of~$T$.
Given two disjoint sets $X, Y \subseteq V(G)$, we denote by $\mim_G(X,Y)$ (resp.~$\ssim_G(X,Y)$) the maximum number of edges in a~semi-induced matching (resp.~induced matching) of $G$ between $X$ and $Y$, and may refer to it as \emph{mim-value} (resp.~\emph{sim-value}).
An edge $e$ of $T$ \emph{induces} or \emph{defines} a~cut $(A_e, B_e)$ of~$G$, where $A_e$ and $B_e$ are the preimages by $f$ of the leaves in the two components of $T-e$.

The \emph{mim-value} (resp.~\emph{sim-value}) of $(A_e, B_e)$ is set as $\mim_G(A_e,B_e)$ (resp.~$\ssim_G(A_e,B_e)$).
The \emph{mim-value} (resp.~\emph{sim-value}) of the branch decomposition $(T, f)$ is the maximum of $\mim_G(A_e,B_e)$ (resp.~$\ssim_G(A_e,B_e)$) taken over every edge $e$ of~$T$.
Finally, the \emph{mim-width} (resp.~\emph{sim-width}) of $G$ is the minimum \emph{mim-value} (resp.~\emph{sim-value}) taken over every branch decomposition $(T, f)$ of~$G$.

The \emph{upper-induced matching number} of $X \subseteq V(G)$ is the maximum size of an induced matching of $G - E(V(G) \setminus X)$ between $X$ and $V(G) \setminus X$.
The \emph{one-sided mim-width} is defined as above with the \emph{omim-value} of cut $(A_e, B_e)$, $\omim_G(A_e,B_e)$, defined as the minimum between the upper-induced matching numbers of~$A_e$ and of~$B_e$.

The linear variants of these widths and values impose $T$ to be a~rooted \emph{full} binary tree (i.e, every internal node has exactly two children) such that the internal nodes form a~path. 

\section{\textsc{Not-All-Equal 3-Sat} to \textsc{Degree Balancing}}

Given a~graph $H$ edge-weighted by a~map $\weight : E(H) \rightarrow \Nn$, the \emph{weight of a~vertex} $v$ of~$H$ is the sum of the weights of the edges incident to~$v$.
We say that a~total order $\prec$ on $V(H)$ is~\emph{$\tau$-balancing}, for some non-negative integer $\tau$,
if for every vertex $v \in V(H)$ the \emph{left weight of $v$}, $\sum_{u \in N(v), u \prec v} \weight(uv)$, and the \emph{right weight of $v$}, $\sum_{u \in N(v), v \prec u} \weight(uv)$, are both at most $\tau$, i.e., 
\[
\Delta_\prec(v) := \max \left( \sum_{u \in N(v), u \prec v} \weight(uv),  \sum_{u \in N(v), v \prec u} \weight(uv)\right) \le \tau.
\]


\medskip

\textbf{Constants $\bm{\tau}$, $\bm{\gamma}$, $\bm{\lambda}$.}
Henceforth we will use $\tau$ and $\gamma$ as global natural constants.
The reduction in this section will also use a~constant positive integer~$\lambda$.
For the current section, we need that the following conditions hold.
\begin{equation}\label{def:gamma-lambda}
 \gamma < \lambda,~~3\gamma + 4 < \tau,~~2\lambda + \gamma < \tau,~~6 \lambda \leqslant \tau.
\end{equation}

We will not only prove that \ldb is \paraNP-hard but we will obtain a~scalable additive gap. 
More specifically, we start by showing the following.

\begin{theorem}\label{thm:ldb}
  It is \NP-hard to distinguish graphs having \mbox{a~$\tau$-balancing} order from graphs having no $(\tau + \gamma)$-balancing order.
\end{theorem}

Eventually we will need that $\tau$ and $\gamma$ are multiples of a~constant integer $a$ (which is defined and set to~45 in~\cref{sec:balancing-to-mim-width}).
This can simply be achieved by multiplying all edge weights of the forthcoming reduction by~$a$.
We will finally set $\tau := 24a = 1080$, $\lambda := 4a = 180$, and $\gamma := 3a = 135$.
One can quickly check that these values do respect~\cref{def:gamma-lambda}.

\subsection{First properties on balancing orders, and bottlenecks}

Given a total order $\prec$ on a graph $H$, we say that a~vertex set $S$ is \emph{smaller} (resp. \emph{larger}) than another vertex set $U$, denoted by $S \prec U$ (resp.~$U \prec S$), if for all $s \in S, u \in U$ we have $s \prec u$ (resp. $u \prec s)$.
When a~set $S$ is neither larger nor smaller than a vertex $u$, we say that $S$ \emph{surrounds}~$u$.
We also say that $u$ \emph{is surrounded by}~$S$.
Note that if $S$ surrounds two vertices $u$ and $v$, it surrounds any vertex $w$ with $u \prec w \prec v$.

We begin with a~useful observation on the only possible $\tau$-balancing order of a~$P_3$ (i.e., 3-vertex path) with large total weight.

\begin{lemma}\label{lem:P3-order}
For any integer $t$, and any edge-weighted graph $(H,\weight)$ containing a~$P_3$ $abc$ such that $\weight(ab) + \weight(bc) > t$.
Then in any $t$-balancing order of~$H$, $\{a, c\}$ surrounds~$b$.
\end{lemma}
\begin{proof}\textcolor{red}{TOPROVE 0}\end{proof}

We also rely on the following observation, where the induced subgraph of an edge-weighted graph $(H,\weight)$ is an induced subgraph of $H$ edge-weighted by the restriction of $\weight$ to its edge set.
\begin{observation}\label{obs:bo-ind-sub}
  Every $t$-balancing order of $(H,\weight)$ is a~$t$-balancing order of any induced subgraph of~$(H,\weight)$. 
\end{observation}

Our main ingredient here is called~\emph{bottleneck}.


\begin{definition}\label{def:bottleneck}
  A~\emph{$(\tau, \gamma)$-bottleneck on terminals $v_1, \ldots, v_k$} is an~edge-weighted caterpillar $B$ defined as follows.
\begin{compactenum}
\item Let $P(B)$ be a~$2k$-vertex path, say $a_1b_1a_2b_2 \dots a_kb_k$, called \emph{spine} of~$B$ and for every $i \in [k]$, we set $\weight(a_ib_i) := \tau$ and $\weight(b_ia_{i+1}) := \gamma + 1$.
\item We obtain $B$ by adding to $P(B)$ a~leaf $v_i$ adjacent to $a_i$, satisfying $\gamma + 1 \leqslant \weight(v_ia_i) \leqslant \tau - \gamma - 1$ for every $i \in [k]$.
  This edge is called the \emph{attachment of $v_i$ to $B$}.
  \item The caterpillar $B$ is rooted in~$b_k$.
\end{compactenum}
\end{definition}

The vertex $v_1$ is called \emph{first terminal of $B$}.
A~$(\tau, \gamma)$-bottleneck is depicted in~\cref{fig:bottleneck}.

\begin{figure}[h!]
\centering
  \begin{tikzpicture}[scale=.9, vertex/.style={draw, circle, minimum size=6mm, inner sep=0pt}, every path/.style={thick}]
    \def\s{1.6}

\node[vertex] (a1) at (0, 0) {$a_1$};
\node[vertex] (b1) [right=\s cm of a1] {$b_1$};
\node[vertex] (a2) [right=\s cm of b1] {$a_2$};
\node[vertex] (b2) [right=\s cm of a2] {$b_2$};
\node (dots) [right=\s cm of b2] {$\dots$};
\node[vertex] (a3) [right=\s cm of dots] {$a_k$};
\node[vertex] (b3) [right=\s cm of a3] {$b_k$};

\node[rectangle, draw=none, minimum size=0mm, inner sep=0pt] (root) [below=0.5cm of b3] {};

\draw (a1) -- node[above] {$\tau$} (b1);
\draw (b1) -- node[above] {$\gamma + 1$} (a2);
\draw (a2) -- node[above] {$\tau$} (b2);
\draw (b2) -- node[above] {$\gamma + 1$} (dots);
\draw (dots) -- node[above] {$\gamma + 1$} (a3);
\draw (a3) -- node[above] {$\tau$} (b3);

\foreach \i in {1}{
  \node[vertex] (v\i) [below = 1cm of a\i] {$v_\i$};
  \draw (v\i) -- node[right, midway] {$\weight(a_\i v_\i) \in [\gamma+1,\tau-\gamma-1]$} (a\i);
}
\foreach \i/\j in {2/2,3/k}{
  \node[vertex] (v\i) [below = 1cm of a\i] {$v_\j$};
  \draw (v\i) -- node[right, midway] {$\weight(a_\j v_\j)$} (a\i);
}
\node [above = 0.15cm of b3] {root};

\end{tikzpicture}
\caption{Illustration of a~$(\tau,\gamma)$-bottleneck.}
\label{fig:bottleneck}
\end{figure}

A~bottleneck ensures the following.

\begin{lemma}\label{lem:bottle-order}
Let $\prec$ be a~$(\tau + \gamma)$-balancing order of a~$(\tau, \gamma)$-bottleneck $B$ on terminals $v_1, \dots, v_k$.
Using the notation of~\cref{def:bottleneck}, if $a_k \prec b_k$ then $a_1 \prec b_1 \prec a_2 \prec b_2 \prec \dots \prec a_k \prec b_k$, and $v_i \prec a_i$ for each $i \in [k]$.
Hence symmetrically, if $b_k \prec a_k$ then $b_k \prec a_k \prec b_{k-1} \prec a_{k-1} \prec \dots \prec b_1 \prec a_1$, and $a_i \prec v_i$ for each $i \in [k]$.
\end{lemma}

\begin{proof}\textcolor{red}{TOPROVE 1}\end{proof}

Henceforth every bottleneck is a~$(\tau, \gamma)$-bottleneck.
Thus we simply write \emph{bottleneck}.

\begin{definition}\label{def:bottleneck-seq}
  Given three vertex sets $S_1, S_2, S_3$, we call \emph{bottleneck sequence on $S_1, S_2, S_3$} an edge-weighted graph $B(S_1, S_2, S_3)$ obtained by adding
  \begin{compactenum}
  \item for every $i \in \{1,2\}$, a~bottleneck $B_i^+$ with terminals $S_i \cup \{s_i\}$ where $s_i$ is the first terminal of $B_i^+$, and the attachment of $s_i$ is of weight $\gamma + 1$, 
  \item for every $i \in \{2,3\}$, a~bottleneck $B_i^-$ with terminals $S_i \cup \{s_i\}$ where $s_i$ is the first terminal of $B_i^-$ and the attachment of $s_i$ is of weight $\gamma + 1$ such that
  \item for every $i \in \{1,2\}$, the roots of $B_i^+$ and of $B_{i+1}^-$ are identified as the same vertex, and
  \item for every $i \in \{2,3\}$, an edge $s_is_{i+1}$ of weight $\lfloor \frac{\tau + \gamma}{2} \rfloor + 1$, 
  \end{compactenum}
  with $s_1, s_2, s_3$ three new vertices.
\end{definition}

\begin{figure}[h!]
  \centering
  \begin{tikzpicture}[scale=.9, vertex/.style={draw, circle, minimum size=4.5mm, inner sep=0pt}, every path/.style={thick}]
	\def\s{1.1}
	\def\fo{0.08}
	
	\begin{scope}   
\node[vertex] (a1) at (0, 0) {};
		\node[vertex] (b1) [right=\s cm of a1] {};
		\node[vertex] (a2) [right=\s cm of b1] {};
		\node[vertex] (b2) [right=\s cm of a2] {};
		\node (dots) [right=\s cm of b2] {$\ldots$};
		\node[vertex] (a3) [right=\s cm of dots] {};
		\node[circle, minimum size=4.5mm, inner sep=0pt] (bi3) [right=\s cm of a3] {};
		\node[vertex] (b3) at ([xshift=1.78 cm, yshift=-2.06 cm] a3) {};
		
\draw (a1) -- node[below] {$\tau$} (b1);
		\draw (b1) -- node[below] {$\gamma + 1$} (a2);
		\draw (a2) -- node[below] {$\tau$} (b2);
		\draw (b2) -- node[below] {$\gamma + 1$} (dots);
		\draw (dots) -- node[below] {$\gamma + 1$} (a3);
		\draw (a3) -- node[left] {$\tau$} (b3);
		
\foreach \i in {1}{
			\node[vertex, preaction={fill opacity = 0.5, fill = blue}] (v\i) [below = 1cm of a\i] {$s_\i$};
			\draw (v\i) -- node[right, midway] {$\gamma+1$} (a\i);
		}
		\foreach \i/\j in {2/2,3/k}{
			\node[vertex, fill opacity = 0.5, fill = blue] (v\i) [below = 1cm of a\i] {};
			\draw (v\i) -- node[right, midway] {} (a\i);
		}
		\node [right = 0.05cm of b3] {root};
		\node[draw,thick,rounded corners,fit=(a1) (bi3) (v3), fill opacity = \fo, fill=blue] (B1p) {} ;
		\node[fit=(a1) (bi3) (v3)] (B1+) {} ;
		\node at ([yshift=-0.25 cm] B1+) {$B^+_1$};
	\end{scope}
	
	\begin{scope}[yshift=-2.52cm]
\node[vertex] (a1) at (0, 0) {};
		\node[vertex] (b1) [right=\s cm of a1] {};
		\node[vertex] (a2) [right=\s cm of b1] {};
		\node[vertex] (b2) [right=\s cm of a2] {};
		\node (dots) [right=\s cm of b2] {$\ldots$};
		\node[vertex] (a3) [right=\s cm of dots] {};
		\node[circle, minimum size=4.5mm] (bi3) [right=\s cm of a3] {};
		
\node[rectangle, draw=none, minimum size=0mm, inner sep=0pt] (root) [below=0.5cm of b3] {};
		
\draw (a1) -- node[below] {$\tau$} (b1);
		\draw (b1) -- node[below] {$\gamma + 1$} (a2);
		\draw (a2) -- node[below] {$\tau$} (b2);
		\draw (b2) -- node[below] {$\gamma + 1$} (dots);
		\draw (dots) -- node[below] {$\gamma + 1$} (a3);
		
\foreach \i in {1}{
			\node[vertex, preaction={fill opacity = 0.5, fill = green}] (vv\i) [below = 1cm of a\i] {$s_2$};
			\draw (vv\i) -- node[right, midway] {$\gamma+1$} (a\i);
		}
		\foreach \i/\j in {2/2,3/k}{
			\node[vertex, fill opacity = 0.5, fill = green] (vv\i) [below = 1cm of a\i] {};
			\draw (vv\i) -- node[right, midway] {} (a\i);
		}
		\draw (a3) -- node[below] {$\tau$} (b3);
		\node[draw,thick,rounded corners,fit=(a1) (bi3) (vv3), fill opacity = \fo, fill = green] (B2m) {} ;
		\node[fit=(a1) (bi3) (vv3)] (B2+) {} ;
		\node at ([yshift=-0.1 cm] B2+) {$B^-_2$};
		
\foreach \i/\j in {1/$\gamma+1$,2/,3/}{
			\node[vertex] (w\i) [below=1.1 cm of vv\i] {} ;
			\draw (vv\i)  -- node[right, midway] {\j} (w\i) ;
		}
		
		\foreach \i in {1,2}{
			\node[vertex] (x\i) [right=\s cm of w\i] {} ;
			\draw (w\i)  -- node[above, midway] {$\tau$} (x\i) ;
		}
		\draw (x1)  -- node[above, midway] {$\gamma+1$} (w2) ;
		\node[circle, minimum size=4.5mm] (wd) [right=\s cm of x2] {$\ldots$} ;
		\draw (x2) -- node[above, midway] {$\gamma+1$} (wd) ;
		\draw (wd) -- node[above, midway] {$\gamma+1$} (w3) ;
		\node[circle, minimum size=4.5mm] (w4) [right=\s cm of w3] {} ;
		
		\node[draw,thick,rounded corners,fit=(vv1) (w4), fill opacity = \fo, fill = green] (B2p) {} ;
		\node[draw,thick,rounded corners,fit=(vv1) (w4)] {$B^+_2$} ;
		
\foreach \i in {1}{
			\node[vertex, preaction={fill opacity = 0.5, fill = red}] (y\i) [below=0.3 cm of w\i] {$s_3$} ;
			\node[vertex] (z\i) [below=1.1 cm of y\i] {} ;
		}
		\foreach \i in {2,3}{
			\node[vertex] (y\i) [below=0.3 cm of w\i, fill opacity = 0.5, fill = red] {} ;
			\node[vertex] (z\i) [below=1.1 cm of y\i] {} ;
		}
		\foreach \i in {1,2}{
			\node[vertex] (zp\i) [right=\s cm of z\i] {} ;
			\draw (z\i)  -- node[above, midway] {$\tau$} (zp\i) ;
		}
		
		\draw (y1)  -- node[right, midway] {$\gamma+1$} (z1) ;
		\foreach \i in {2,3}{
			\draw (y\i) -- (z\i) ;
		}
		
		\node[circle, minimum size=4.5mm] (zpp) [right=\s cm of zp2] {$\ldots$} ;
		\draw (zp1) -- node[above, midway] {$\gamma+1$} (z2) ;
		\draw (zp2) -- node[above, midway] {$\gamma+1$} (zpp) ;
		\draw (zpp) -- node[above, midway] {$\gamma+1$} (z3) ;
		\node[circle, minimum size=4.5mm] (zf) [right=\s cm of z3] {} ;
		\node[circle, minimum size=4.5mm] (ze) [right=1.13 cm of z3] {} ;
		
		\node[draw,thick,rounded corners,fit=(y1) (zf), fill opacity = \fo, fill = red] (B3m) {} ;
		\node[draw,thick,rounded corners,fit=(y1) (zf)] {$B^-_3$} ;
		
		\node[vertex] (root2) [above=1.5 cm of ze] {} ;
		
		\draw (z3)  -- node[right, midway] {$\tau$} (root2) ;
		\draw (w3)  -- node[above, midway] {$\tau$} (root2) ;
		\node [right = 0.05cm of root2] {root};
	\end{scope}
	
	\foreach \i/\j in {v1/vv1, vv1/y1}{
		\draw (\i) to [bend left = -40] node[midway,left] {$\lfloor \frac{\tau+\gamma}{2} \rfloor + 1$} (\j) ;
	}
	
\end{tikzpicture}
  \caption{Bottleneck sequence $B(S_1,S_2,S_3)$.
    Vertices of $S_1 \cup \{s_1\}, S_2 \cup \{s_2\}, S_3 \cup \{s_3\}$ are in red, green, and blue, respectively.
    As in~\cref{fig:bottleneck}, every edge with an unspecified weight get one in the discrete interval $[\gamma+1,\tau-\gamma-1]$.}
\label{fig:bottleneck-sequence}
\end{figure}
The next lemma yields the crucial property ensured by bottleneck sequences.

\begin{lemma}\label{lem:Forcing-the-order}
Any $(\tau + \gamma)$-balancing order $\prec$ on a~bottleneck sequence $B(S_1, S_2, S_3)$ is such that $S_1 \prec S_2 \prec S_3$ or $S_3 \prec S_2 \prec S_1$.
\end{lemma}
\begin{proof}\textcolor{red}{TOPROVE 2}\end{proof}

We conclude the section by defining $\tau$-balancing orders for bottleneck sequences.
A~\emph{direct order} $\prec_{\rightarrow}$ of a~bottleneck $B$ with terminals $v_1, \dots, v_k$ goes as follows:
$$
\{v_1, \dots, v_k\} \prec_{\rightarrow} a_1 \prec_{\rightarrow} b_1 \prec_{\rightarrow} a_2 \prec_{\rightarrow} b_2 \prec_{\rightarrow} \dots \prec_{\rightarrow} a_k \prec_{\rightarrow} b_k,
$$
where $a_1b_2 \dots a_kb_k$ is the spine of $B$ rooted in~$b_k$.
Note that the order induced by $\{v_1, \dots, v_k\}$ is not specified (and so a~given bottleneck on $k$ terminals admits $k!$ different direct orders).
A~\emph{reverse order of~$B$}, denoted by $\prec_{\leftarrow}$, is simply defined as the reverse order of a~direct order~$\prec_{\rightarrow}$.

A~\emph{direct order} $\prec^\text{seq}_{\rightarrow}$ of a~bottleneck sequence $B(S_1, S_2, S_3)$ is a~common (linear) extension of direct orders on $B_1^+$ and $B_2^+$ and reverse orders on $B_2^-$ and $B_3^-$.
Note that on any bottleneck sequence, at~least one direct order exists since the direct and reverse orders constrain disjoint vertex sets. 
In particular we have $S_1 \prec^\text{seq}_{\rightarrow} S_2 \prec^\text{seq}_{\rightarrow} S_3$.
We check that any direct order of $B(S_1, S_2, S_3)$ is indeed $\tau$-balancing.

\begin{lemma}\label{lem:direct-order}
A direct order $\prec^\text{seq}_{\rightarrow}$ of the bottleneck sequence $B(S_1, S_2, S_3)$ is $\tau$-balancing.
\end{lemma}
\begin{proof}\textcolor{red}{TOPROVE 3}\end{proof}

\subsection{Encoding \textsc{NAE 3-Sat} in \ldb}

We now describe the reduction from \textsc{Nae 3-Sat} to \ldb.
We recall that a~not-all-equal 3-clause is satisfied if it has at~least one satisfied literal and at~least one unsatisfied literal.
The \textsc{Nae 3-Sat} remains \NP-hard if each clause is on exactly three distinct \emph{positive} literals, and every variable appears exactly four times positively (and zero times negatively)~\cite{Darmann20}.
Let $\varphi$ be any such $n$-variable \textsc{Nae 3-Sat} instance.
As we will only deal with not-all-equal 3-clauses, we say that $\varphi$ is \emph{satisfiable} whenever it admits a~truth assignment that, in each clause of~$\varphi$, sets a~(positive) literal to true and another (positive) literal to false. 
We will build an edge-weighted graph $H := H(\varphi)$ as follows.



\medskip

\textbf{Variables, clauses, and variable-clause incidence.}
For each variable $x$ of~$\varphi$, we add a~vertex $v_x$ (to $H(\varphi)$), the \emph{vertex of $x$}.
For each clause $c$ of~$\varphi$ we add a vertex $v_c$, the \emph{vertex of $c$}.
For every clause $c$ and every variable $x$ in $c$, we add the edge $v_xv_c$ of~weight~$\lambda$.
We add two sets of vertices $T = \{t_i \ : \ i \in [n]\}$ and $F = \{f_i \ : \ i \in [n]\}$, for \emph{true} and \emph{false}.
For each~$t_i$ (resp. each~$f_i$), we add a vertex $\overline{t_i}$ (resp. a vertex $\overline{f_i}$), and the edge $t_i \overline{t_i}$ (resp. $f_i \overline{f_i}$) of~weight $\tau - \lambda$.
For each $i \in [n]$, let $x_i$ be the $i$-th variable of $\varphi$.
We add a~vertex $\overline{v_{x_i}}$, and the edges $v_{x_i}t_i, v_{x_i}f_i, \overline{v_{x_i}}t_i, \overline{v_{x_i}}f_i$ each of~weight~$\lambda$.

\medskip

\textbf{Bottleneck sequence $\bm{B(T,C,F)}$.}
We then add a~bottleneck sequence $B(T,C,F)$ where $C := \{v_c \ : \ c\text{ is a clause of } \varphi \}$, with weight $\tau - \lambda$ on every attachment incident to $T$ or $F$, and weight $\tau - 2\lambda$ on every attachment incident to~$C$.
(This is allowed since $\gamma + 1 \leqslant \tau - 2\lambda \leqslant \tau - \lambda \leqslant \tau - \gamma - 1$.)
We remind the reader that every attachment of the first terminals of the bottlenecks forming $B(T,C,F)$ has weight $\gamma+1$.
These three first terminals are extra vertices not in $T$, $C$, and~$F$.

\medskip

This could end the construction of $H$, but we want to impose an extra condition, which will later prove useful.
Specifically, we want that all \emph{but two} vertices have weight at~least~$\tau + \gamma + 1$ (both having weight~$\tau$).
Let us call $H'$ the edge-weighted graph built so far. 

\medskip

\textbf{Weight padding.}
For each vertex $v \in V(H')$ of weight less than $\tau + \gamma + 1$, the \emph{missing weight} of $v$ is defined as $\tau + \gamma + 1$ minus the weight of~$v$.
Let $p$ be the sum of missing weights of vertices of~$H'$.
Let $X$ and $Y$ be two sets each comprising~$p$ new vertices.
We add a~bottleneck $B_L$ with terminals the vertices of~$X$, and a~bottleneck $B_R$ with terminals the vertices of~$Y$.
Every attachment to $B_L$ and $B_R$ with an unspecified weight gets weight $\tau - \gamma - 1$.
We add a~perfect matching between $X$ and $Y$ with every edge of~weight $2 \gamma + 2$.
Finally, for each vertex $v \in V(H')$, we link $v$ by edges of weight 1 to $t$ vertices of $X$, where $t$ is the missing weight of $v$.
We do so such that every vertex in $X$ has exactly one neighbor in~$V(H')$.

This completes the construction of $H$; see~\cref{fig:first-red}.
We observe that $H$ is triangle-free.
This fact will significantly simplify some proof in~\cref{sec:balancing-to-mim-width} (although is not in any way crucial).

\begin{figure}[h!]
  \centering
  \scalebox{.8}{
  \begin{tikzpicture}[scale=.86, vertex/.style={draw, circle, minimum size=3mm, inner sep=0pt}, every path/.style={thick}]
\def\r{0.2}
\def\Lr{1.5}
\def\b{1}

\def\rootBLx{-1}
\def\rootBLy{0}

\begin{scope}[xshift=-0.5cm]

\node[vertex, fill = black!50!] (rootBL) at (\rootBLx, \rootBLy) {};

\foreach \i [count=\t from 1] in {1, 3, 6} {
	\node[vertex] (aBL\t) at (\i * \r + \rootBLx, -\i * \b + \rootBLy) {};
	\node[vertex, fill = purple] (sL\t) at (\i * \r + \Lr + \rootBLx, -\i * \b + \rootBLy) {};
}
\foreach \i [count=\t from 1] in {2, 4} {
	\node[vertex] (bBL\t) at (\i * \r + \rootBLx, -\i * \b + \rootBLy) {};
}
\node (dotsBL) at (5 * \r + \rootBLx, -5 * \b + \rootBLy) {$\dots$};

\end{scope}

\draw (rootBL) -- node[left] {\footnotesize $\tau$} (aBL1);
\draw (aBL1) -- node[left] {\footnotesize $\gamma + 1$} (bBL1);
\draw (bBL1) -- node[left] {\footnotesize $\tau$} (aBL2);
\draw (aBL2) -- node[left] {\footnotesize $\gamma + 1$} (bBL2);
\draw (bBL2) -- node[left] {\footnotesize $\tau$} (dotsBL);
\draw (dotsBL) -- node[left] {\footnotesize $\tau$} (aBL3);

\foreach \i in {1, 2, 3}{
  \draw (sL\i) -- node[above = 0, midway] {\footnotesize $\tau-\gamma-1$} (aBL\i);
}



\def\rootBRx{16}
\def\rootBRy{0}

\begin{scope}[xshift=0.5cm]

\node[vertex, fill = black!50!] (rootBR) at (\rootBRx, \rootBRy) {};

\foreach \i [count=\t from 1] in {1, 3, 6} {
	\node[vertex] (aBR\t) at (-\i * \r + \rootBRx, -\i * \b + \rootBRy) {};
	\node[vertex, fill = yellow] (sR\t) at (-\i * \r - \Lr + \rootBRx, -\i * \b + \rootBRy) {};
}
\foreach \i [count=\t from 1] in {2, 4} {
	\node[vertex] (bBR\t) at (-\i * \r + \rootBRx, -\i * \b + \rootBRy) {};
}
\node (dotsBR) at (-5 * \r + \rootBRx, -5 * \b + \rootBRy) {$\dots$};

\end{scope}

\draw (rootBR) -- node[right] {\footnotesize $\tau$} (aBR1);
\draw (aBR1) -- node[right] {\footnotesize $\gamma + 1$} (bBR1);
\draw (bBR1) -- node[right] {\footnotesize $\tau$} (aBR2);
\draw (aBR2) -- node[right] {\footnotesize $\gamma + 1$} (bBR2);
\draw (bBR2) -- node[right] {\footnotesize $\tau$} (dotsBR);
\draw (dotsBR) -- node[right] {\footnotesize $\tau$} (aBR3);

\foreach \i in {1, 2, 3}{
  \draw (sR\i) -- node[above = 0, midway] {\footnotesize $\tau-\gamma-1$} (aBR\i);
}


\def\rootTx{7.5 - 3}
\def\rootTy{-2}

\node[vertex, fill = black!50!] (rootT) at (\rootTx, \rootTy) {};

\foreach \i [count=\t from 1] in {1, 3, 6, 8} {
	\node[vertex] (aT\t) at (-\i * \r + \rootTx - 2 * \r, \i * \b + \rootTy) {};
	\node[vertex, fill opacity = 0.5, fill = blue] (sT\t) at (-\i * \r - \Lr + \rootTx, \i * \b + \rootTy) {};
	\node[vertex] (aCL\t) at (\i * \r + \rootTx + 2 * \r, \i * \b + \rootTy) {};
	\node[vertex, fill opacity = 0.5, fill = green] (sCL\t) at (7.5, \i * \b + \rootTy) {};
}
\foreach \i [count=\t from 1] in {1, 3, 6} {
  \node[vertex] (osT\t) at (-\i * \r - \Lr + \rootTx - 1, \i * \b + \rootTy) {};
  \draw (osT\t) to node[midway, above] {\footnotesize{$\tau-\lambda$}} (sT\t) ;
}
\foreach \i [count=\t from 1] in {2, 4, 7} {
	\node[vertex] (bT\t) at (-\i * \r + \rootTx - 2 * \r, \i * \b + \rootTy) {};
	\node[vertex] (bCL\t) at (\i * \r + \rootTx + 2 * \r, \i * \b + \rootTy) {};
}
\node (dotsT) at (-5 * \r + \rootTx - 2 * \r, 5 * \b + \rootTy) {$\dots$};
\node (dotsCL) at (5 * \r + \rootTx + 2 * \r, 5 * \b + \rootTy) {$\dots$};

\draw (rootT) -- node[right] {} (aT1);
\draw (aT1) -- node[right] {} (bT1);
\draw (bT1) -- node[right] {\footnotesize $\tau$} (aT2);
\draw (aT2) -- node[right] {\footnotesize $\gamma + 1$} (bT2);
\draw (bT2) -- node[right] {\footnotesize $\tau$} (dotsT);
\draw (dotsT) -- node[right] {\footnotesize $\tau$} (aT3);
\draw (aT3) -- node[right] {\footnotesize $\gamma + 1$} (bT3);
\draw (bT3) -- node[right] {\footnotesize $\tau$} (aT4);

\draw (rootT) -- node[left] {} (aCL1);
\draw (aCL1) -- node[left] {} (bCL1);
\draw (bCL1) -- node[left] {\footnotesize $\tau$} (aCL2);
\draw (aCL2) -- node[left] {\footnotesize $\gamma + 1$} (bCL2);
\draw (bCL2) -- node[left] {\footnotesize $\tau$} (dotsCL);
\draw (dotsCL) -- node[left] {\footnotesize $\tau$} (aCL3);
\draw (aCL3) -- node[left] {\footnotesize $\gamma+1$} (bCL3);
\draw (bCL3) -- node[left] {\footnotesize $\tau$} (aCL4);

\draw (sT4) -- node[above = 0, midway] {\footnotesize $\gamma+1$} (aT4);
\draw (sCL4) -- node[above = 0, midway] {\footnotesize $\gamma+1$} (aCL4);
\foreach \i in {1,2,3}{
	\draw (sT\i) -- node[above = 0, midway] {\footnotesize $\tau -\lambda$} (aT\i);
	\draw (sCL\i) -- node[above = 0, midway] {\footnotesize $\tau - 2\lambda$} (aCL\i);
}




\def\rootFx{7.5 + 3}
\def\rootFy{\rootTy}

\node[vertex,fill = black!50!] (rootF) at (\rootFx, \rootFy) {};

\foreach \i [count=\t from 1] in {1, 3, 6, 8} {
	\node[vertex] (aF\t) at (\i * \r + \rootFx + 2*\r, \i * \b + \rootFy) {};
	\node[vertex, fill opacity = 0.5, fill = red] (sF\t) at (\i * \r + \Lr + \rootFx, \i * \b + \rootFy) {};
	\node[vertex] (aCR\t) at (-\i * \r + \rootFx - 2*\r, \i * \b + \rootFy) {};
}
\foreach \i [count=\t from 1] in {1, 3, 6} {
  \node[vertex] (osF\t) at (\i * \r + \Lr + \rootFx + 1, \i * \b + \rootFy) {};
  \draw (sF\t) to node[midway, above] {$\tau-\lambda$} (osF\t) ;
}
\foreach \i [count=\t from 1] in {2, 4, 7} {
	\node[vertex] (bF\t) at (\i * \r + \rootFx + 2*\r, \i * \b + \rootFy) {};
	\node[vertex] (bCR\t) at (-\i * \r + \rootFx- 2*\r, \i * \b + \rootFy) {};
}
\node (dotsF) at (5 * \r + \rootFx+ 2*\r, 5 * \b + \rootFy) {$\dots$};
\node (dotsCR) at (-5 * \r + \rootFx - 2*\r, 5 * \b + \rootFy) {$\dots$};

\draw (rootF) -- node[left] {} (aF1);
\draw (aF1) -- node[left] {} (bF1);
\draw (bF1) -- node[left] {\footnotesize $\tau$} (aF2);
\draw (aF2) -- node[left] {\footnotesize $\gamma + 1$} (bF2);
\draw (bF2) -- node[left] {\footnotesize $\tau$} (dotsF);
\draw (dotsF) -- node[left] {\footnotesize $\tau$} (aF3);
\draw (aF3) -- node[left] {\footnotesize $\gamma + 1$} (bF3);
\draw (bF3) -- node[left] {\footnotesize $\tau$} (aF4);

\draw (rootF) -- node[right] {} (aCR1);
\draw (aCR1) -- node[right] {} (bCR1);
\draw (bCR1) -- node[right] {\footnotesize $\tau$} (aCR2);
\draw (aCR2) -- node[right] {\footnotesize $\gamma + 1$} (bCR2);
\draw (bCR2) -- node[right] {\footnotesize $\tau$} (dotsCR);
\draw (dotsCR) -- node[right] {\footnotesize $\tau$} (aCR3);
\draw (aCR3) -- node[right] {\footnotesize $\gamma + 1$} (bCR3);
\draw (bCR3) -- node[right] {\footnotesize $\tau$} (aCR4);


\foreach \i [count = \l] in {4.5, 10.5} {
	\foreach \j [count = \t] in {1} {
		\node (tau\l\t) at (\i, \rootFy + \j * 0.5 * \b) {\footnotesize $\tau$};
	}
	\foreach \j [count = \t] in {3} {
		\node (gamma\l\t) at (\i, \rootFy + \j * 0.5 * \b) {\footnotesize $\gamma + 1$};
	}	
}

\draw (sF4) -- node[above = 0, midway] {\footnotesize $\gamma+1$} (aF4);
\draw (sCL4) -- node[above = 0, midway] {\footnotesize $\gamma+1$} (aCR4);
\foreach \i in {1,2,3}{
  \draw (sF\i) -- node[above = 0, midway] {\footnotesize $\tau -\lambda$} (aF\i);
  \draw (sCL\i) -- node[above = 0, midway] {\footnotesize $\tau - 2\lambda$} (aCR\i);
}

\draw (sF4) to [out=90, in=90] node[below= 0, pos=0.5] {$\lfloor\frac{\tau + \gamma}{2}\rfloor + 1$} (sCL4);
\draw (sT4) to [out=90, in=90] node[below = 0, pos=0.5] {$\lfloor\frac{\tau + \gamma}{2}\rfloor + 1$} (sCL4);



\foreach \i/\name/\bendred/\bendblue/\value [count = \t] in {-3/v_x/25/10/\lambda, -1.5/v_y/50/13/, 3/v_z/35/20/}{
	\node[vertex, inner sep=1pt] (var\t) at (7.5 + \i, -5) {\footnotesize $\name$};
	\node[vertex, inner sep=1pt] (varbar\t) at (7.5 + \i, -5.7) {\footnotesize $\overline{\name}$};
	\node[draw, rounded corners, fit = (var\t) (varbar\t)] (rectvar\t) {};
	\draw[opacity = 0.5, red] (rectvar\t) to [bend right = \bendred] node[above = 0, pos=0.05] {\color{black} \footnotesize $\value$} (sF\t);
	\draw[opacity = 0.5, blue] (rectvar\t) to [bend left = \bendblue] node[above right= 0, pos=0.05] {\color{black} \footnotesize $\value$} (sT\t);
}
\draw[opacity = 0.5, green] (var1) to [bend right = 10] node[above = 0, pos=0.05] {\color{black} \footnotesize $\lambda$} (sCL1);
\draw[opacity = 0.5, green] (var2) to [bend right = 10] node[above = 0, pos=0.2] {} (sCL1);
\draw[opacity = 0.5, green] (var3) to [bend left = 10] node[above = 0, pos=0.1] {} (sCL2);

\begin{scope}[xshift=-0.5cm]
\draw[blue!20!black,fill=orange!20, opacity = 0.2, rounded corners=10,thick]
     (\rootBLx - 1, \rootBLy + 0.5) rectangle (2,-6.5);
\node[opacity = 1] at (\rootBLx - 0.5, \rootBLy - 6) {\large \color{black} $B_L$};
\end{scope}

\begin{scope}[xshift=0.5cm]
\draw[blue!20!black,fill=black!20, opacity = 0.2, rounded corners=10,thick]
     (\rootBRx + 1, \rootBRy + 0.5) rectangle (\rootBRx - 3, -6.5);
\node[opacity = 1] at (\rootBRx + 0.5, \rootBRy - 6) {\large \color{black} $B_R$};
\end{scope}

\draw[blue!20!black,fill=green!20, opacity = 0.2, rounded corners=10,thick]
     (7, -1.5) rectangle (8, 5);
\node[opacity = 1] at (7.5, 4.6) {\large \color{black} $C$};
\node at (7.5, -6.5) {Variable vertices};
\draw[opacity = 0.3] (sL1) to node[left, pos=0.5] {1} (osT2);
\draw[opacity = 0.3] (sL2) to node[left, pos=0.3] {1} (osT2);
\draw[opacity = 0.3] (sL3) to node[above = 0, pos=0.5] {1} (varbar1);

\draw[opacity = 0.5] (sL2) to [bend left = 10] node[above = 0, pos=0.09] {$2 \gamma + 2$} (sR2);

\end{tikzpicture}
}
\caption{Illustration of $(H, \omega)$.
  Centered at the top is the bottleneck sequence $B(T, C, F)$.
  The vertices of $X$ are in purple (left), and the vertices of $Y$ are in yellow (right).
  The edges incident to the variable vertices that are drawn in blue, green, red all have weight $\lambda$.
  Not to overburden the figure, we have only drew \emph{some} edges of the construction.
  Only one edge of the matching between $X$ and $Y$ is depicted, and the paddings of $\overline{v_x}$ and of $\overline{t_2}$ are (partially) represented (weight-1 edges toward $X$).
  The clause corresponding to the bottommost vertex of $C$ contains $x, y$ and some other variable (not shown), while that of the second bottommost vertex of $C$ contains $z$ (and two other variables).
  The roots of bottlenecks are in gray.
  The leftmost and rightmost gray vertices are the only two vertices of weight less than $\tau+\gamma+1$ (namely $\tau$).
 }
\label{fig:first-red}
\end{figure}

\medskip

We check that the weight padding works as intended.

\begin{lemma}\label{lem:saturation}
Every vertex of $H$ has weight at~least $\tau + \gamma + 1$, except two vertices.
\end{lemma}
\begin{proof}\textcolor{red}{TOPROVE 4}\end{proof}

\subsection{Preparatory lemmas}

We will make use of the following two lemmas.

\begin{lemma}\label{lem:clause-surrounding}
For any $(\tau + \gamma)$-balancing order $\prec$ of $H(\varphi)$, for every clause $c = x \lor y \lor z$ of~$\varphi$, $\{v_x, v_y, v_z\}$ surrounds~$v_c$.
\end{lemma}
\begin{proof}\textcolor{red}{TOPROVE 5}\end{proof}

\begin{lemma}\label{lem:well-defined-order}
For any $(\tau+\gamma)$-balancing order $\prec$ of $H(\varphi)$, for any variable $x$ of $\varphi$, we either have $v_x \prec C$ or $C \prec v_x$. 
\end{lemma}
\begin{proof}\textcolor{red}{TOPROVE 6}\end{proof}

\subsection{Correctness of the reduction}

We can now show that our reduction performs as announced.

\begin{lemma}\phantomsection\label{lem:bo-to-sat}
If $H(\varphi)$ admits a $(\tau + \gamma)$-balancing order, then $\varphi$ is satisfiable.
\end{lemma}
\begin{proof}\textcolor{red}{TOPROVE 7}\end{proof}

\begin{lemma}\label{lem:sat-to-bo}
If $\varphi$ is satisfiable, then $H(\varphi)$ admits a~$\tau$-balancing order.
\end{lemma}
\begin{proof}\textcolor{red}{TOPROVE 8}\end{proof}

\cref{thm:ldb} is a~direct consequence of~\cref{lem:bo-to-sat,lem:sat-to-bo}.
The reason we ``padded the degree'' in $H(\varphi)$ will become apparent in the next section.
We will observe that when $\varphi$ is unsatisfiable, not only no linear order can ``balance'' the degrees, but no tree can either.

\subsection{From linear orders to trees}\label{sec:lin-ord-to-trees}

As mim-width is defined via branch decompositions, we adapt the balancing order problem to trees.
Consider an edge-weighted graph $(H, \weight)$, and a~tree $T$ such that there exists a~bijective map $f \colon V(H) \rightarrow V(T)$.
Note that $(T, f)$ is \emph{not} a~branch decomposition of $H$ for two reasons: vertices of $H$ are mapped to \emph{all} nodes~of $T$ and not merely its leaves, and $T$ is not necessarily a~ternary tree (nor a~rooted binary tree).

Each edge $e$ of $T$ defines a~cut of $H$, which we denote $(A_e, B_e)$, where $A_e$ is the preimage by~$f$ of one connected component of $T-e$, and $B_e$, of the other component.
We say that $(T, f)$ is a~\emph{$\tau$-balancing tree of $(H, \weight)$} if for any vertex $v \in V(H)$, for any edge $e \in E(T)$ incident to~$f(v)$, the sum of the weights of edges (in $E(H)$) incident to~$v$ in the cut $(A_e, B_e)$ is at~most~$\tau$.

\defparproblem{\tdb}{An edge-weighted graph~$(H, \weight)$ and a~non-negative integer~$\tau$.}{$\tau$}{Does $(H, \weight)$ admit a~$\tau$-balancing tree?}

Note that any graph with a~$\tau$-balancing order also admits a~$\tau$-balancing tree, with $T$ being the path of length $|V(H)|$, and $f$ mapping the vertices of~$H$ along $T$ in the $\tau$-balancing order.

\begin{theorem}\label{thm:tdb}
  Given an edge-weighted graph $(H, \weight)$ promised to satisfy either one of 
  \begin{compactitem}
  \item $(H, \weight)$ admits a~$\tau$-balancing order or 
  \item $(H, \weight)$ does not admit a~$(\tau + \gamma)$-balancing tree,
  \end{compactitem}
  deciding which outcome holds is \NP-hard.
\end{theorem}
\begin{proof}\textcolor{red}{TOPROVE 9}\end{proof}

\section{\textsc{Degree Balancing} to \textsc{Linear Mim-Balancing/Tree Sim-Balancing}}\label{sec:degree-to-matching}

In this section, we show how to transfer the degree requirement of \textsc{Degree Balancing} to the induced-matching requirement of \textsc{Mim-} and \textsc{Sim-Balancing}.



\subsection{The \textsc{Mim-Balancing} and \textsc{Sim-Balancing} problems}\label{sec:im-balancing}

A~\emph{partitioned graph} is a~pair $(G, \mathcal S)$ where $G$ is a~graph and $\mathcal S$ is a~partition of $V(G)$. 
A~\emph{\tmap} of a~partitioned graph $(G,\mathcal S)$ is a~pair $(T,f)$ where $T$ is a~tree and $f \colon \mathcal S \rightarrow V(T)$ is a~bijection from the parts of $\mathcal S$ to the vertices of~$T$. 
When $T$ is a path, we may call $(T, f)$ a~\emph{\pmap of~$\mathcal S$}.

We say that a cut $(A,B)$ of $G$ is an \emph{$\mathcal S$-cut} if each set in $\mathcal S$ is included in either $A$ or $B$.
Each edge $e \in E(T)$ in a~tree mapping $(T, f)$ of $(G, \mathcal S)$ defines an $\mathcal S$-cut $(A_e, B_e)$ of $G$: the union of the parts mapped to each component of $T - e$.
The \emph{sim-value (resp. mim-value) of a~\tmap $(T, f)$ of $(G,\mathcal S)$} is the maximum taken over every edge $e \in E(T)$ of the maximum size of an induced (resp. semi-induced) matching between $A_e$ and $B_e$. 
The \emph{sim-balancing (resp. mim-balancing) of $(G, \mathcal{S})$} is the minimum sim-value (resp. mim-value) among all possible \tmaps of $(G, \mathcal{S})$. 
Similarly, the \emph{linear sim-balancing (resp. mim-balancing)} is the minimum sim-value (resp. mim-value) among \pmaps.

\defparproblem{\tsb (resp.~\tmb)}{A~partitioned graph~$(G,\mathcal S)$ and a~non-negative integer~$\tau$.}{$\tau$}{Does $(G,\mathcal S)$ admit a~\tmap $(T, f)$ of sim-value (resp.~mim-value)~$\tau$?}

Note that even when $\mathcal S$ is the finest partition $\{\{v\}~:~v \in V(G)\}$, this problem is not exactly \textsc{Mim-Width}, as $f$ also maps vertices to internal nodes of $T$, and $T$ has no degree restriction.
\lmb (or \lsb) is defined analogously except $T$ is forced to be a~path.
We may use \textsc{Mim-Balancing} to collectively refer to \lmb and \tmb; and similarly with \textsc{Sim-Balancing}.

At the end of this section, we will have established the following.

\begin{theorem}
  Let $\tau, \gamma$ be natural numbers satisfying \Cref{def:gamma-lambda} and $\gamma > 50$.
  Given partitioned graphs $(G,\mathcal S)$ such that:
  \begin{compactitem}
  \item the linear mim-balancing of $(G, \mathcal{S})$ is at most $\tau + 50$, or
  \item the sim-balancing of $(G, \mathcal{S})$ is at least $\tau + \gamma$,
  \end{compactitem}
  deciding which of the two outcomes holds is \NP-hard.
\end{theorem}

\subsection{Encoding \textsc{Degree Balancing} in \textsc{Mim/Sim-Balancing}}

Let $(H, \weight)$ be an instance of \tdb with positive and integral weights.
We build an instance of \tmb $G := G(H, \weight), \mathcal S := \mathcal{S}(H, \weight)$, as follows.

\medskip

\textbf{Construction of $\bm{(G,\mathcal S)}$.}
For every vertex $u \in V(H)$ and every $v \in N_H(u)$, we add an independent set $I(u, v)$ of size $\weight(uv)$ to~$G$.
For each vertex $u \in V(H)$, we set~$$S(u) := \bigcup_{v \in N_H(u)} I(u, v).$$
Each $S(u)$ will remain an independent set in~$G$.
The partition $\mathcal S$ is simply defined as $\{S(u)~:~u \in V(H)\}$.

We finish the construction by adding two kinds of edges in $G$, \emph{matching edges} and \emph{dummy edges}. 
For every pair of disjoint edges $uv$ and $xy$ of $H$, we add an edge between every vertex of $I(u, v)$ and every vertex of $I(x, y)$.
All these edges are called \emph{dummy}.
For every $uv \in E(H)$, we add a~maximum (perfect) induced matching between $I(u,v)$ and $I(v,u)$.
All these edges are called \emph{matching edges}.
Observe that $\weight(uv)=\weight(vu)$ ($H$ is undirected), hence $|I(u,v)|=|I(v,u)|$ and the matching between $I(u,v)$ and $I(v,u)$ is indeed perfect.  
This concludes the construction of $(G, \mathcal S)$; see~\cref{fig:matching-and-dummy} for an illustration of the adjacencies between some $S(u)$ and $S(v)$.

\begin{figure}[h!]
  \centering
  \begin{tikzpicture}[
      vertex/.style={draw, circle, minimum size = 0.3cm},
      matching/.style={blue, very thick},
      dummy/.style={very thick},
    ]
    \def\s{0.6}
    \def\h{1}
\def\n{12}
    \foreach \i in {1,...,\n}{
      \node[vertex] (a\i) at (0, - \i * \s) {} ;
    }
\foreach \i/\j/\k/\l in {1/4/1/v,5/7/2/v_1,8/9/3/v_2,10/12/4/v_3}{
      \node[draw, rounded corners, fit=(a\i) (a\j)] (Iu\k) {} ;
      \node (tIu\k) at (-\h, - 0.5 * \i * \s - 0.5 * \j * \s) {$I(u,\l)$} ; 
    }
    \node[draw, thick, rounded corners, fit=(Iu1) (Iu4) (tIu1) (tIu4)] (Su) {} ;
    \node at (- 2.4 * \h, - 0.5 * \s - 0.5 * \n * \s) {$S(u)$} ;

\def\m{10}
    \foreach \i in {1,...,\m}{
      \node[vertex] (b\i) at (3 * \s, - \i * \s) {} ;
    }
\foreach \i/\j/\k/\l in {1/4/1/u,5/8/2/v_3,9/10/3/v_4}{
      \node[draw, rounded corners, fit=(b\i) (b\j)] (Iv1\k) {} ;
      \node (tIv1\k) at (3 * \s + \h, - 0.5 * \i * \s - 0.5 * \j * \s) {$I(v,\l)$} ; 
    }
    \node[draw, thick, rounded corners, fit=(Iv11) (Iv13) (tIv11) (tIv13)] (Sv1) {} ;
    \node at (3 * \s + 2.4 * \h, - 0.5 * \s - 0.5 * \m * \s) {$S(v)$} ;

\foreach \i in {1,...,4}{
      \draw[matching] (a\i) -- (b\i) ;
    }
\foreach \i/\j in {Iu2/Iv12, Iu2/Iv13, Iu3/Iv12, Iu3/Iv13, Iu4/Iv13}{
      \draw[dummy] (\i) -- (\j) ;
    }
  \end{tikzpicture}
  \caption{Adjacencies between $S(u)$ and $S(v)$.
    In this example, $u$ has four neighbors $v, v_1, v_2, v_3$, and $v$ has three neighbors $u, v_3, v_4$.
    The matching edges are in blue, the dummy edges are in black (edges between two boxes represent bicliques).
    Notice the non-edges between $I(u,v_3)$ and $I(v,v_3)$.}
  \label{fig:matching-and-dummy}
\end{figure}

We notice that the configuration of the figure actually implies that $uvv_3$ is a~triangle in~$H$, which does not happen in graphs $H$ produced by the previous reduction.
However, we will not use that $H$ is triangle-free in the current section, and \cref{fig:matching-and-dummy} shows the general behavior between $S(u)$ and $S(v)$.
(For triangle-free graphs $H$, if $uv \in E(H)$, then there would instead be a~biclique between $S(u) \setminus I(u,v)$ and $S(v) \setminus I(v,u)$, and if $uv \notin E(H)$, $I(u,v)$, $I(v,u)$, and the matching edges in between them would simply not exist.) 

\subsection{Preparatory lemmas}

\renewcommand{\part}{\text{part}}

We will now prove some facts about the (semi-)induced matchings of the $\mathcal S$-cuts of $G$.

\begin{lemma}\label{lem:no-dummy-edge-S-cut}
	Let $(A, B)$ be an $\mathcal S$-cut of $G$.
	If there is no dummy edge between a vertex of $I(u,v)\subseteq A$ and one from $I(x,y)\subseteq B$, then $u=y$ or $v=x$ or $v=y$.
\end{lemma}
\begin{proof}\textcolor{red}{TOPROVE 10}\end{proof}

\begin{lemma}\label{lem:matching-edges-are-clean}
  Let $(A, B)$ be an $\mathcal S$-cut of $G$.
  Assume there exists a semi-induced matching $M := \{e_1, \dots, e_m\}$ in $G$ between $A$ and $B$ containing matching edges only.
  Then a~single part of~$\mathcal S$ covers all the edges of $M$. 
\end{lemma}
\begin{proof}\textcolor{red}{TOPROVE 11}\end{proof}

\begin{lemma}\label{lem:white-edges-restriction}
  Let $(A, B)$ be an $\mathcal S$-cut of~$G$.
  If $M := \{a_1b_1, \dots, a_tb_t\}$ is a semi-induced matching in $G$ between $A$ and $B$ only made of dummy edges, and all the vertices $a_i$ lie in the same part of $\mathcal S$ included in $A$, then $t \leqslant 6$.
\end{lemma}
\begin{proof}\textcolor{red}{TOPROVE 12}\end{proof}

\begin{lemma}\label{lem:mim-width-local}
  Let $(A, B)$ be a $\mathcal S$-cut of $(G, \mathcal S)$ with a~semi-induced matching $\{e_1, \ldots, e_m\}$ between $A$ and $B$.
  Then at least $m - 50$ edges among $\{e_1, \ldots, e_m\}$ are matching edges.
\end{lemma}
\begin{proof}\textcolor{red}{TOPROVE 13}\end{proof}

\subsection{Correctness of the reduction}

We can now show the correctness of the reduction.

\begin{lemma}\label{lem:simwidth2balanced}
If $(G, \mathcal S)$ admits a~\tmap~$(T, f)$ of sim-value~$t$, then $(H,\weight)$ admits a~$t$-balancing tree.
\end{lemma}
\begin{proof}\textcolor{red}{TOPROVE 14}\end{proof}

\begin{lemma}\label{lem:balanced2sim-width}
If $H$ admits a $\tau$-balancing order, then there is a~\pmap~$(P, f)$ of~mim-value at~most~$\tau + 50$.

Moreover, for every cut $(A_e, B_e)$ induced by an edge $e\in E(P)$ and every semi-induced matching $M$ between $A_e$ and $B_e$, $M$ has at most $\tau$ matching edges and there exists $u\in V(H)$ such that $S(u)$ covers the matching edges of $M$.
\end{lemma}

\begin{proof}\textcolor{red}{TOPROVE 15}\end{proof}

\section{\textsc{Mim/Sim-Balancing} to \textsc{Linear Mim-Width/Sim-Width}}\label{sec:balancing-to-mim-width}

\newcommand{\gad}{\mathcal G}

The next reduction uses two constants $a := 45$ and $b:= 6 \tau (\tau + \gamma) + 1$.
With the announced values of $\tau = 1080$ and $\gamma = 135$, we have $b = 7873201$.
We remark that the value of~$b$ will not affect the linear mim-width upper bound nor the sim-width lower bound.
(The constant $b$ should simply be that large to make our proofs work.)

Let $(H, \weight)$ be an instance of \tdb where all edge weights are positive multiples of~$a$ and $H$ is triangle-free.
We build a graph $G^*$, such that if $H$ has a~$\tau$-balancing order, then the linear mim-width of $G^*$ is at most $\frac{a+1}{a} \tau + 107$; and if $H$ is has no $(\tau+\gamma)$-balancing tree, then the sim-width of $G^*$ is at~least $\tau+\gamma$.
We construct $G^*$ from the instance $G := G(H), \mathcal S := \mathcal{S}(H)$ of \tmb from the previous reduction.
Remember that $\mathcal S = \{S(u)~:~u \in V(H)\}$.

The main goal of this reduction is to obtain a graph $G^*$ whose sim-width and linear mim-width are related to the the sim-balancing and linear mim-balancing of $(G,\cal S)$, respectively.
Observe that we cannot simply set $G^*:=G$ since a~layout $(T,f)$ of~$G$ can scatter each $S(u)$ so that for each matching edge $xy$ of $G$, $x$ and $y$ are placed at leaves of~$T$ sharing a~neighbor in~$T$.
Consequently, the only cuts $(A,B)$ induced by the edges of~$T$ with a~matching edge between $A$ and $B$ are rather trivial ($A$ or $B$ is a~singleton).
Thus, the sim-width of $G$ could be uncontrollably smaller than the sim-balancing of~$(G,\cal S)$. 

To prevent this, we design a gadget $\gad(u)$ for each $u\in V(H)$ from $b$ copies of $S(u)$.
These gadgets ensure that any tree layout $(T,f)$ of $G^*$ of sim-value at~most $\tau+\gamma-1$ behaves similarly to a~tree mapping of $(G,\cal S)$ in the sense that for every $S(u)$, there is an edge $e$ of $T$ such that both sides of the induced cut $(A_e, B_e)$ contain a copy of $S(u)$. 
Using this property, we prove that the sim-width of $G^*$ is at~least the sim-balancing of $(G,\cal S)$.

The final lemma from each of the two last subsections prove~\cref{thm:main} (hence~\cref{thm:main-csq}), which we restate here.
\begin{theorem}
  Let $\tau, \gamma, a$ be natural numbers as previously defined.
  Given graphs $G$ such that either 
  \begin{compactitem}
  \item the linear mim-with of~$G$ is at~most $\frac{a+1}{a}\tau + 107$, or
  \item the sim-width of $G$ is at~least $\tau + \gamma + 1$,
  \end{compactitem}
  deciding which of the two outcomes holds is \NP-hard.
\end{theorem}
One can indeed check that with the announced values for $\tau, \gamma, a$, we have $\frac{a+1}{a}\tau + 107=1211$ and $\tau + \gamma + 1=1216$.

\subsection{Encoding \textsc{Mim/Sim-Balancing} in \textsc{Mim/Sim-Width}}

We start with the description of a~gadget for each vertex of~$H$.

\medskip

\textbf{Construction of $\bm{\gad(u)}$.}
For each vertex $u \in V(H)$, the \emph{gadget of $u$}, denoted by $\gad(u)$, is a~graph spanned by a~path $Q_u$ of length $2b \cdot |S(u)|$ made by \emph{concatenating} $b$ copies of a~path~$P_u$.
The path $P_u$ is built as follows.
Recall that in the graph $G$, the set $S(u)$ partitions into $I(u, v_1) \uplus \dots \uplus I(u, v_k)$ where $\{v_1, \dots, v_k\} = N_H(u)$.
Since all weights are multiples of~$a$, $|I(u, v)|$ is a multiple of $a$ for any edge $uv \in E(H)$.
Hence we can write each $I(u, v)$ as a~disjoint union $I(u, v, 1) \uplus \dots \uplus I(u, v, a)$ where each $I(u, v, i)$ has size $\frac{|I(u, v)|}{a}$.

We construct the path $L_i$ whose vertex set is $I(u, v_1, i) \cup I(u, v_2, i) \cup \dots \cup I(u, v_k, i)$, and whose vertices occur in this order along $L_i$.
We define $L$ as the concatenation $L_1 L_2\dots L_a$, i.e., the last vertex of~$L_i$ is made adjacent to the first vertex of~$L_{i+1}$, for every $i \in [a-1]$.
The path $P_u$ is obtained from the 1-subdivision of $L$ by adding a~vertex adjacent to the last vertex of $L_a$; see~\cref{fig:Pu}.

\begin{figure}[h!]
  \centering
  \begin{tikzpicture}[
	vertex/.style={draw, circle, minimum size=3pt, inner sep=0pt},
	subd/.style={draw, circle, minimum size=2pt, fill, inner sep=0pt},
	matching/.style={blue, very thick},
	dummy/.style={very thick},
	]
	\def\s{0.35}
	\def\h{1}
	\def\n{12}
	\def\a{3}
	
\pgfmathtruncatemacro\p{\n * \a}
	\foreach \i in {1,...,\p}{
		\node[vertex] (a\i) at (\i * \s, 0) {} ;
		\node[subd] (b\i) at (\i * \s + \s / 2, 0) {} ;
		\draw (a\i) -- (b\i) ;
	}
	
	\pgfmathtruncatemacro\pm{\p - 1}
	\foreach \i [count = \ip from 2] in {1,...,\pm}{
		\draw (b\i) -- (a\ip) ;
	}
	
\foreach \z in {1,...,\a}{
		\foreach \i/\j/\k/\l/\c in {1/4/1/v/yellow,5/7/2/v_1/orange,8/9/3/v_2/red,10/12/4/v_3/purple}{
			\pgfmathtruncatemacro\ii{(\z - 1) * \n + \i}
			\pgfmathtruncatemacro\jj{(\z - 1) * \n + \j}
			\node[draw, rounded corners, inner sep=1.75pt, fit=(a\ii) (a\jj), fill opacity=0.2, fill=\c] (I\k-\z) {} ;
		}
		\pgfmathsetmacro\yf{(\z - 1) * \n + 1}
		\pgfmathsetmacro\yl{(\z - 1) * \n + \n + 0.5}
		\draw[stealth-stealth] (\yf * \s - 0.1, -0.25) to node[midway,below] {$L_\z$} (\yl * \s - 0.05, -0.25) ;
		
		\node at (2.5 * \s + \z * \n * \s - \n * \s, 0.4) {$I(u,v_1,\z)$} ;
	}
	
\end{tikzpicture}
  \caption{The path $P_u$ for a~vertex $u$ with four neighbors $v_1, v_2, v_3, v_4$, and $a = 3$.
    The sizes of $I(u,v_1)$, $I(u,v_2)$, $I(u,v_3)$, $I(u,v_4)$ are 12, 9, 6, 9, respectively; all divisible by~$a$.
    The labels $I(u,v_1,\bullet)$ and $L_{\bullet}$ refer to the white vertices, while $P_u$ also comprises the subdivision vertices in black.}
  \label{fig:Pu}
\end{figure}

\def\copies{\mathsf{Copies}}

We obtain the path $Q_u$ by concatenating $b$ copies  $P_u^1,P_u^2, \dots, P_u^b$ of $P_u$. 
Note that each vertex $x$ of $P_u$ has $b$ copies $x_1,\dots,x_b$ in $Q_u$; for each $y\in \{x,x_1,\dots,x_b\}$, we denote by $\copies(y)$ the set $\{x_1,\dots,x_b\}$.
The gadget $\gad(u)$ is obtained from $Q_u$ by adding an edge between every pair of vertices $x, y$ in two distinct $P_u^i, P_u^j$ except if $y$ is in $N_{Q_u}[\copies(x)]$; see~\cref{fig:Qu}.

\begin{figure}[h!]
  \centering
  \begin{tikzpicture}[
	vertex/.style={draw, circle, minimum size=3pt, inner sep=0pt},
	subd/.style={draw, circle, minimum size=2pt, fill, inner sep=0pt},
	matching/.style={blue, very thick},
	dummy/.style={very thick},
	]
	\def\sc{1}
	\def\s{0.35}
	\def\h{1}
	\def\n{12}
	\def\a{3}
	\def\b{3}
	
	\foreach \r in {1,...,\b}{
		\pgfmathsetmacro\xs{1.58 * \b * \r / \sc}
		
\pgfmathtruncatemacro\p{\n * \a}
			\foreach \i in {1,...,\p}{
				\node[vertex] (a\r-\i) at (\i * \s, -\r +1) {} ;
				\node[subd] (b\r-\i) at (\i * \s + \s / 2, -\r +1) {} ;
				\draw (a\r-\i) -- (b\r-\i) ;
			}
			
			\pgfmathtruncatemacro\pm{\p - 1}
			\foreach \i [count = \ip from 2] in {1,...,\pm}{
				\draw (b\r-\i) -- (a\r-\ip) ;
			}
			
\foreach \z in {1,...,\a}{
				\foreach \i/\j/\k/\l/\c in {1/4/1/v/yellow,5/7/2/v_1/orange,8/9/3/v_2/red,10/12/4/v_3/purple}{
					\pgfmathtruncatemacro\ii{(\z - 1) * \n + \i}
					\pgfmathtruncatemacro\jj{(\z - 1) * \n + \j}
					\node[draw, rounded corners=1.8pt, inner sep=1.1pt, fit=(a\r-\ii) (a\r-\jj), fill opacity=0.2, fill=\c] (I\r-\k-\z) {} ;
				}
			}
			
				\node at (-0.4, -\r +1) {$P_u^\r$} ;
		
	
	}
	
\draw (b1-36) to[out=-90,in=50, looseness = 0.22] (a2-1) ;
	\draw (b2-36) to[out=-90,in=45, looseness = 0.2] (a3-1) ;
	
\foreach \i in {b1-10, a1-11, b1-11, b3-10, a3-11, b3-11}{
		\draw[dashed, black] (a2-11) to (\i) ;
	}

	\foreach \i in {a1-19, b1-19, a1-20, a3-19, b3-19, a3-20}{
		\draw[dashed, black] (\i) to  (b2-19) ;
	}
	
	\foreach \i in {b2-34, a2-35, b2-35}{
		\draw[dashed, black] (\i) to (a3-35);
	}
	\foreach \i in {b1-34, a1-35, b1-35}{
		\draw[dashed, black]  (\i) to[out=-45,in=45, looseness = 2] (a3-35) ;
	}
\end{tikzpicture}
  \caption{The gadget $\gad(u)$ for the path $P_u$ of~\cref{fig:Pu} and $b = 3$.
    We drew the non-edges between distinct copies of $P_u$ (dashed edges) incident to only three vertices (one subdivision vertex in $P_u^2$, and two regular vertices in $P_u^2$ and $P_u^3$).
  Each path $P_u^i$ remains induced in~$\gad(u)$.}
  \label{fig:Qu}
\end{figure}



\medskip

\textbf{Construction of $\bm{G^*}$.}
Finally, we construct $G^*$ as follows (based on the vertex set of~$H$, and the edge set of~$G$).
For each vertex $u \in V(H)$, we add a~gadget $\gad(u)$ to $G^*$.  
For every edge $xy \in E(G)$, we add the biclique between $\copies(x)$ and $\copies(y)$ in $G^*$.
If $xy$ is a~matching edge of $G$, the added edges are also said \emph{matching} (see~\cref{fig:gad(u)-adjacencies-matching}).
Similarly if $xy$ is a~dummy edge, we call the added edges \emph{dummy} (see~\cref{fig:gad(u)-adjacencies-dummy}).

\begin{figure}[h!]
  \centering
  \begin{tikzpicture}[
	vertex/.style={draw, circle, minimum size=3pt, inner sep=0pt},
	subd/.style={draw, circle, minimum size=2pt, fill, inner sep=0pt},
	matching/.style={blue, very thick},
	dummy/.style={very thick},
	]
	\def\sc{0.3}
	\def\s{0.4}
	\def\h{1}
	\def\n{12}
	\def\a{3}
	\def\b{3}
	\def\vs{4}
	
	\foreach \r in {1,...,\b}{
		\pgfmathsetmacro\xs{1.58 * \b * \r / \sc}
		
		\begin{scope}[scale=\sc, transform shape, xshift= \xs cm]
\pgfmathtruncatemacro\p{\n * \a}
			\foreach \i in {1,...,\p}{
				\node[vertex] (a\r-\i) at (\i * \s, 0) {} ;
				\node[subd] (b\r-\i) at (\i * \s + \s / 2, 0) {} ;
				\draw (a\r-\i) -- (b\r-\i) ;
			}
			
			\pgfmathtruncatemacro\pm{\p - 1}
			\foreach \i [count = \ip from 2] in {1,...,\pm}{
				\draw (b\r-\i) -- (a\r-\ip) ;
			}
			
\foreach \z in {1,...,\a}{
				\foreach \i/\j/\k/\l/\c in {1/4/1/v/yellow,5/7/2/v_1/orange,8/9/3/v_2/red,10/12/4/v_3/purple}{
					\pgfmathtruncatemacro\ii{(\z - 1) * \n + \i}
					\pgfmathtruncatemacro\jj{(\z - 1) * \n + \j}
					\node[draw, rounded corners=1.8pt, inner sep=1.1pt, fit=(a\r-\ii) (a\r-\jj), fill opacity=0.2, fill=\c] (I\r-\k-\z) {} ;
				}
			}
		\end{scope}
		
		\node at (\xs * \sc + 0.48 * \n * \s, -0.4) {$P_u^\r$} ;
	}
	
\draw (b1-36) -- (a2-1) ;
	\draw (b2-36) -- (a3-1) ;
	
\foreach \r in {1,...,\b}{
		\pgfmathsetmacro\xs{1.58 * \b * \r / \sc}
		
		\begin{scope}[scale=\sc, transform shape, xshift= \xs cm]
\pgfmathtruncatemacro\p{\n * \a}
			\foreach \i in {1,...,\p}{
				\node[vertex] (c\r-\i) at (\i * \s, \vs / \sc) {} ;
				\node[subd] (d\r-\i) at (\i * \s + \s / 2, \vs / \sc) {} ;
				\draw (c\r-\i) -- (d\r-\i) ;
			}
			
			\pgfmathtruncatemacro\pm{\p - 1}
			\foreach \i [count = \ip from 2] in {1,...,\pm}{
				\draw (d\r-\i) -- (c\r-\ip) ;
			}
			
\foreach \z in {1,...,\a}{
				\foreach \i/\j/\k/\l/\c in {1/3/1/v/green!95!blue,4/7/2/v_1/green!65!blue,8/10/3/v_2/green!35!blue,11/12/4/v_3/green!5!blue}{
					\pgfmathtruncatemacro\ii{(\z - 1) * \n + \i}
					\pgfmathtruncatemacro\jj{(\z - 1) * \n + \j}
					\node[draw, rounded corners=1.8pt, inner sep=1.1pt, fit=(c\r-\ii) (c\r-\jj), fill opacity=0.2, fill=\c] (J\r-\k-\z) {} ;
				}
			}
		\end{scope}
		
		\node at (\xs * \sc + 0.48 * \n * \s, \vs + 0.4) {$P_v^\r$} ;
	}
	
\draw (d1-36) -- (c2-1) ;
	\draw (d2-36) -- (c3-1) ;
	
	
\foreach \y in {1,...,\b}{
		\foreach \z in {1,...,\b}{
			\foreach \i in {1,...,4,13,14,...,16,25,26,...,28}{
				\pgfmathtruncatemacro\j{\i+3}
				\draw[thin, blue] (a\y-\i) -- (c\z-\j) ;
			}
		}
	}
\end{tikzpicture}
  \caption{The matching edges between $\gad(u)$ and $\gad(v)$ (with $u$ and $v$ two adjacent vertices in~$H$).}
  \label{fig:gad(u)-adjacencies-matching}
\end{figure}
\begin{figure}[h!]
  \centering
  \begin{tikzpicture}[
	vertex/.style={draw, circle, minimum size=3pt, inner sep=0pt},
	subd/.style={draw, circle, minimum size=2pt, fill, inner sep=0pt},
	matching/.style={blue, very thick},
	dummy/.style={very thick},
	]
	\def\sc{0.3}
	\def\s{0.4}
	\def\h{1}
	\def\n{12}
	\def\a{3}
	\def\b{3}
	\def\vs{4}
	
	\foreach \r in {1,...,\b}{
		\pgfmathsetmacro\xs{1.58 * \b * \r / \sc}
		
		\begin{scope}[scale=\sc, transform shape, xshift= \xs cm]
\pgfmathtruncatemacro\p{\n * \a}
			\foreach \i in {1,...,\p}{
				\node[vertex] (a\r-\i) at (\i * \s, 0) {} ;
				\node[subd] (b\r-\i) at (\i * \s + \s / 2, 0) {} ;
				\draw (a\r-\i) -- (b\r-\i) ;
			}
			
			\pgfmathtruncatemacro\pm{\p - 1}
			\foreach \i [count = \ip from 2] in {1,...,\pm}{
				\draw (b\r-\i) -- (a\r-\ip) ;
			}
			
\foreach \z in {1,...,\a}{
				\foreach \i/\j/\k/\l/\c in {1/4/1/v/yellow,5/7/2/v_1/orange,8/9/3/v_2/red,10/12/4/v_3/purple}{
					\pgfmathtruncatemacro\ii{(\z - 1) * \n + \i}
					\pgfmathtruncatemacro\jj{(\z - 1) * \n + \j}
					\node[draw, rounded corners=1.8pt, inner sep=1.1pt, fit=(a\r-\ii) (a\r-\jj), fill opacity=0.2, fill=\c] (I\r-\k-\z) {} ;
				}
			}
		\end{scope}
		
		\node at (\xs * \sc + 0.48 * \n * \s, -0.4) {$P_u^\r$} ;
	}
	
\draw (b1-36) -- (a2-1) ;
	\draw (b2-36) -- (a3-1) ;
	
\foreach \r in {1,...,\b}{
		\pgfmathsetmacro\xs{1.58 * \b * \r / \sc}
		
		\begin{scope}[scale=\sc, transform shape, xshift= \xs cm]
\pgfmathtruncatemacro\p{\n * \a}
			\foreach \i in {1,...,\p}{
				\node[vertex] (c\r-\i) at (\i * \s, \vs / \sc) {} ;
				\node[subd] (d\r-\i) at (\i * \s + \s / 2, \vs / \sc) {} ;
				\draw (c\r-\i) -- (d\r-\i) ;
			}
			
			\pgfmathtruncatemacro\pm{\p - 1}
			\foreach \i [count = \ip from 2] in {1,...,\pm}{
				\draw (d\r-\i) -- (c\r-\ip) ;
			}
			
\foreach \z in {1,...,\a}{
				\foreach \i/\j/\k/\l/\c in {1/3/1/v/green!95!blue,4/7/2/v_1/green!65!blue,8/10/3/v_2/green!35!blue,11/12/4/v_3/green!5!blue}{
					\pgfmathtruncatemacro\ii{(\z - 1) * \n + \i}
					\pgfmathtruncatemacro\jj{(\z - 1) * \n + \j}
					\node[draw, rounded corners=1.8pt, inner sep=1.1pt, fit=(c\r-\ii) (c\r-\jj), fill opacity=0.2, fill=\c] (J\r-\k-\z) {} ;
				}
			}
		\end{scope}
		
		\node at (\xs * \sc + 0.48 * \n * \s, \vs + 0.4) {$P_v^\r$} ;
	}
	
\draw (d1-36) -- (c2-1) ;
	\draw (d2-36) -- (c3-1) ;
	
	
\foreach \x in {1,...,\b}{
		\foreach \y in {1,...,\a}{
			\foreach \z in {1,...,\a}{
				\foreach \i/\j in {2/1,2/3,2/4, 3/1,3/3,3/4, 4/1,4/3,4/4}{
					\draw[thin] (I2-\i-\y) -- (J\x-\j-\z) ;
				}
			}
		}
	}
\end{tikzpicture}
  \caption{The dummy edges between $\gad(u)$ and $\gad(v)$ of~\cref{fig:gad(u)-adjacencies-matching}.
  An edge between two rounded boxes represents a~biclique between the corresponding vertices of $I(\bullet,\bullet,\bullet)$ (which excludes the subdivision vertices).
  We only represented the bicliques incident to $P_u^2$ ($P_u^1$ and $P_u^3$ have the same adjacencies toward~$\gad(v)$). }
  \label{fig:gad(u)-adjacencies-dummy}
\end{figure}

\subsection{Low linear mim-balancing of~$(G,\mathcal P)$ $\Rightarrow$ low linear-mim width of~$G^*$}\label{sec:lin-mim-balancing-to-lin-mim-width}

To upper bound the linear mim-width of $G^*$, we need the next lemma on~$\gad(u)$.
For each vertex $u$ of $H$, we define the \emph{caterpillar layout} of~$\gad(u)$ as the \emph{left-aligned} caterpillar (i.e, such that every right child is a~leaf) layout with $|V(\gad(u))|$ leaves bijectively labeled by $V(\gad(u))$, in the order of~$Q_u$ from the first vertex of $P_u^1$ to the last vertex of $P_u^b$.

\begin{lemma}\label{lem:mim-value:gadget}
Let $u$ be a vertex of $H$, and $(C,f)$ be the caterpillar layout of $\gad(u)$. 
For every cut $(A,B)$ of $\gad(u)$ induced by an edge of $C$, the mim-value of $(A,B)$ is at most 7.
\end{lemma}
\begin{proof}\textcolor{red}{TOPROVE 16}\end{proof}

We can now conclude for this direction of the reduction.

\begin{lemma}
If $(H, \omega)$ admits a~$\tau$-balancing order, then the linear mim-width of $G^*$ is at~most $\frac{a+1}{a} \tau + 107$.
\end{lemma}
\begin{proof}\textcolor{red}{TOPROVE 17}\end{proof}


\subsection{Low sim-width of $G^*$ $\Rightarrow$ low sim-balancing of~$(G,\mathcal P)$}\label{sec:sim-width-to-sim-balancing}




The main argument works as follows.
We will prove that in any tree layout of $G^*$ of small sim-value, one can associate to each gadget $\gad(u)$ an edge $e$ of the layout, such that a~copy of $P_u$ can be found on both sides of the cut defined by $e$.
Since $\gad(u)$ is ``represented'' by any of its copies of $P_u$, we will use $e$ as where the vertices of~$\gad(u)$ should be moved to.
With this in mind, we gradually build a~\tmap of $G$ from a~tree layout of $G^*$ by ``relocating'' each gadget to the edge it is associated to.

We start with two technical lemmas.

\begin{lemma}\label{lem:cut-doesnt-cut}
Let $P_1, \dots, P_k$ be $k$ paths with $k > t \cdot \max_{i \in [k]} |V(P_i)|$ such that for any $i \neq j \in [k]$ and any $\ell \in [\min(|V(P_i)|,|V(P_j)|)-1]$, the $\ell$-th edge of $P_i$ is mutually induced with the $\ell$-th edge of $P_j$.
Then for any cut $(A, B)$ of sim-value at most $t$, there exists at least one path $P_i$ such that $V(P_i)\subseteq A$ or $V(P_i)\subseteq B$.
\end{lemma}
\begin{proof}\textcolor{red}{TOPROVE 18}\end{proof}

\begin{lemma}\label{lem:tricut-doesnt-cut}
Let $P_1, \dots, P_k$ be $k$ paths with $k > \left \lceil \frac{3t}{2} \right \rceil \cdot \max_{i \in [k]} |V(P_i)|$ such that for any $i \neq j \in [k]$ and any $\ell \in [\min(|V(P_i)|,|V(P_j)|)-1]$, the $\ell$-th edge of $P_i$ is mutually induced with the $\ell$-th edge of $P_j$.
Then for any tripartition $(A, B, C)$ of $V(P_1) \cup \ldots \cup V(P_k)$ such that the cuts $(A,B \cup C)$, $(B,A \cup C)$ and $(C, A \cup B)$ have sim-value at most $t$, there exists at least one path $P_i$ such that $V(P_i)$ is included in one set among $A$, $B$ and $C$.
\end{lemma}
\begin{proof}\textcolor{red}{TOPROVE 19}\end{proof}

A \emph{\htree} of a~partitioned graph $(J, \mathcal P)$ is pair $(T, f)$ where $T$ is a tree and $f \colon V(J) \rightarrow V(T)$ is a~map such that for any node $t \in T$, either $f^{-1}(t) \in \mathcal P$ or $|f^{-1}(t)| \le 1$.
As for \tmaps each edge $e \in E(T)$ in a \htree of $(J, \mathcal P)$ defines a cut $(A_e, B_e)$ of $J$: the sets of vertices mapped to each component of $T-e$.
The sim-value of the \htree $(T, f)$ is the maximum sim-value of all possible cuts $(A_e, B_e)$ for $e \in E(T)$.

We recall that $\mathcal S^* = \{V(\gad(u))~:~u \in V(H)\}$.
We observe that in the instances $(H,\weight)$ produced by the first reduction, every vertex has weight at most~$2 \tau$.
Hence $\max_{u \in V(H)} |V(P_u)| \leq 4 \tau$.
We set $\alpha := \lceil \frac{b-1}{6 \tau} \rceil - 1 = \tau + \gamma - 1$, where $b$ is the constant introduced at the beginning of the section.

\begin{lemma}\label{lem:default-edge}
Let $(T, f)$ be a~\htree of $(G^*, \mathcal S^*)$ of sim-value at~most~$\alpha$ and $T$ subcubic.
Then, for any vertex $u$ of $H$, either
\begin{compactitem}
\item there exists $t \in V(T)$ with $f^{-1}(t) = V(\gad(u))$, or
\item there exists an edge $e \in E(T)$ such that in the cut $(A_e, B_e)$ induced by $e$ in $G^*$, one can find a copy of $P_u$ in both $A_e$ and $B_e$.
\end{compactitem}
\end{lemma}

\begin{proof}\textcolor{red}{TOPROVE 20}\end{proof}

\newcommand{\group}{\text{group}}

We now define a \emph{grouping} operation on triples $(T, f, u)$, where $(T, f)$ is a subcubic \htree of $(G^*, \mathcal S^*)$ of sim-value smaller than $\frac{2(b-1)}{3\max_{u \in V(H)}|V(P_u)}$ (which is still very large compared to $\tau + \gamma$ by definition of $b$) and $u \in V(H)$, and denote it by $\group(T, f, u)$.
If there exists $t \in V(T)$ with $f^{-1}(t) = \gad(u)$, then we set $\group(T, f, u) := (T, f)$.
Otherwise, \Cref{lem:default-edge} ensures that there is an edge $e \in E(T)$ such that a copy of $P_u$ is in both sides of the cut defined by $e$.
We then define $\group(T, f, u) := (T', f')$, where
\begin{compactitem}
  \item $T'$ is obtained from $T$ by subdividing $e$, which adds a~node, say, $t_e$, and
  \item $f'$ satisfies that $f'(x) = f(x)$ whenever $x \not \in V(\gad(u))$, and $f'(x) = t_e$ otherwise.
\end{compactitem}
Given an edge $e' \in E(T')$, the edge \emph{corresponding to} $e'$ in $T$ is $e'$ if $e'$ is an edge of $T$, and $e$ if $e'$ is incident to $t_e$.

We make two observations on the grouping operation.

\begin{observation}\label{obs:subcubic}
For any subcubic \htree $(T, f)$ of $(G^*, \mathcal S^*)$ and any $u \in V(H)$, $\group(T, f, u)$ is a subcubic \htree of $(G^*, \mathcal S^*)$. 
\end{observation}

\begin{observation}\label{rmk:corresponding-cuts}
Let $(T, f)$ be a~subcubic \htree of $(G^*, \mathcal S^*)$ and $u \in V(H)$.
Let $(T', f') := \group(T, f, u)$, $e \in E(T)$, and $e' \in E(T')$ corresponds to~$e$ in~$T$.
Then if $(A_e, B_e)$ and $(A_{e'}, B_{e'})$ are the cuts of~$G^*$ defined by $e$ and $e'$, respectively, we have
\begin{compactitem}
	\item $A_{e'} \setminus V(\gad(u)) = A_e \setminus V(\gad(u))$, 
	\item $B_{e'} \setminus V(\gad(u)) = B_e \setminus V(\gad(u))$, 
	\item $V(\gad(u)) \subseteq A_{e'}$ implies that $A_e$ contains a copy of $P_u$, and 
        \item $V(\gad(u)) \subseteq B_{e'}$ implies that $B_e$ contains a copy of $P_u$.
\end{compactitem}
\end{observation}

We can next show that a~grouping can only decrease the sim-value. 

\begin{lemma}\label{lem:dec-sim-value}
For any subcubic \htree $(T, f)$ of $(G^*, \mathcal S^*)$ and any $u \in V(H)$, the~sim-value of $\group(T, f, u)$ is at~most that of $(T, f)$.
\end{lemma}
\begin{proof}\textcolor{red}{TOPROVE 21}\end{proof}

We are now equipped to turn \htrees $G^*$ into \tmaps of $G^*$ no greater sim-value.





\begin{lemma}\label{lem:htree-to-tmap}
  If  $(G^*, \mathcal S^*)$ admits tree layout$(T,f)$ of sim-value at most $\alpha$, then $(G^*, \mathcal S^*)$ admits a~\tmap $(T',f')$ of sim-value at most the sim-value of $(T,f)$.
\end{lemma}
\begin{proof}\textcolor{red}{TOPROVE 22}\end{proof}

We can conclude.

\begin{lemma}
  Let $(T, f)$ be a~tree layout witnessing that the sim-width of $G^*$ is at~most~$\tau+\gamma$.
  Then the tree sim-balancing of $(G,\mathcal S)$ is at~most $\tau+\gamma$.
\end{lemma}
\begin{proof}\textcolor{red}{TOPROVE 23}\end{proof}



\begin{thebibliography}{10}

\bibitem{BelmonteV13}
R{\'{e}}my Belmonte and Martin Vatshelle.
\newblock Graph classes with structured neighborhoods and algorithmic
  applications.
\newblock {\em Theor. Comput. Sci.}, 511:54--65, 2013.
\newblock URL: \url{https://doi.org/10.1016/j.tcs.2013.01.011}, \href
  {https://doi.org/10.1016/J.TCS.2013.01.011}
  {\path{doi:10.1016/J.TCS.2013.01.011}}.

\bibitem{BergougnouxDJ23}
Benjamin Bergougnoux, Jan Dreier, and Lars Jaffke.
\newblock A logic-based algorithmic meta-theorem for mim-width.
\newblock In Nikhil Bansal and Viswanath Nagarajan, editors, {\em Proceedings
  of the 2023 {ACM-SIAM} Symposium on Discrete Algorithms, {SODA} 2023,
  Florence, Italy, January 22-25, 2023}, pages 3282--3304. {SIAM}, 2023.
\newblock URL: \url{https://doi.org/10.1137/1.9781611977554.ch125}, \href
  {https://doi.org/10.1137/1.9781611977554.CH125}
  {\path{doi:10.1137/1.9781611977554.CH125}}.

\bibitem{BergougnouxKR23}
Benjamin Bergougnoux, Tuukka Korhonen, and Igor Razgon.
\newblock New width parameters for independent set: One-sided-mim-width and
  neighbor-depth.
\newblock In Dani{\"{e}}l Paulusma and Bernard Ries, editors, {\em
  Graph-Theoretic Concepts in Computer Science - 49th International Workshop,
  {WG} 2023, Fribourg, Switzerland, June 28-30, 2023, Revised Selected Papers},
  volume 14093 of {\em Lecture Notes in Computer Science}, pages 72--85.
  Springer, 2023.
\newblock \href {https://doi.org/10.1007/978-3-031-43380-1\_6}
  {\path{doi:10.1007/978-3-031-43380-1\_6}}.

\bibitem{BergougnouxPT22}
Benjamin Bergougnoux, Charis Papadopoulos, and Jan~Arne Telle.
\newblock Node multiway cut and subset feedback vertex set on graphs of bounded
  mim-width.
\newblock {\em Algorithmica}, 84(5):1385--1417, 2022.
\newblock URL: \url{https://doi.org/10.1007/s00453-022-00936-w}, \href
  {https://doi.org/10.1007/S00453-022-00936-W}
  {\path{doi:10.1007/S00453-022-00936-W}}.

\bibitem{Darmann20}
Andreas Darmann and Janosch D{\"{o}}cker.
\newblock {On a simple hard variant of Not-All-Equal 3-Sat}.
\newblock {\em Theor. Comput. Sci.}, 815:147--152, 2020.
\newblock URL: \url{https://doi.org/10.1016/j.tcs.2020.02.010}, \href
  {https://doi.org/10.1016/J.TCS.2020.02.010}
  {\path{doi:10.1016/J.TCS.2020.02.010}}.

\bibitem{Eiben22}
Eduard Eiben, Robert Ganian, Thekla Hamm, Lars Jaffke, and O{-}joung Kwon.
\newblock A unifying framework for characterizing and computing width measures.
\newblock In Mark Braverman, editor, {\em 13th Innovations in Theoretical
  Computer Science Conference, {ITCS} 2022, January 31 - February 3, 2022,
  Berkeley, CA, {USA}}, volume 215 of {\em LIPIcs}, pages 63:1--63:23. Schloss
  Dagstuhl - Leibniz-Zentrum f{\"{u}}r Informatik, 2022.
\newblock URL: \url{https://doi.org/10.4230/LIPIcs.ITCS.2022.63}, \href
  {https://doi.org/10.4230/LIPICS.ITCS.2022.63}
  {\path{doi:10.4230/LIPICS.ITCS.2022.63}}.

\bibitem{Impagliazzo01}
Russell Impagliazzo and Ramamohan Paturi.
\newblock {On the Complexity of k-SAT}.
\newblock {\em J. Comput. Syst. Sci.}, 62(2):367--375, 2001.
\newblock \href {https://doi.org/10.1006/jcss.2000.1727}
  {\path{doi:10.1006/jcss.2000.1727}}.

\bibitem{sparsification}
Russell Impagliazzo, Ramamohan Paturi, and Francis Zane.
\newblock Which problems have strongly exponential complexity?
\newblock {\em J. Comput. Syst. Sci.}, 63(4):512--530, 2001.
\newblock \href {https://doi.org/10.1006/jcss.2001.1774}
  {\path{doi:10.1006/jcss.2001.1774}}.

\bibitem{JaffkeKST19}
Lars Jaffke, O{-}joung Kwon, Torstein J.~F. Str{\o}mme, and Jan~Arne Telle.
\newblock Mim-width {III.} graph powers and generalized distance domination
  problems.
\newblock {\em Theor. Comput. Sci.}, 796:216--236, 2019.
\newblock URL: \url{https://doi.org/10.1016/j.tcs.2019.09.012}, \href
  {https://doi.org/10.1016/J.TCS.2019.09.012}
  {\path{doi:10.1016/J.TCS.2019.09.012}}.

\bibitem{JaffkeKT20}
Lars Jaffke, O{-}joung Kwon, and Jan~Arne Telle.
\newblock {Mim-Width I. Induced path problems}.
\newblock {\em Discret. Appl. Math.}, 278:153--168, 2020.
\newblock URL: \url{https://doi.org/10.1016/j.dam.2019.06.026}, \href
  {https://doi.org/10.1016/J.DAM.2019.06.026}
  {\path{doi:10.1016/J.DAM.2019.06.026}}.

\bibitem{OtachiST24}
Yota Otachi, Akira Suzuki, and Yuma Tamura.
\newblock Finding induced subgraphs from graphs with small mim-width.
\newblock In Hans~L. Bodlaender, editor, {\em 19th Scandinavian Symposium and
  Workshops on Algorithm Theory, {SWAT} 2024, June 12-14, 2024, Helsinki,
  Finland}, volume 294 of {\em LIPIcs}, pages 38:1--38:16. Schloss Dagstuhl -
  Leibniz-Zentrum f{\"{u}}r Informatik, 2024.
\newblock URL: \url{https://doi.org/10.4230/LIPIcs.SWAT.2024.38}, \href
  {https://doi.org/10.4230/LIPICS.SWAT.2024.38}
  {\path{doi:10.4230/LIPICS.SWAT.2024.38}}.

\bibitem{SaetherV15}
Sigve~Hortemo S{\ae}ther and Martin Vatshelle.
\newblock Hardness of computing width parameters based on branch decompositions
  over the vertex set.
\newblock {\em Electron. Notes Discret. Math.}, 49:301--308, 2015.
\newblock URL: \url{https://doi.org/10.1016/j.endm.2015.06.041}, \href
  {https://doi.org/10.1016/J.ENDM.2015.06.041}
  {\path{doi:10.1016/J.ENDM.2015.06.041}}.

\bibitem{SaetherV16}
Sigve~Hortemo S{\ae}ther and Martin Vatshelle.
\newblock Hardness of computing width parameters based on branch decompositions
  over the vertex set.
\newblock {\em Theor. Comput. Sci.}, 615:120--125, 2016.
\newblock URL: \url{https://doi.org/10.1016/j.tcs.2015.11.039}, \href
  {https://doi.org/10.1016/J.TCS.2015.11.039}
  {\path{doi:10.1016/J.TCS.2015.11.039}}.

\bibitem{Vatshelle12}
Martin Vatshelle.
\newblock New width parameters of graphs.
\newblock 2012.

\end{thebibliography}

\end{document}

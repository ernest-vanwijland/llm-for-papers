\documentclass[a4paper,11pt]{article}
\newcommand\hmmax{0}
\newcommand\bmmax{0}

\usepackage[font=bera]{chihao}

\renewcommand{\norm}[1]{\left\|#1\right\|}



\usepackage[margin=1in]{geometry}
\usepackage[affil-it]{authblk}

\newcommand{\DTV}{\!{TV}}
\newcommand{\pin}{\leftarrow}
\newcommand{\notpin}{\not\leftarrow}
\newcommand{\W}[1]{\+W_1\left(#1\right)}


\newcommand{\yltodo}[1]{\todo[color=cyan!40,size=\tiny]{\textbf{YL:} #1}}
\newcommand{\zhtodo}[1]{\todo[color=green!40,size=\tiny]{\textbf{ZH:} #1}}
\newcommand{\zjtodo}[1]{\todo[color=blue!40,size=\tiny]{\textbf{ZJ:} #1}}



\title{Decay of correlation for edge colorings when $q>3\Delta$}

\author[1]{Zejia Chen}
\author[1]{Yulin Wang}
\author[1]{Chihao Zhang}
\author[2]{Zihan Zhang}
\affil[1]{Shanghai Jiao Tong University}
\affil[2]{Graduate Institute for Advanced Studies, SOKENDAI}





\begin{document}
\maketitle

\begin{abstract}
    We examine various perspectives on the decay of correlation for the uniform distribution over proper $q$-edge colorings of graphs with maximum degree $\Delta$.

    First, we establish the coupling independence property when $q\ge 3\Delta$ for general graphs. Together with the recent work of Chen, Feng, Guo, Zhang and Zou (2024), this result implies a fully polynomial-time approximation scheme (\textbf{FPTAS}) for counting the number of proper $q$-edge colorings. 

    Next, we prove the strong spatial mixing property on \emph{trees}, provided that $q> (3+o(1))\Delta$. The strong spatial mixing property is derived from the spectral independence property of a version of the weighted edge coloring distribution, which is established using the matrix trickle-down method developed in Abdolazimi, Liu and Oveis Gharan (FOCS, 2021) and Wang, Zhang and Zhang (STOC, 2024).

    Finally, we show that the weak spatial mixing property holds on trees with maximum degree $\Delta$ if and only if $q\ge 2\Delta-1$.
\end{abstract}

\setcounter{tocdepth}{1}
\tableofcontents
\newpage


\section{Introduction}

Sampling from the uniform distribution of proper edge colorings received lots of attention recently, with the advent of new tools in analyzing high-dimensional distributions~\cite{DHP20,ALOG21,WZZ24,CCFV25}. A proper edge coloring of an undirected graph with maximum degree $\Delta$ is an assignment of each edge with one of $q$ colors so each adjacent edges receive different color. Clearly a proper \emph{edge} coloring can be viewed as a proper \emph{vertex} coloring on its line graph.The sampling problem is to draw a proper edge coloring uniformly. Most of previous work focuses on the mixing time of Glauber dynamics. The work of~\cite{WZZ24} established the spectral independence property, a notion to measure the correlation in high-dimensional distributions~\cite{ALO21}, whenever $q>(2+o(1))\Delta$ for general graphs and the work of~\cite{CCFV25} establish approximate tensorization of variance on trees when $q\ge \Delta+1$. Note that Glauber dynamics is known to be reducible when $q<2\Delta$ on general graphs~\cite{MJNP19} and therefore the $q>(2+o(1))\Delta$ condition for Glauber dynamics is asymptotically tight. However, it is still open whether $q\approx 2\Delta$ is the threshold for efficient sampling proper edge colorings and there are some recent attempts to design other sampling algorithm under better conditions~\cite{DKLP25}. A (almost) uniformly sampling algorithm can be turned into fully polynomial-time randomized scheme (\textbf{FPRAS}) for counting the number of proper colorings using standard reduction~\cite{JVV86}. 

In this work we examine some other aspects for the correlation of the uniform distribution on edge colorings. We first established the \emph{coupling independence} property on general graphs when $q\ge 3 \Delta$. Coupling independence~\cite{CZ23} is a notion stronger than spectral independence, and thanks to recent work of~\cite{CFGZZ24}, building on the machinery of Moitra~\cite{Moitra19}, it (together with some other properties) implies a fully polynomial-time approximate scheme (\textbf{FPTAS}) for counting proper edge colorings. This is the first \emph{determinstic} approximate counting algorithm in this range of parameters. Moreover, our proof of the coupling independence property differs from those directly derived from contractive couplings for establishing rapid mixing results.


\begin{theorem}[Informal] \label{thm:FPTAS-informal}
    If $q\geq 3\Delta$, then there exists an \textbf{FPTAS} for counting the number of proper $q$-edge colorings on any graph $G$ with maximum degree $\Delta$.
\end{theorem}
Before our work, there is no similar results tailored for counting edge colorings. The best \textbf{FPTAS} for counting edge coloring is the same as the one for general vertex coloring, which requires $q>3.618\Delta$~\cite{CV25,CFGZZ24} for sufficiently large $\Delta$.

We then study the strong spatial mixing (SSM) property for edge colorings on \emph{trees}, an important notion to measure the correlation between sites in Gibbs distributions whose definition is in \Cref{sec:prelim-decay}.



\begin{theorem}[Informal]\label{thm:SSM-informal}
    Let $T$ be a tree with maximum degree $\Delta$. If $q\geq (3+o(1))\Delta$, then the uniform distribution over $q$-colorings on $T$ exhibits strong spatial mixing with exponential decay rate.
\end{theorem}

Similar strong spatial mixing bounds on trees have been thoroughly studied for vertex colorings (e.g.~\cite{EGHSV19,CLMM23}). It is conjectured that SSM holds whenever $q\ge \Delta+1$ and in~\cite{CLMM23}, a $q\ge \Delta+3$ condition was established, almost resolving the conjecture. However, much less is known for edge colorings. 
The $q>(3+o(1))\Delta$ bound established in this work is by no means tight. We also discuss the limit of our approach and possible further improvement. On the other hand, we show that one cannot expect the strong spatial mixing property to hold when $q<2\Delta$, as we prove that $2\Delta-1$ is the threshold for \emph{weak spatial mixing}. Therefore, we conjecture that SSM holds for edge colorings on graphs with maximum degree $\Delta$ whenever $q\ge 2\Delta+\gamma$ for certain constant $\gamma$. We also show that the best bound one can expect using the analysis in this paper cannot be better than $q\approx 2.618\Delta$.

\begin{theorem}[Informal]\label{thm:WSM-informal}
    If $q\geq 2\Delta-1$, then the uniform distribution over $q$-colorings on any tree with maximum degree $\Delta$ exhibits weak spatial mixing with exponential decay rate. Otherwise, there exists a tree with maximum degree $\Delta$ such that the uniform distribution over $q$-coloring on it does not satisfy the weak spatial mixing property.
\end{theorem}
In the following, we give an overview with our technique, with an emphasis on the novelty.

\subsection{Technical contribution}

\paragraph{A new coupling strategy}

The coupling independence property is established via a new local coupling for edge colorings. Our coupling can somehow be viewed as a multi-spin version of Chen and Gu's coupling~\cite{CG24} for Holant problems with boolean domain. Their coupling, using the problem of $b$-matching as an example, begins with two instances differing at one pendant edge, or equivalently, two instances with a single constraint discrepancy. During the coupling process, the number of discrepancies can never increase but has a nonzero probability of decreasing to zero. Therefore, the coupling process terminates in expected constant number of steps. 

In the problem of edge coloring, we can design a local coupling starting from a single discrepancy so that the number of discrepancies can either increase to two, decrease to zero, or remain unchanged. We then use marginal probability bounds to control the probability of discrepancy increasing, while ensuring that the number of discrepancies decreases in expectation. 

\paragraph{Dimension reduction}

We establish the strong spatial mixing property on trees by analyzing marginal recursions, which is similar to~\cite{CLMM23}. However, unlike previous work for spin systems where the marginal on a single site is considered, we study the recursion for marginals on a ``broom'', namely all edges incident to the root. For each partial coloring on the broom, we can represent its marginal as a function of marginal probabilities of partial colorings in subtrees. However, the Jacobian matrix of this system can be as large as $q^\Delta \times \Delta q^\Delta$, and is technically very hard to analyze. Our key observation is that the Jacobian matrix is of low rank, and therefore we can apply a trace trick to bound its $2$-norm by the norm of a much smaller matrix. We call this step \emph{dimension reduction}.

\paragraph{From spectral independence to strong spatial mixing}

It is still challenging to directly bound the $2$-norm of the small matrix. We then observe that it can be written as the product of certain covariance matrices of marginal distributions on brooms. Therefore, ideally we can apply the known bounds for these covariance matrices, or equivalently the spectral independence bound for these marginals. However, these marginal probabilities are from the distribution of certain ``weighted edge colorings'' and one cannot directly apply previous spectral independence result for edge colorings. As a result, we apply the machinery of matrix trickle-down developed in~\cite{ALOG21} in the way of~\cite{WZZ24} to establish the desired spectral independence result. 

\paragraph{Top-down analysis of recursion}

There is another subtle technical issue in the above approach. When analyzing the contraction of marginal recursion, one needs to analyze the gradient / Jacobian at certain ``midpoint'' between two boundary conditions due to the application of fundamental theorem of calculus or mean-value theorem in the analysis. These midpoints, however, are not necessarily probabilities because the recursion may involve a potential function\footnote{Theses quantities are referred to as ``subdistributions'' in~\cite{CLMM23}}. In previous work, only certain marginal bounds are used to prove the contraction, and these bounds are also satisfied by the midpoints. However, in our case, we require these midpoints to satisfy refined properties, such as spectral independence, which does not hold in general. Therefore, we cannot apply the recursion in the traditional bottom-to-top manner, where one fixes the boundary value at level $L$, analyze the contraction at level $L-1$, then fixes boundary value at level $L-1$ and analyze the contraction at level $L-2$, and so on. Instead, we only fix boundary value at the leaves and analyze the composition of the recursion at each level as a whole. Therefore, we need to take ``midpoints'' only at the leaves, which defines our ``weighted edge coloring'' instance. Its spectral independence property can be established by the matrix trickle-down method, as discussed earlier.


\subsection{Organization of the paper}

After introducing the necessary preliminaries in \Cref{sec:prelim}, we give the marginal recursions and prove useful marginal bounds in \Cref{sec:marginals}. Then we present our proof of coupling independence, which implies the \textbf{FPTAS}, in \Cref{sec:FPTAS}. Strong spatial mixing on trees is proved in \Cref{sec:ssm} and the results of weak spatial mixing are proved in \Cref{sec:wsm}. In \Cref{sec:covariance}, we prove the spectral independence property for weighted edge coloring that will be used in the proof of strong spatial mixing.

 \newcommand{\dist}{\-{dist}}

\section{Preliminaries}\label{sec:prelim}
We use the following notations. For any $a, b\in \mathbb R$, let $
    a\wedge b\defeq \min\set{a, b}$, $
    a\vee b\defeq \max\set{a, b}$. For any two non-negative integers $a\ge b$, let $a^{\underline{b}}$ be the falling factorial, i.e. $a^{\underline{b}}=\prod_{i=a-b+1}^a i$.
Let $\!{Id}$ denote the identity matrix. For a function $f\colon \Omega\to\bb R$ defined on a finite domain $\Omega$, we use $\Big[f(x)\Big]_{x\in\Omega}$ to denote the corresponding (column) vector in $\bb R^{\Omega}$. For any set $S$ and an element $x\in S$, we write $S-x$ for $S\setminus \set{x}$.

For two probability measures $\mu, \nu$ on the same probability space $\Omega$, we define $\|\mu-\nu\|_{\-{TV}}=\frac{1}{2} \sum_{\omega \in \Omega}|\mu(\omega)-\nu(\omega)|=\sup _{A \subseteq \Omega}|\mu(A)-\nu(A)|$ for the total variation distance between $\mu, \nu$. If $\mu, \nu$ are two probability distributions on finite state spaces $\Omega_1, \Omega_2$ respectively, then we say $\omega$ is a coupling of $\mu, \nu$ when it is a joint distribution on $\Omega_1 \times \Omega_2$ with $\mu, \nu$ as its marginals, i.e. $\mu(x)=\sum_{y \in \Omega_2} \omega(x, y)$ and $\nu(y)=\sum_{x \in \Omega_1} \omega(x, y)$ for every $x \in \Omega_1, y \in \Omega_2$.

Given a graph $G=(V,E)$, for any vertex $v\in V$, let $E(v)= \set{e\in E \mid  v\in e}$ and $\deg(v)=\abs{E(v)}$ be the degree of $v$; for any edge $e \in E$, let $\deg(e)$ be the degree of $e$, which is the number of edges adjacent to $e$. Moreover, we write $\deg(G)$ for the maximum (vertex) degree in $G$.
For  two edges $e,e'\in E$, we write $\dist_G(e, e')$ for the length of the shortest path between them in $G$ (not containing $e,e'$) and $\dist_G(e, e') = \infty$ if $e$ and $e'$ is disconnected. 
Similarly, for vertices $v,v'\in V$, $\dist_G(v,v')$ is the shortest path between them in $G$ and $\dist_G(v, v') = \infty$ if $v$ and $v'$ is disconnected.

\subsection{List edge coloring}
Fix a color set $[q]=\set{1, 2, \dots, q}$ where $q\in\bb N$. Let $G=(V,E)$ be an undirected graph and $\+L=\set{\+{L}(e)\subseteq[q]\cmid e\in E}$ be a collection of color lists associated with each edge in $E$. The pair $(G, \+L)$  is an instance of list edge coloring. 

If $\+L(e)=[q]$ for any $e\in E$, we say $(G,\+L)$ is a $q$-edge coloring instance.  If $\abs{\+L(e)}\geq \deg(e)+\beta$ for any $e\in E$, we say $(G,\+L)$ is a $\beta$-extra edge coloring instance. We say $\sigma:E\rightarrow [q]$ is a proper edge coloring if $\sigma(e) \in \+L(e)$ for any $e\in E$ and $\sigma(e_1)\neq \sigma(e_2)$ for any $e_1\cap e_2 \neq \emptyset$. Let $\Omega$ denote the set of all proper edge colorings and $\mu$ be the uniform distribution on $\Omega$. 

Let $\Lambda\subseteq E$ and $\tau\in [q]^\Lambda$. We say $\tau$ is a proper partial edge coloring on $\Lambda$ if it is a proper coloring on $(G[\Lambda],\+L|_\Lambda)$ where $G[\Lambda]$ is the subgraph of $G$ induced by $\Lambda$ and $\+L|_{\Lambda}=\set{\+L(e)\in \+L\cmid E\in \Lambda}$. Let $\Omega^\tau$ be the set of all proper edge colorings on $E$ that is compatible with $\tau$, i.e. $\Omega^\tau = \set{\sigma \in \Omega\mid \tau \subset \sigma}$ . We also define $\mu^\tau$ on $\Omega$ which is supported on $\Omega^\tau$ as $\mu^\tau(\cdot) = \Pr[\sigma \sim \mu]{\sigma=\cdot \mid \tau \subset \sigma}$.
For a subset $S\subseteq E\setminus \Lambda$ and a partial coloring $\omega$ on $S$, define $\Omega^\tau_S$ as the set of all proper partial edge colorings on $S$ that is compatible with
$\tau$ and $\mu^\tau_S(\omega)=\Pr[\sigma\sim \mu]{\omega \subset \sigma \mid \tau \subset \sigma}$. Especially, when $\Lambda=\set{i}$ and $\tau(i)=c$, we write the conditional distribution and the conditional marginal distribution by $\mu^{i\leftarrow c}$ and $\mu^{i\leftarrow c}_S$. Besides, we define the color lists after pinning  $\tau$ by $\+L^\tau$ such that for any $e\in E\setminus\Lambda$, $\+L^\tau(e)=\set{c\in \+L(e)\mid \mu^\tau_e(c)>0}$ and the degree after pinning by $\deg^\tau(e) = \abs{\set{e\cup f \neq \emptyset\mid f \in E\setminus \Lambda}}$.

For a given list edge coloring instance $(G,\+L)$, let $Z_{G,\+L}(M)$ denote the number of proper colorings with the condition $M$ satisfied, (or event $M$ happens) and $\Pr[G,\+L]{M}$ denote the probability that the condition $M$ is satisfied when a proper coloring is drawn uniformly at random. For an edge set $F\subseteq E$, we usually use $c(F)$ to denote the partial coloring on $F$. With a little abuse of notation, $c(F)$ is sometimes referred to as the set of colors used on $F$.
For a color $a$, we write $a\in F, a\notin F$ as shorthands for $a\in c(F), a\notin c(F)$ respectively.

\subsection{The Wasserstein distance}
In this work, we restrict our discussions and terminologies to finite probability spaces without invoking general measure theory. 

\begin{definition}[Wasserstein distance]
    Let $\mu, \nu$ be two distributions defined on the same finite set $\Omega$ equipped with a metric $d(\cdot, \cdot)$. We define $\Gamma(\mu, \nu)$ as the set of couplings of $\mu$ and $\nu$. Then the \emph{Wasserstein ($1$-)distance} is defined by
    \[
    \W{\mu, \nu} \defeq
    \inf_{\tau\in \Gamma(\mu, \nu)} \E[(x, y)\sim \tau]{d(x, y)}.
    \]
\end{definition}


In this paper, our metric $d$ is always the Hamming distance. For two configurations $\sigma, \tau$ on $[q]^V$, their Hamming distance is defined as $d(\sigma, \tau)=\abs{\set{v \in V \mid \sigma(v)\neq \tau(v)}}$. We define the notion of coupling independence for Gibbs distribution here.
\begin{definition}[Coupling independence]
    We say a Gibbs distribution $\mu$ over $[q]^V$ satisfies $C$-coupling independence if for any two partial configurations $\sigma, \tau \in [q]^\Lambda$ on $\Lambda \subseteq V$ such that $d(\sigma, \tau)=1$,
    $$
\W{\mu^\sigma, \mu^\tau} \leq C
$$
where $\mu^\sigma$ and $\mu^\tau$ denote the Gibbs distribution conditional on $\sigma$ and $\tau$, respectively.
\end{definition}

We will use the following inequality w.r.t Wasserstein distance in later proof.
\begin{proposition}\label{prop:coupling-convex-decomposition}
    Let $\mu, \nu$ be arbitrary distributions on a common finite metric space $(\Omega, d)$.
    If there exists non-negative constants $\lambda_i, 1\le i\le k$
    and distributions $\set{\mu_i}_{1\le i\le k}$, $\set{\nu_i}_{1\le i\le k}$ on $\Omega$ such that
    \[
    \mu - \nu = \sum_{i=1}^k\lambda_i\cdot(\mu_i - \nu_i),
    \]
    where we regard both sides as functions on $\Omega$.
    Then
    \[
    \W{\mu, \nu} \le \sum_{i=1}^k \lambda_i{\W{\mu_i, \nu_i}}.
    \]
\end{proposition}
\begin{proof}\textcolor{red}{TOPROVE 0}\end{proof}

\subsection{Correlation Decay}\label{sec:prelim-decay}
Correlation decay refers to the phenomenon that the correlation between the color assignments of edges diminishes as their distance in the graph increases. Specifically, there are two primary notions of correlation decay: strong spatial mixing and weak spatial mixing. These two notions differ in how they measure the ``distance'' over which the correlation should decay.
\begin{definition}[Strong spatial mixing]\label{def:SSM}
    The Gibbs distribution $\mu$ of the list edge coloring instance $(G = (V,E), \+L)$ satisfies \textit{strong spatial mixing (SSM)} with exponential decay rate $1 - \delta$ and constant $C = C(q,\Delta)$ if for any $e \in E$, every subset $\Lambda \subseteq E\setminus \{e\}$ and every pair of feasible pinning $\tau_1,\tau_2$ on $\Lambda$ which differ on $\partial_{\tau_1,\tau_2} = \set{e\in \Lambda\mid \tau_1(e)\neq \tau_2(e)}$, we have that
    $$
        \|\mu_{e}^\sigma - \mu_e^\tau\|_{\-{TV}} \leq C(1 - \delta)^K
    $$
    where $K = \min_{e'\in \partial_{\tau_1,\tau_2}}\-{dist}_{G}(e,e')$.
\end{definition}
\begin{definition}[Weak spatial mixing]\label{def:WSM}
    The Gibbs distribution $\mu$ of the list edge coloring instance $(G = (V,E), \+L)$ satisfies \textit{weak spatial mixing (WSM)} with exponential decay rate $1 - \delta$ and constant $C = C(q,\Delta)$ if for any $e \in E$, every subset $\Lambda \subseteq E\setminus \{e\}$ and every pair of feasible pinning $\sigma,\tau$ on $\Lambda$, we have that
    $$
        \|\mu_{e}^\sigma - \mu_e^\tau\|_{\-{TV}} \leq C(1 - \delta)^K
    $$
    where $K = \min_{e'\in \Lambda}\-{dist}_{G}(e,e')$.
\end{definition}
\begin{remark}
    When defining Strong Spatial Mixing (SSM) and Weak Spatial Mixing (WSM) for individual problem instances, it is technically possible to choose a constant $C$ large enough to satisfy the decay inequality since the instance is finite. For SSM/WSM to meaningfully imply algorithmic tractability, these constants must hold universally for an entire class of instances, independent of the size of graph. Therefore, when we informally state that \emph{we are establishing weak / strong spatial mixing property} in this context, we refer to the existence of uniform constants $C$ and $\delta$ for a certain class of edge coloring instances even as the graph grows arbitrarily large.
\end{remark}
%
 \section{Recursion and marginals}\label{sec:marginals}
In this section, we analyze the marginal bounds on the set of edges adjacent to a given vertex in a $\beta$-extra list-edge-coloring instance under various conditions.
\subsection{Marginal bounds for general edge coloring}
We begin by examining the marginal bounds on general graphs.
\begin{lemma}\label{lem:claw-marginal-generalized}
     Given a list-edge-coloring instance $(G, \+L)$ where $G=(V, E)$,
     and a vertex $v\in V$ such that $\forall e\in E_{v}: \abs{\+L(e)}-\deg(e) \ge \beta\ge 2$.
    Then for any $v\in V$, $F\subseteq E(v)$ and color $a$:
    \[\Pr[G,\+L]{a\in c(F)} \le \frac{|F|}{\beta - 1 + |F|}\quad\mbox{and}\quad \frac{\Pr[G,\+L]{a\in c(F)}}{\Pr[G,\+L]{a \notin c(E(v))}} \le \frac{|F|}{\beta - 1}.\]
\end{lemma}
\begin{proof}\textcolor{red}{TOPROVE 1}\end{proof}

Especially, when $\abs{F}=1$, we have the following corollary.
\begin{corollary}\label{cor:marginal-bound-gamma-delta}
    Let $(G=(V, E), \+L)$ be a $\beta$-extra list-edge-coloring instance. Then for any $e\in E, v\in V, a\in \+L(e)$, 
    \[
    \frac{\Pr[G,\+L]{c(e)=a}}{\Pr[G,\+L]{a\notin c(E_v)}} \le \frac{1}{\beta-1}.
    \]
\end{corollary}

\subsection{Tree recursion for edge coloring}\label{sec:recursion}
We now turn our attention to a more specialized structure: trees. Throughout this section, we fix a $\beta$-extra edge-coloring instance $(T=(V,E),\+{L})$ with root $r$. For any vertex $v \in V$, let $T_v$ be the sub-tree of $T$ rooted at $v$ and $E_{T_v}$ be the edge set of $T_v$. Let $C_v$ be the set of proper partial colorings on $E_{T_v}(v)$ and $\+D(C_v)$ be the set of all distributions on $C_v$. 

Assume $r$ has $d$ children $v_1, v_2, \dots, v_d$. For any $i\in [d]$, let $e_i = (r, v_i)$ and $T_i = T_{v_i}$. For brevity, since the color lists are fixed, we omit the color lists $\+L$ in the subscript in $\Pr[T,\+L]{\cdot}$ and $Z_{T,\+L}(\cdot)$. For any $i\in [d]$, we also write $\Pr[T_i]{\cdot}$ for $\Pr[T_i, \+L|_{T_i}]{\cdot}$ and $Z_{T_i}(\cdot)$ for $Z_{T_i,\+L|_{T_i}}(\cdot)$.

We introduce a tree recursion on the marginal distributions of partial colorings on ``brooms'', where a ``broom'' is referred to as the edge set $E_{T_v}(v)$ for a vertex $v\in V$. This recursion demonstrates how the marginal distributions on brooms propagate through the tree structure as in \Cref{fig:broom-recursion}.
\usetikzlibrary{trees}
    \tikzset{
        arn/.style = {circle, draw=black, fill=white, thick},
}
\begin{figure}[H]
\centering
\begin{tikzpicture}
    [sibling distance = 1.9cm,level distance = 1.3cm] \node [arn] {$r$}
    child[edge from parent/.style={very thick,draw}] {
        [sibling distance = 0.5cm,level distance = 0.9cm]node [arn] {$v_1$}
        child {
            [red] node [arn] {}
            edge from parent node[above left] {\small $E_{T_{v_1}}(v_1)$}
        }
        child {[white] node [red] {\tiny$\ $\Large$\dots$} }
        child {[red] node [arn] {} }
    }
    child[edge from parent/.style={very thick,draw}] {
        [sibling distance = 0.5cm,level distance = 0.9cm]node [arn] {$v_2$}
        child {[orange] node [arn] {}}
        child {[white] node [orange] {\tiny$\ $\Large$\dots$} }
        child {
            [orange] node [arn] {}
            edge from parent node[right] {\small $E_{T_{v_2}}(v_2)$}
        }
    }
    child[edge from parent/.style={very thick,draw}] {
        [white] node [black] {\Huge$\dots$}
    }
    child[edge from parent/.style={very thick,draw}] {
        [sibling distance = 0.5cm,level distance = 0.9cm]node [arn] {$v_d$}
        child {[blue] node [arn] {}}
        child {[white] node [blue] {\tiny$\ $\Large$\dots$} }
        child {
            [blue] node [arn] {}
            edge from parent node[above right] {\small $E_{T_{v_d}}(v_d)$}
        }
        edge from parent node[above right] {\small $E(r)$}
    };
\end{tikzpicture}
\caption{Brooms on a tree}
\label{fig:broom-recursion}
\end{figure}

\begin{lemma}\label{lem:tree-recursion}
    Given distributions $\*{p}_i=\tp{\Pr[T_i]{c(E_{T_i}(v_i))=\tau}}_{\tau\in C_{v_i}}$ on $C_{v_i}$ for each $v_i$, we can compute the marginal distribution $\*{p}_r=\tp{\Pr[T]{c(E(r))=\pi}}_{\pi \in C_r}$ on $C_r$:
\begin{align*}
    \*p_r(\pi)=f_\pi(\set{\*{p}_i}_{i\in [d]})=\frac{\prod_i \sum_{\tau
    \in C_{v_i}: \pi(e_i)\notin \tau} \*p_{i}(\tau)}{\sum_{\rho \in C_r} \prod_i \sum_{\tau
    \in C_{v_i}: \rho(e_i)\notin \tau} \*p_{i}(\tau)}.
\end{align*}
\end{lemma}
\begin{proof}\textcolor{red}{TOPROVE 2}\end{proof}
We will regard $f=(f_\pi)_{\pi \in C_r}: \bb{R}_{\geq 0}^{C_{v_1}}\times \bb{R}_{\geq 0}^{C_{v_2}}\times \cdots \times \bb{R}_{\geq 0}^{C_{v_d}} \rightarrow \+D(C_{r})$ as a function taking inputs $\*p = (\*p_1, \*p_2, \dots, \*p_d)$ where $\*p_i\in \bb R_{\ge 0}^{C_{v_i}}$ for $i\in [d]$. Note that in some cases, $\*p$ might not encode a distribution.

\subsection{Marginal bounds propagated by recursion}\label{sec:marginal_bounds_on_trees}
Now we can give marginal bounds of probabilities that propagated by the recursion. For brevity, we define some notations of marginals for any non-zero vector $\*p_v\in \bb{R}_{\geq 0}^{C_v}$ with $v\in V$ and $c\in [q]$: Let $\*p_v(c)=\sum_{\tau \in C_v:c \in \tau} \*p_v(\tau)$, $\*p_v(\bar{c})=\sum_{\tau \in C_v:c \notin \tau} \*p_v(\tau)$, and $\*p_v(\bar{c_1},\bar{c_2})=\sum_{\tau \in C_v:c_1,c_2 \notin \tau} \*p_v(\tau)$.

Especially, for $\*p_r \in \+D(C_r)$, we define $\*p_r(i,c)=\sum_{\pi \in C_r: \pi(e_i)=c} \*p_r(\pi)$, and $\*p_r(i,c_1,j,c_2)=\sum_{\pi \in C_r: \pi(e_i)=c_1, \pi(e_j)=c_2} \*p_r(\pi)$.

By \Cref{lem:tree-recursion}, we have
\begin{equation}\label{eq:tree-recursion-short}
    \*p_r(\pi)=f_\pi(\set{\*{p}_i}_{i\in [d]})=
    \frac{\prod_i \*p_{v_i}(\ol{\pi(e_i)})}
    {\sum_{\rho \in C_r} \prod_i \*p_{v_i}(\ol{\rho(e_i)})}.
\end{equation}

We have the following lemma similar to \Cref{lem:claw-marginal-generalized}
on trees. Note that we do not require $\*p_i$'s to be distributions in \Cref{lem:marginal_bound_1}.
\begin{lemma}\label{lem:marginal_bound_1}
     Given non-zero vector $\*p_i\in \bb{R}_{\geq 0}^{C_{v_i}}$ for each $i\in [d]$ and $\*p_r = f(\{\*p_i\}_{i\in[d]})$, we have that for any color $a \in [q]$,
    \[
        \*p_r(a) \leq \frac{d}{\beta - 1 + d} \quad\mbox{and}\quad  \frac{\*p_r(a)}{\*p_r(\overline{a})} \leq \frac{d}{\beta - 1}.
    \]
    \end{lemma}
    \begin{proof}\textcolor{red}{TOPROVE 3}\end{proof}
    
\begin{lemma}\label{lem:marginal_bound_2}
    Given non-zero vector $\*p_i\in \bb{R}_{\geq 0}^{C_{v_i}}$ for each $i\in [d]$ and $\*p_r = f(\{\*p_i\}_{i\in[d]})$, we have that for any color $a\in [q]$ and $j\in [d]$,
    $$
        \*p_r(j,a) \leq \frac{\*p_j(\overline a)}{(\beta - 1)\sum_{\tau\in C_{v_j}}\*p_j(\tau)}.
    $$
\end{lemma}
\begin{proof}\textcolor{red}{TOPROVE 4}\end{proof}
 
\newcommand{\ma}{\mu_{E-i}^{i\pin a}}
\newcommand{\mb}{\mu_{E-i}^{i\pin b}}
\newcommand{\mab}{\mu_{E-i}^{\substack{i\pin a\\j\pin b}}}
\newcommand{\mba}{\mu_{E-i}^{\substack{i\pin b\\j\pin a}}}
\newcommand{\man}{\mu_{E-i}^{\substack{i\pin a\\b\notin N}}}
\newcommand{\mbn}{\mu_{E-i}^{\substack{i\pin b\\a\notin N}}}
\renewcommand{\pab}{\mu_{E-i}^{i\pin a}(j\pin b)}
\newcommand{\pba}{\mu_{E-i}^{i\pin b}(j\pin a)}
\newcommand{\pan}{\mu_{E-i}^{i\pin a}(b\notin N)}
\newcommand{\pbn}{\mu_{E-i}^{i\pin b}(a\notin N)}
\newcommand{\sjn}{\sum_{j\in N}}
\newcommand{\sj}{\sum_{j}}

\newcommand{\zzz}{1+\sum_k(\gamma_k\vee\delta_k)}



\section{FPTAS for counting proper edge colorings on general graphs $q\ge 3\Delta$}\label{sec:FPTAS}


In this section, we prove the following main algorithmic result, which is a formal version of \Cref{thm:FPTAS-informal}.
\begin{theorem}\label{thm:FPTAS}
    Assume $\Delta\geq 4$. There exists a deterministic algorithm that outputs $\hat{Z}$ satisfying $(1-\delta)Z_{G,\+L}\leq \hat{Z}\leq (1+\delta)Z_{G,\+L}$ for any $(\Delta + 2)$-extra edge coloring instance $(G,\+L)$ with maximum degree $\Delta$ and given error bound $0<\delta <1$ in time $\tp{\frac{n}{\delta}}^{C(\Delta)}$,  where $n$ is the number of edges in $G$ and $C(\Delta)=\+O\tp{\Delta^{\Delta\log \Delta}\log \Delta}$
    is a universal constant only depends on $\Delta$.
\end{theorem}

Our key contribution is the following coupling independence result.

\begin{theorem}\label{thm:coupling-independence}
    Let $(G=(V, E), \+L)$ be a $((1+\eps)\Delta+1)$-extra list-edge-coloring instance.  Then $\mu_E$ is $\tp{1+\frac{2}{\eps}}$-coupling independent. That is, for any $i\in E$, $a, b\in \+L(i)$,
    \[
    \W{\mu_E^{i\pin a}, \mu_E^{i\pin b}} \le 1 + \frac{2}{\eps}.
    \]
\end{theorem}

We first set up our terminologies to argue about the Wasserstein distance. We define some upper bounds for the $\+W_1$ distance between $\lambda\Delta$-extra list-colorings on $\Delta$-degree graphs with $s$ edges with respect to one different pinning. We will construct recursion on these upper bounds.
An edge is \emph{pendant} if one of its endpoints has degree exactly $1$.
\begin{definition}[Universal upper bounds for coupling independence]\label{def:kappa}
Define
\[
\kappa_{s, \Delta, \lambda} \defeq 
\sup_{\substack{(G=(V, E), \+L)\\ i\in E\colon i \text{ is pendant} \\ a, b\in \+L(i), a\neq b}}
\W{
\mu_{E-i}^{i\pin a}, \mu_{E-i}^{i\pin b}
}
\]
where $(G, \+L)$ is taken over
\begin{enumerate}
    \item all graph $G=(V, E)$ such that $\deg(G)\le \Delta$, $|E|\le s$;
    \item all color lists $\+L$ such that $\forall e\in E: |\+L(e)|\ge \deg(e) + \lambda \Delta + 1$.
\end{enumerate}
\end{definition}
\begin{remark}
    It is clear from the definition that $\kappa_{s+1, \Delta, \lambda}\ge \kappa_{s, \Delta, \lambda}$
    and $\kappa_{1, \Delta, \lambda}=0$.
\end{remark}

Note that we only pin color on the edge $i$ in \Cref{def:kappa}. If we need other pinnings, we can simply consider the pinnings as deleting the pinned edges and remove the pinned color from the lists of their adjacent edges.


The main lemma of this section is a recursion for $\kappa_{s, \Delta, \lambda}$
and leads to \Cref{thm:coupling-independence} immediately.

\begin{lemma}\label{lem:kappa-recursion}
    Let $\lambda=1+\eps$ for some $\eps>0$ and $s\ge 2$. Then
    \[
    \kappa_{s, \Delta, \lambda} \le \frac{2}{2+\eps}\tp{\kappa_{s-1, \Delta, \lambda} + \frac12}.
    \]
\end{lemma}

The proof of \Cref{lem:kappa-recursion} is based on a greedy one-step coupling of two marginal distributions with different pinning on a single edge. We describe the coupling in \Cref{sec:coupling}. The proofs of \Cref{lem:kappa-recursion}, \Cref{thm:coupling-independence} and \Cref{thm:FPTAS} are in \Cref{sec:CI-proof}.


\subsection{Decomposition of Wasserstein distance}\label{sec:coupling}


The following lemma shows how we can go from $\kappa_{s, \Delta, \lambda}$ to $\kappa_{s-1, \Delta, \lambda}$
by one extra pinning.
\begin{lemma}\label{lem:s-to-s-1}
    For the instance $(G=(V, E), \+L)$, the pendant edge $i=\set{u, v}\in E$, and the colors $a, b\in \+L(i)$
    that fit into the definition of $\kappa_{s, \Delta, \lambda}$. 
    Suppose $\deg(u)=1$ and $\deg(v)\ge 2$, and $j\in N(i)$, $a, b\in \+L(j)$.
    Then
    \begin{enumerate}
        \item $\W{\mab, \mba} \le 1 + \kappa_{s-1, \Delta, \lambda}$,
        \item $\W{\mab, \mb}, \W{\mba, \ma} \le 1 + 2\kappa_{s-1, \Delta, \lambda}$,
        \item $\W{\man, \mbn} = 0$.
    \end{enumerate}
\end{lemma}
\begin{proof}\textcolor{red}{TOPROVE 5}\end{proof}

Let $(G=(V, E), \+L)$ be a list-edge-coloring instance that fits into the constraints of $\kappa_{s, \Delta, \lambda}$ in \Cref{def:kappa}, $i\in E$ be a pendant edge, and $a, b\in \+L(i)$ be colors. We do a one-step coupling to reduce the $W_1$ distance between graphs with $s$ edges to that between graphs with $s-1$ edges using \Cref{prop:coupling-convex-decomposition}.

Denoting the two endpoints of $i$ by $u, v$, we may assume $u$ is the pendant vertex, that is $\deg(u) = 1$ without loss of generality.
    
We denote the non-empty set $E(v)-i$ by $N$, and use integers from $1$ to denote the edges in $N$ so that $N = \set{1, \ldots, d}$. For every edge $j\in N$, define
\begin{align*}
    \gamma_j\defeq \frac{\pab}{\pan}, \quad
    \delta_j\defeq \frac{\pba}{\pbn}.
\end{align*}
The following lemma describes the greedy coupling we use.
\begin{lemma}
    \begin{align*}
        \ma-\mb
          =&\sum_{j\in N}\frac{\gamma_j\wedge\delta_j}{\zzz}\Bigg(\mab - \mba\Bigg)
        \\&+\sum_{j\in N}\frac{(\gamma_j-\delta_j)\vee 0}{\zzz}\Bigg(\mab-\mb\Bigg)
           +\sum_{j\in N}\frac{(\delta_j-\gamma_j)\vee 0}{\zzz}\Bigg(\ma-\mba\Bigg)
        \\&+\frac{1}{\zzz}\Bigg(\man-\mbn\Bigg).
    \end{align*}
\end{lemma}
\begin{proof}\textcolor{red}{TOPROVE 6}\end{proof}

\subsection{Proof of main theorems}\label{sec:CI-proof}

Now we prove \Cref{lem:kappa-recursion}, which provides a recursion for $\kappa_{s,\Delta,\lambda}$.

\begin{proof}\textcolor{red}{TOPROVE 7}\end{proof}

\begin{proof}\textcolor{red}{TOPROVE 8}\end{proof}

\Cref{thm:coupling-independence} shows that any $((1+\eps)\Delta+1)$-extra list-edge-coloring instance is $\tp{1+ \frac{2}{\eps}}$-coupling independent. This is because adding additional pinnings can be viewed as generating a new $((1+\eps)\Delta+1)$-extra list-edge-coloring instance by deleting the pinned edges and removing the corresponding colors from the lists of their adjacent edges. 

The work of~\cite{CFGZZ24} designs an \textbf{FPTAS} for counting the partition function of any Gibbs distribution of permissive spin systems that is marginally bounded and coupling independent. A spin system is specified by a $4$-tuple $S=(G = (V,E),q, A_E, A_V)$ where the state space is $[q]^V$ and the weight of a configuration is characterized by the matrices $A_E \in \bb{R}_{\geq 0}^{q\times q}$ and $A_V \in \bb{R}_{\geq 0}^q$. The Gibbs distribution is defined by:
\[
\mu(\sigma)\propto w(\sigma):=\prod_{u,v\in E} A_E(\sigma(u),\sigma(v))\prod_{v\in V} A_V(\sigma(v)).
\]
The normalizing factor of $\mu$ is called the partition function $Z:=\sum_{\sigma\in [q]^V}w(\sigma)$.

We say $S$ is permissive if for any partial configuration $\tau \in [q]^\Lambda$ with $\Lambda \subseteq V$, the conditional partition function $Z^\tau = \sum_{\sigma:\tau\subset \sigma} w(\sigma) >0$. For $\tau\in [q]^\Lambda$ with $\Lambda \subset V$, let $\mu_v^\tau$ be the marginal distribution on $v\in V\setminus \Lambda$ conditional on the partial configuration $\tau$. We say $\mu$ is $b$-marginally bounded if for any partial configuration $\tau \in [q]^\Lambda$ with $\Lambda \subseteq V$, any vertex $v \in V\setminus \Lambda$ and $c\in [q]$ such that $\mu_v^\tau>0$, we have $\mu_v^\tau\geq b$.

The main result of~\cite{CFGZZ24} that we will use is as follows.
\begin{theorem}[\cite{CFGZZ24}]\label{thm:ci-FPTAS}
    Let $q \geq 2, b>0, C>0, \Delta \geq 3$ be constants. There exists a deterministic algorithm such that given a permissive spin system $\mathcal{S}=\left(G, q, A_E, A_V\right)$ and error bound $0<\varepsilon<1$, if the Gibbs distribution of $\mathcal{S}$ is b-marginally bounded and satisfies $C$-coupling independence, and the maximum degree of $G$ is at most $\Delta$, then it returns $\hat{Z}$ satisfying $(1-\varepsilon) Z \leq \hat{Z} \leq(1+\varepsilon) Z$ in time $\left(\frac{n}{\varepsilon}\right)^{f(q, b, C, \Delta)}$, where $f(q, b, C, \Delta)=\Delta^{\+O\left(C\left(\log b^{-1}+\log C+\log \log \Delta\right)\right)} \log q$ is a constant.
\end{theorem}
In our setting, the spin system is list-edge-coloring instance. Be careful with the parameters since the spins are on edges of the graph. In order to prove \Cref{thm:FPTAS}, we need the marginal lower bound from \cite{GKM15}.
\begin{lemma}[Corollary of Lemma 3 in \cite{GKM15}] \label{lem:marginal-bound-gkm}
Fix a $\beta$-extra edge coloring instances $(G,\+L)$ of maximum degree $\Delta$ with Gibbs distribution $\mu$. For any partial coloring $\tau$ on $\Lambda \subseteq E$, any $e \in E\setminus \Lambda$, and $c \in \+L^\tau(e)$, it holds that
	\[
		\mu^{\tau}_e(c) \geq \frac{\tp{1-\frac{1}{\abs{\+L^\tau(e)}-\deg^\tau(e)}}^{\deg^\tau(e)}}{\abs{\+L^\tau(e)}}\ge \frac{(1-\frac{1}{\beta})^{2\Delta-2}}{\beta+2\Delta-2} .
	\]
 \end{lemma}
Now we give the proof of our main theorem in this section.
\begin{proof}\textcolor{red}{TOPROVE 9}\end{proof}

 \section{Strong spatial mixing for edge colorings on trees when $q>(3+o(1))\Delta$}\label{sec:ssm}

In this section, we prove our theorem for strong spatial mixing.

\begin{theorem}\label{thm:SSM}
    Given a $\beta$-extra edge coloring instance $(G,\+L)$ where $G$ is a tree of maximum degree $\Delta$, the uniform distribution on such instance exhibits strong spatial mixing with exponential decay rate $1-\delta$ and constant $C = \max\{32q^{\frac{\Delta + 2}2}\Delta^2(1-\delta)^{-3},(1-\delta)^{-4}\}$ if $\beta > \max\{\Delta + 50, (1 + \eta_\Delta)\Delta + 1\}$, where
    \[
         \delta = \frac{(1 + (\beta - 1 -\Delta)/\Delta)^2 - (1+\eta_{\Delta})^2}{2(1 + (\beta - 1 -\Delta)/\Delta)^2}, \eta_{\Delta} = \+\+O\tp{\frac{\log^2 \Delta}{\Delta}}.
    \]
    Specifically, if $\beta = \tp{1 + \frac{\log^3 \Delta}{\Delta}}\Delta + 50$, then $\delta \approx \frac{\log^3 \Delta}{\Delta}$.
 \end{theorem}
 


We already introduced the recursion for marginal probabilities of edge colorings on trees and derived certain marginal bounds in \Cref{sec:marginals}.  We will then analyze its Jacobian matrix in \Cref{sec:jacobian}. Using the bounds on the norm of the Jacobian matrix, we prove \Cref{thm:SSM} in \Cref{sec:contraction}. Finally, we discuss the limit of our approach and possible further improvement in \Cref{sec:limit}. A key ingredient in our bounds for the norm of Jacobian matrix is a bound for certain covariance matrices, which is addressed in \Cref{sec:covariance}. 


\subsection{Upper bound the 2-norm of Jacobian}\label{sec:jacobian}

\subsubsection{The Jacobian}
Recall the recursion $f$ for marginals introduced in \Cref{sec:recursion}. We regard $f=(f_\pi)_{\pi \in C_r}: \bb{R}_{\geq 0}^{C_{v_1}}\times \bb{R}_{\geq 0}^{C_{v_2}}\times \cdots \times \bb{R}_{\geq 0}^{C_{v_d}} \rightarrow \+D(C_{r})$
as a function taking inputs $\*p = (\*p_1, \*p_2, \dots, \*p_d)$ where $\*p_i\in \bb R^{C_{v_i}}$ for $i\in [d]$. The Jacobian of $f$ is a matrix $(\+J f)(\*p) \in \bb{R}^{C_r\times \bigcup_{i\in [d]} C_{v_i}}$. Since $C_{v_i}$'s are disjoint, for every $\tau \in \bigcup_{i\in [d]} C_{v_i}$, we will denote it by $(i,\tau)$ if $\tau\in C_{v_i}$ for clarity. Therefore, 
\begin{equation*}
    (\+J f)_{\pi,(i,\tau)}(\*p)= \frac{\partial f_\pi}{\partial \*p_{i}(\tau)}.
\end{equation*}
For each $i\in [d]$, define the matrix $\+J_i \in \bb{R}^{C_r\times C_{v_i}}$ with entries
\begin{equation*}
    (\+J_i f)_{\pi,\tau}(\*p) = (\+J f)_{\pi,(i,\tau)}(\*p)
\end{equation*}
for every $\pi\in C_r$ and $\tau\in C_{v_i}$. 

\bigskip
We can write $\+J_if$ in a compact way. 
\begin{proposition} 
Let $\*p_r = f(\*p)$. Then
\begin{align*}
    (\+J_i f)(\*p)=\sum_{c\in \+L(e_i)}\*a_{i,c} \*b_{i,c}^{\top},
\end{align*}
where $\*a_{i,c^*}=f(\*p) \odot \Big[\1{\pi(e_i)=c^*}-\sum_{\pi' \in C_{r}: \pi'(e_i)=c^*}\*p_r(\pi')\Big]_{\pi\in C_r}$
and $\*b_{i,c^*}=\Big[\frac{\1{c^*\notin \tau}}{\sum_{\tau' \in C_{v_i}: c^*\notin \tau'}\*p_i(\tau')} \Big]_{\tau\in C_{v_i}}$. \footnote{We write $\*u \odot \*v$ for their Hadamard product (entry-wise product).}
\end{proposition}

\begin{proof}\textcolor{red}{TOPROVE 10}\end{proof}

A well-known trick in the analysis of decay of correlation is to apply a potential function on the marginal recursion to amortize the contraction rate. Given an increasing  potential function $\phi:[0,1]\rightarrow \bb{R}$, we define $f^\phi$ such that for any $\pi \in C_r$ and $\*m \in \bb{R}^{C_{v_1}\times C_{v_2}\times \dots \times C_{v_d}}$,
\begin{equation*}
f^{\phi}_\pi(\*m)=\phi\left(f_\pi\left(\left(\phi^{-1}(\*m_{1}),\phi^{-1}(\*m_{2}),\dots, \phi^{-1}(\*m_{d})\right)\right)\right).
\end{equation*}

As a result, the Jacobian of $f^\phi$ can be obtained by the chain rule and the inverse function theorem as follows.
\begin{proposition}\label{prop:eq_of_Ji}
Given a smooth increasing function $\phi:[0,1]\rightarrow \bb{R}$ with derivative $\Phi = \phi'$, let $\*p = \phi^{-1}(\*m)$. Then we have
\begin{align*}
    (\+J_i f^{\phi})(\*m)=\sum_c (\Phi(f(\*p))\odot \*a_{i,c})(\*b_{i,c} \odot \Phi^{-1}(\*p_i))^{\top}.
\end{align*}
\end{proposition}
Taking $\Phi(x)=\frac{1}{\sqrt{x}}$, we have
\begin{align*}
    (\+J_i f^{\phi})(\*m)=\sum_c \*a^{\phi}_{i,c} (\*b^{\phi}_{i,c})^{\top},
\end{align*}
where $\*a^{\phi}_{i,c^*}=\sqrt{f(\*p)}\odot \Big[\1{\pi(e_i)=c^*}-\sum_{\pi' \in C_{r} : \pi'(e_i)=c^*}\*p_r(\pi')\Big]_{\pi\in C_r}$ and $\*b^{\phi}_{i,c^*}=\Big[\frac{\1{c^*\notin \tau}\sqrt{\*p_i(\tau)}}{\sum_{\tau' \in C_{v_i}: c^*\notin \tau'}\*p_i(\tau')}\Big]_{\tau\in C_{v_i}}$.

\subsubsection{Bounding $\norm{(\+J f^{\phi})(\*p)}_2$}

In this section, we aim to derive an upper bound for the 2-norm of the Jacobian of the tree recursion.
For brevity, we follow some notations which is defined in \Cref{sec:marginal_bounds_on_trees} of marginal probabilities w.r.t $\*p_i$ and $\*p_r$.


Also we introduce some notations of matrices used in later proof.
\begin{definition}\label{def:covariance}
    For a distribution $\*p$ over proper colorings on a broom $E_{T_v}(v)=\set{e_1,\dots,e_m}$, we define $X_v=\set{(i,c):i\in [m], c\in \+L(e_i)}$ and its (local) covariance matrix $ \!{Cov}(\*p)\in \bb{R}^{X_v\times X_v}$ with entries:
    $$ \!{Cov}(\*p)((i,c_1),(j,c_2)) = \sum_{\tau \in C_v:\tau(e_i)=c_1 \& \tau(e_j)=c_2} \*p(\tau)-\tp{\sum_{\tau \in C_v:\tau(e_i)=c_1}\*p(\tau)}\tp{\sum_{\tau \in C_v:\tau(e_j)=c_2}\*p(\tau)}.$$
\end{definition}


\begin{definition}\label{def:diag_mean}
    For a distribution over colorings $\*p$ on a broom $E_{T_v}(v)=\set{e_1,\dots,e_m}$, we define $X_v=\set{(i,c):i\in [m], c\in \+L(e_i)}$ and  its diagonal matrix of mean vector $\Pi(\*p)\in \bb{R}^{X_v\times X_v}$ as follows,
    $$
        \Pi(\*p) = \-{diag}\set{\sum_{\tau\in C_v: \tau(e_i) = c}\*p(\tau)}_{(i,c)\in X_v}.
    $$
\end{definition}
Now we define the notion of spectral independence on a broom.
\begin{definition}\label{def:sepctral_independence}
    For any distribution over colorings $\*p$ on a broom $E(v) = \{e_1,...,e_m\}$, we say $\*p$ is $C$-spectrally independent if it holds that
    $$
         \!{Cov}(\*p) \preceq C\cdot \Pi(\*p).
    $$
\end{definition}
The following is the main result in this section.
\begin{condition}[marginal bound]\label{cond:marginal}
    For any $i\in [d]$, $\*p_i$ is a distribution on $C_{v_i}$ such that for any color $a$
\[
\*p_i(a)\leq \frac{\abs{E_{T_i}(v_i)}}{\beta -1 +\abs{E_{T_i}(v_i)}},
\]
and for $\*p_r = (f_\pi(\*p_1,\*p_2, \dots, \*p_d))_{\pi \in C_v}$,
\[
\frac{\*p_r(i,a)}{\*p_i(\bar{a})}\leq \frac{1}{\beta -1},
\]
where $\beta \geq (1+o(1))\Delta$ .
\end{condition}

\begin{theorem}\label{thm:bound_Jacobian}
For any $i\in [d]$, $\*p_i = \phi^{-1}(\*m_i)$ and $\*p_r = f((\*p_i)_{i\in[d]})$ satisfy \Cref{cond:marginal} and $(1 + \eta)$-spectrally independent. Then $\beta \geq 1 + \frac{(1 + \eta)\Delta}{\sqrt{1 - 2\delta}}$ implies that 
    $$
        \norm{\+J f^\phi(\*m)}_2 \leq \frac{1-\delta}{\sqrt \Delta}
    $$
    where $\*m = \phi(\*p)$ and $\phi(x) = 2\sqrt{x}$.
\end{theorem}

We will prove the theorem in \Cref{sec:bound_Jac} after introducing our key reduction in \Cref{sec:dim}.

\subsubsection{Dimension reduction}\label{sec:dim}
By the definition of 2-norm, we have that $\norm{(\+J f^\phi)(\*p)}_2 = \sqrt{\lambda_{\max}( (\+J f^\phi)(\*p)(\+J f^\phi)(\*p)^\top )}$. Let $\*A := (\+J f^\phi)(\*p)(\+J f^\phi)(\*p)^\top$. We have that
\begin{align*}\label{eq:2norm_J}                 
    \*A
    = \sum_{i=1}^d  (\+J_i f^\phi)(\*p)(\+J_i f^\phi)(\*p)^\top
    = \sum_{i=1}^d \sum_{c_1,c_2\in \+L({e_i})} \inner{\*b_{i,c_1}^\phi}{\*b_{i,c_2}^\phi} \*a_{i,c_1}^\phi (\*a_{i,c_2}^\phi)^\top.
\end{align*}
The last equation simply follows from~\Cref{prop:eq_of_Ji}. The above calculation suggests that although the dimension of $\*A$ is exponential in $d$, its rank is polynomial in $d$. In the following, we will find a much smaller matrix which can be used to upper bound $\*A$. The idea is to use the trace method, namely to study $\Tr\tp{\*A^k}$. We have the following lemma.



\begin{lemma}\label{lem:clac_lammax}
    For any positive semi-definite matrix $\*M \in \mathbb R^{n\times n}$, we have that
    \[
        \lambda_{\max} (\*M) = \lim_{k\to \infty}
        \tp{\Tr(\*M^k)}^{\frac 1k}.
    \]
\end{lemma}
\begin{proof}\textcolor{red}{TOPROVE 11}\end{proof}
To simplify notations, we let
\[
V(i,z_1,c_1,z_2,c_2) \defeq \inner{\*b_{i,c_1}^\phi}{\*b_{i,c_2}^\phi}
    \tp{\1{z_1=c_1} - \*p_r(i,c_1)}\tp{
    \1{z_2=c_2} - \*p_r(i,c_2)}.
\]
Then we can write $\*A$ explicitly.
\begin{equation}\label{eq:equation_A}
    \*A(\pi,\tau) = \sqrt{f(\*p)(\pi)f(\*p)(\tau)} \sum_{i=1}^d \sum_{c_1,c_2\in \+L(e_i)} V(i,\pi(e_i),c_1,\tau(e_i),c_2).
\end{equation}
Let $g_k^\pi(i,c)$ denote
\begin{align*}
    &\sum_{\substack{\tau_1,...,\tau_{k-1}\in C_r\\ \tau_0=\pi}} \prod_{j=1}^{k-1}f(\*p)(\tau_j)
    \sum_{i_1,...,i_{k-1}\in[d],i_k=i}
    \sum_{\substack{c_{1,1}\in \+L(e_{i_1})\\...\\c_{1,k}\in \+L(e_{i_k})}}
    \sum_{\substack{c_{2,1}\in \+L(e_{i_1})\\...\\c_{2,k-1}\in \+L(e_{i_{k-1})}\\c_{2,k}=c}}
    \prod_{j=1}^{k-1} V(i_j,\tau_{j-1}(i_j),c_{1,j},\tau_j(i_j),c_{2,j})
    \\&\times \inner{\*b_{i,c_{1,k}}^\phi}{\*b_{i,c}^\phi}(\1{\tau_{k-1}(i) = c_{1,k}} -  \*p_r(i,c_{1,k})).
\end{align*}
We omit $\pi$ in $g_k^\pi$ for brevity.
Then we have that for any $\pi \in C_r$
\begin{align}\label{eq:trace_of_A}
    \*A^k(\pi,\pi) = f(\*p)(\pi)\sum_{i=1}^d
    \sum_{c\in \+L(e_i)} g_k(i,c) (\1{\pi(i) = c} -  \*p_r(i,c)).
\end{align}
Fix $\pi$, then we will show that $\{g_k\}_{k\geq 1}$ can be computed recursively, which gives a simple representation of $\*A^k(\pi,\pi)$. Let $X=\set{(i,c)|i\in [d], c\in \+L(e_i)}$ be the set of all feasible edge-color pairs. 
\begin{lemma}\label{lem:recursion_for_g}
    If $\*B(\*p)\in \mathbb R^{X\times X}$ satisfies that
    \begin{align*}
        \*B(\*p)((i,c_2),(j,c_4)) &= 
        \sum_{c_3 \in \+L(e_j)}
        \frac{\*p_j(\bar{c_3},\bar{c_4})}{\*p_j(\bar{c_3})\*p_j(\bar{c_4})}\times \tp{\*p_r(j,c_3,i,c_2) - \*p_r(j,c_3)\*p_r(i,c_2)}.
    \end{align*}
    Then we have that $g_k^\top = \alpha^\top_\pi \*B^{k-1}$ where
    \begin{align*}
        \alpha_\pi(i,c_2) &= \sum_{c_1 \in \+L(e_i)}
         \frac{\*p_i(\bar{c_1},\bar{c_2})}{\*p_i(\bar{c_1})\*p_i(\bar{c_2})}
        \times (\1{\pi(i) = c_1} - \*p_r(i,c_1)).
    \end{align*}
\end{lemma}
\begin{proof}\textcolor{red}{TOPROVE 12}\end{proof}
In the following, we omit $(\*p)$ in $\*B(\*p)$ for brevity if there is no ambiguity. \Cref{lem:recursion_for_g} directly indicates that we can use the 2-norm of $\*B$ to upper bound that of $\*A$.
\begin{lemma}\label{lem:convert_A_to_B}
    Let $\*B \in \mathbb R^{X\times X}$ and $\alpha_\pi$ denote the matrix and the vector defined in ~\Cref{lem:recursion_for_g}.
    Then we have that for any $k\geq 1$,
    \begin{align}\label{eq:lem8}
        \sum_{\pi\in C_r}\*A^k(\pi,\pi)
        = \sum_{\pi\in C_r}f(\*p)(\pi)\alpha_\pi^\top \*B^{k-1}\beta_\pi
    \end{align}
    where $\beta_\pi(j,c_4) = \1{\pi(j) = c_4} - \*p_r(j,c_4)$, implying that $\lambda_{\max}(\*A) \leq \|\*B\|_2$.
\end{lemma}
\begin{proof}\textcolor{red}{TOPROVE 13}\end{proof}
\subsubsection{Bound the transition matrix} \label{sec:bound_Jac}
Let $D_T\in \mathbb{R}^{X\times X}$ be the diagonal matrix where $D_T((i,c),(i,c)) = \*p_i(\bar{c})$.
In this section, we give an upper bound for $\norm{\*B}_2$ as $\*B$ can be represented as the product of covariance matrices of $\*p_r$, $\*p_i$ and some auxiliary diagonal matrices.

\begin{proposition}\label{prop:convert_B_to_Cov}
    Let $C_i\in \mathbb{R}^{X_{v_i}\times |\+L(e_i)|}$ denote the matrix satisfying that $C_i((j,c_1),c_2) = \1{c_1 = c_2}$ for any $i\in [d]$.
    Let $\*R \in \mathbb{R}^{X\times X}$ denote $$
    \operatorname{diag}\{C^\top_i \!{Cov}(\*p_i)C_i\}_{i\in [d]}.
    $$
    Then we have that
    $$
        \*B =  \!{Cov}(\*p_r)D_T^{-1}\*RD_T^{-1}.
    $$
\end{proposition}
\begin{proof}\textcolor{red}{TOPROVE 14}\end{proof}
Then we can establish~\Cref{thm:bound_Jacobian} through the above conclusions.
\begin{proof}\textcolor{red}{TOPROVE 15}\end{proof}
\subsection{Strong spatial mixing via contraction}\label{sec:contraction}
\newcommand{\ra}{\rightarrow}
As \Cref{thm:bound_Jacobian} gives the upper bounds on the 2-norm of the Jacobian matrix, we now proceed to demonstrate how these bounds can be used to prove strong spatial mixing via contraction. Specifically, we will quantify the decay of correlations using the derived bounds.
Let $B_{G}(u,d)$ denote $\set{u'\in V\mid \dist_G(u,u') = d}$.

\begin{proof}\textcolor{red}{TOPROVE 16}\end{proof}

\subsection{Worst-case scenario}\label{sec:limit}

Though \Cref{thm:bound_Jacobian} establishes an upper bound on the 2-norm of the Jacobian matrix under certain conditions, in this section, we will introduce the ``worst'' pinning of $q$-edge coloring, which is the bottleneck of our analysis. 
In fact, with potential function $\phi(x) = 2\sqrt x$ and applying 2-norm for the correlation decay step, the best bound we expected to prove is $q > \tp{\frac{3+\sqrt 5}{2}+ o(1)}\Delta\approx 2.618\Delta$. However what we can only prove strong spatial mixing for instances of $(1+o(1))\Delta$-extra edge colorings, as we currently lack a better upper bound for $\*R$.
Note that the pinning that maximizes~\cref{eq:marginal_equation} is the same as the pinning in~\Cref{thm:worst_pinning} and~\cref{eq:marginal_equation} can indeed achieve the upper bound $\frac{\Delta-1}{(q-2\Delta+2)^2}$ under this worst pinning.

Before showing the worst-case scenario, we introduce the following technical lemma to calculate the eigenvalues of some simple matrices.
\begin{lemma}\label{lem:calc_eigenvalues}
    Given constant $k_1,k_2\neq 0$, 
    the eigenvalues of $k_1\*1\*1^\top +k_2 \!{Id}_n$ are either $k_2$ or $nk_1 + k_2$ where $\!{Id}_n$ is the identity matrix in $\mathbb{R}^{n\times n}$.
\end{lemma}
\begin{proof}\textcolor{red}{TOPROVE 17}\end{proof}
Now we show the worst pinning and corresponding norm value of $\*B$ and $(\+J f^\phi)(\*p)$.
\begin{theorem}\label{thm:worst_pinning}
    Under some specific pinning, the norm of $\*B$ satisfies lower bound that
    $$
    \|(\+J f^\phi)(\*p)\|_2^2 = \|\*B\|_2 = \frac{\Delta-1}{(q-\Delta)(q-2\Delta+2)}.
    $$
    Then $\|\*B\|_2 < \frac 1\Delta$ implies that $q > \tp{\frac{3+\sqrt 5}{2}+o(1)}\Delta$.
\end{theorem}
\begin{proof}\textcolor{red}{TOPROVE 18}\end{proof}
\Cref{thm:worst_pinning} indicates the limitations of our current analysis by providing a lower bound on the norm of the Jacobian matrix. This indicates the best bound one can expect to use $2$-norm and the potential function $\phi(x) = 2\sqrt{x}$ is $q\approx 2.618\Delta$.


 
\section{Covariance matrix on brooms}\label{sec:covariance}
We will give an upper bound for the covariance matrix defined in \Cref{def:covariance} in this section.
\begin{lemma}\label{lem:SI-broom}
    Given a tree $T$ rooted with $r$ of depth $\ell+1$ and weight functions $\*p_v:E_{T_v}(v)\rightarrow \bb{R}_{\geq 0}$ for any $v\in B_T(r,\ell)$. If $\ell\geq 2$ and $\beta \geq \Delta + 50$, then $\*p_r\defeq  f^{\ell\rightarrow 0}(\tp{\*p_v}_{v\in B(r,\ell)})$ is $(1+\eta_\Delta)$-spectrally independent, i.e.
    \[
    \!{Cov}(\*p_r)\mle (1+\eta_{\Delta})\Pi(\*p_r).
    \]
    where $\eta_{\Delta}$ is $O\tp{\frac{\log^2 \Delta}{\Delta}}$.
\end{lemma}
\subsection{Weighted edge coloring instance}
\label{sec:weight-edge-coloring}
Given a tree $T$ and associated $\beta$-extra color lists $\+L$ for all edges in $T$, an weighted edge coloring instance is a distribution over proper list colorings $(T, \+L)$.
There are non-intersecting connected subgraphs $\set{K_i}_{i\in [N]}$ in $T$
called \emph{boundaries} and associated \emph{weight functions} $\set{w_i}_{i\in [N]}$
such that $w_i : C_{v_i} \to \mathbb R_{\ge 0}$.
\begin{definition}[Distribution of weighted list edge coloring]\label{def:weighted-coloring}    
    Given a list edge coloring instance $(T, \+L)$,
    boundaries $\set{K_i}_{i\in [N]}$
    and weighted functions $\set{w_i}_{i\in [N]}$
    as above, define the associated weighted edge coloring instance
    be the distribution $\mu$ on $\Omega$ such that
    \begin{align*}
        \mu(\sigma) \defeq \frac1Z \prod_{i\in [N]} w_i(\sigma|_{K_i}),
    \end{align*}
    where $Z\defeq \sum_{\sigma\in \Omega}\prod_{i\in [N]} w_i(\sigma|_{K_i})$
    is the partition function.
\end{definition}

Notice that, if we pick an $\omega_i\in\Omega_{K_i}$ for each $i\in [N]$,
then
\[\mu^{\omega_1\cup\cdots\cup \omega_N}(\sigma)
\propto
\begin{cases}
 \frac{1}{Z}   \prod_{i\in [N]} w_i(\sigma|_{K_i}),  &\forall i\in [N], \sigma|_{K_i} = \omega_i,
 \\ 0, & \text{otherwise},
\end{cases}
\]
which means $\mu$ is a distribution over uniform edge colorings conditioned on a 
pinning on all $K_i$. This leads to the following lemma.
\begin{lemma}\label{lem:weighted-decomposition-to-unweighted}
    We have
    \[
        \mu = \sum_{\omega_1\in \Omega_{K_1},\cdots, \omega_N\in \Omega_{K_N}}
        \mu_{K_1\cup\cdots\cup K_N}(\omega_1\cup\cdots\cup\omega_{N}) \mu^{\omega_1\cup\cdots\cup\omega_N}.
    \]
    That is, the distribution on weighted coloring instance in \Cref{def:weighted-coloring}
    can be expressed as a mixture of uniform distributions over edge colorings.
\end{lemma}
\begin{proof}\textcolor{red}{TOPROVE 19}\end{proof}

With \Cref{lem:weighted-decomposition-to-unweighted}, we can prove
weighted edge colorings inherit the marginal bound \Cref{lem:claw-marginal-generalized}
on non-boundary edges.
\begin{lemma}[Marginal upper bound - weighted version]\label{lem:marginal-upper-weighted}
    Consider a weighted edge coloring instance on a tree $T=(V, E)$
    as defined in \Cref{def:weighted-coloring},
    whose distribution is denoted by $\mu$, and a pinning $\xi\in \Omega_{S}$ for some subset $S\subset E$.
    Then for any $i\in V$, $F\subseteq E_i\setminus \tp{\bigcup_{i\in [N]}K_i\cup S}$ and color $a$:
    denoting $\beta\defeq\min_{e\in F}\set{\abs{\+L^\xi(e)}-\deg(e)}$, we have
    \[\mu^\xi(a\in c(F)) \le \frac{|F|}{\beta - 1 + |F|}.\]
\end{lemma}
\begin{proof}\textcolor{red}{TOPROVE 20}\end{proof}

We also need the following lower bound in the matrix trickle-down.
\begin{lemma}\label{lem:marginal-lower-weighted}
    Consider a weighted edge coloring instance on a tree $T$ with $\beta$-extra
    color lists $\+L$.
    If $K=E(v)$ for some vertex $v$ in $T$ and none of the neighbours of $K$ is in the boundary,
    $\tau\in \Omega_S$ is a pinning on some subset $S \subset E$, and the number of 
    unpinned edges in $K$ is $k$. Then for any unpinned $e\in K$ and $c\in \+L^\tau(e)$,
    \[
    \mu^{\tau}_e(c) \ge \frac{(\beta-1)^2}{(\beta+k-2)(\beta+\Delta-2)}\frac{1}{\ell_e^\tau-k+1}.
    \]
    where $\ell^\tau_e\defeq|\+L^\tau(e)|$.
\end{lemma}
\begin{proof}\textcolor{red}{TOPROVE 21}\end{proof}

After introducing the concept of weighted edge coloring instances, we now turn our attention to the marginal distribution on a broom. For simplicity we run the matrix trickle down theorem on one broom $K$ in $T$,
that does not intersect with the boundaries
(actually on the quotient simplicial complex on $K$).
Then it is necessary to look at the marginal distribution of $\mu$
on $K$ under some pinning $\xi \in \Omega_F$ on a subset of edges $F$.
We have
\begin{align}\label{eq:broom-marginal-1}
\mu^\xi_K(\tau)
&\propto \sum_{\substack{\sigma:\sigma|_K=\tau \\ \sigma|_F=\xi}}
 \prod_{i\in [N]} w_i(\sigma|_{K_i}).
\end{align}

The following lemma demonstrates the relation between the weighted coloring instance and the tree recursion.
\begin{lemma}\label{lem:p=mu}
    Assume the tree $T$ with root $r$ is of depth $\ell+1$. Let the boundaries be all brooms on $\ell+1$-th level.
    For any $v\in B(r,\ell)$, the weight function on $E_{T_v}(v)$ is just $\*p_v$, and $\*p=(\*p_v)_{v\in B(r,\ell)}$. Choose $K=E(r)$. Then for the simplicial complex defined as above, we have  \[\*p_r\defeq  f^{\ell\rightarrow 0}(\*p)= \mu_K .\]
\end{lemma}
\begin{proof}\textcolor{red}{TOPROVE 22}\end{proof}

Suppose $K = \set{e_i}_{i\in [d]}$.
Then $T\setminus K$ is composed of $d$ disconnected subgraphs denoted by $T_i$
such that $T_i$ is adjacent to $K$ in $T$ (we define $T_i = \emptyset$
if $e_i$ is pendant).
Moreover, we define $\+K_i\defeq\set{K_j\mid K_j\subseteq T_i}$.
Since both $\set{T_i}$ and $\set{\+K_i}$ contain disjoint subgraphs and 
the $\sigma$ in the summation in \cref{eq:broom-marginal-1}
is determined by partial colorings $\sigma|_{T_i}$,
we can define $\+S^\xi_{i, c}\subseteq \Omega^\xi_{T_i}$ by the proper colorings 
on $T_i$ such that is compatible with $e_i$ being colored $c$.
\begin{align*}
\mu^\xi_K(\tau)
&\propto
  \sum_{\sigma_1\in \+S^\xi_{1, \tau(e_1)}}
  \sum_{\sigma_2\in \+S^\xi_{2, \tau(e_2)}}\dots
  \sum_{\sigma_N\in \+S^\xi_{N, \tau(e_N)}}
  \prod_{i\in [d]} \prod_{j : K_j\in \+K_i} w_j(\sigma_i|_{K_j})\\
&= \prod_{i\in [d]} \sum_{\sigma_i\in \+S^\xi_{i, \tau(e_i)}}
     \prod_{j : K_j\in \+K_i} w_j(\sigma_i|_{K_i}).
\end{align*}
Define 
\[
p^\xi_{e_i,c}=\sum_{\sigma_i\in \+S^\xi_{i, c}}
     \prod_{j : K_j\in \+K_i} w_j(\sigma_i|_{K_i}).
\]
Then we have $\mu^\xi_K(\tau)\propto\prod_{i\in [d]} p^\xi_{e_i,\tau(e_i)}$.
This proves the following lemma.
\begin{lemma}[Marginal distribution on a broom]
    Consider a list edge coloring instance $(T, \+L)$,
    boundaries $\set{K_i}_{i\in [N]}$
    weighted functions $\set{w_i}_{i\in [N]}$,
    and a pinning $\xi\in \Omega_{F}$ for some subset $F\subset E$.
    Then for a broom $K$ disjoint from boundaries
    there exists constants $p^\xi_{e, c}$ for $e\in K$, $c\in \+L^\xi(e)$ such that
    \[
    \mu^\xi_K(\tau)\propto\prod_{i\in [d]} p^\xi_{e_i,\tau(e_i)}.
    \]
\end{lemma}

Let $q^\xi_e=\sum_{c\in \+L^\xi(e)} p^\xi_{e,c}$
and $q^\xi_{e,f}=\sum_{c\in \+L^\xi(e)\cap \+L^\xi(f)} p^\xi_{e,c}p^\xi_{f,c}$.

Next we present some bounds on the quantities $p^\xi_{e, c}$ and $q^\xi_\cdot$
\begin{lemma}\label{lem:marginal-bound-weighted-1}
For any $e_i\in K, \xi\in \Omega_F$ for some subset $F \subset E$,
\[
\frac{p^\xi_{e_i,c}}{q^\xi_{e_i}}\le \frac{1}{\ell^\xi_{e_i}} .
\]
\end{lemma}
\begin{proof}\textcolor{red}{TOPROVE 23}\end{proof}
\begin{lemma}\label{lem:marginal-bound-weighted-2}
For $e,f\in K$ and $\xi\in \Omega_F$ for some subgraph $F$,
    \[
    q^\xi_{e,f}\leq \frac{q^\xi_e q^\xi_f}{\beta} .
    \]
\end{lemma}
\begin{proof}\textcolor{red}{TOPROVE 24}\end{proof}

\subsection{Simplicial complexes}
First we introduce simplicial complexes to encode the edge coloring instance. Given a universe $U$, a \emph{simplicial complex} $\+C\subseteq 2^U$ is a collection of subsets of $U$ that is downward close, which means that if $\sigma\in \+C$ and $\sigma'\subseteq\sigma$, then $\sigma'\in \+C$. Every element $\sigma\in \+C$ is called a \emph{face}, and a face that is not a proper subset of any other face is called a \emph{maximal face} or a \emph{facet}. The dimension of a face $\sigma$ is $\!{dim}(\sigma)\defeq \abs{\sigma}$, namely the size of $\sigma$. For every $k\ge 0$, let $\+C_k\defeq \set{\sigma\in\+C\cmid \abs{\sigma}=k}$ be the set of faces of dimension $k$. Specifically, $\+C_0=\set{\emptyset}$. The dimension of $\+C$ is the maximum dimension of faces in $\+C$. 

Besides, we say $\+C$ is a \emph{pure} $n$-dimensional simplicial complex if all maximal faces in $\+C$ are of dimension $n$. In this work we only deal with pure simplicial complexes. In a pure simplicial complexe, we define the co-dimension of a face $\sigma$ as $\!{codim}(\sigma)\defeq n-\!{dim}(\sigma)$.

Let $\pi_n$ be a distribution over the maximal faces $\+C_n$. We use the pair $(\+C,\pi_n)$ to denote a \emph{weighted simplicial complex} where for each $1\le k < n$, the distribution $\pi_n$ induces a distribution $\pi_k$ over $\+C_k$. Formally, for every $1\le k<n$ and every $\sigma'\in \+C_k$, $\pi_k(\sigma')$ is proportional to the sum of weights of maximal faces containing $\sigma$. Formally,
\begin{align*}
    \pi_k(\sigma') \defeq \frac{1}{\binom n k}\sum_{\sigma\in \+C_n\cmid\sigma' \subset \sigma} \pi_{n}(\sigma).
\end{align*}
It can be easily verified that $\pi_k$ is a distribution on $\+C_k$. Sometimes, we omit the subscript when $k=1$, i.e., we write $\pi$ for $\pi_1$.

Also we define the simplicial complexes generated by pinning a face in $\+C$. For a face $\tau \in \+C$ of dimension $k$, we define its \emph{link} as
\begin{align*}
    \+C_\tau=\set{\sigma\setminus \tau \cmid \sigma \in \+C \land \tau \subseteq \sigma }.
\end{align*}
Obviously, $\+C_\tau$ is a pure $(n-k)$-dimensional simplicial complex. Similarly, for every $1\le j \le n-k$, $\+C_{\tau,j}$ is the set of faces in $\+C_\tau$ of dimension $j$. We also use $\pi_{\tau,j}$ to denote the \emph{marginal distribution} on $\+C_{\tau,j}$. Formally, for every $\sigma\in \+C_{\tau,j}$,
\begin{align*}
    \pi_{\tau,j}(\sigma)\defeq \Pr[\alpha \sim \pi_{k+j}]{\alpha=\tau \cup \sigma \cmid \tau\subseteq \alpha}=\frac{\pi_{k+j}(\tau \cup \sigma)}{\binom{k+j}{k} \cdot \pi_{k}(\tau)}.
\end{align*}
We also drop the subscript when $j=1$, i.e., we write $\pi_\tau$ for $\pi_{\tau,1}$. We define a random walk $P_\tau$ with stationary distribution $\pi_\tau$ as
\[
P_\tau(x,y)=\frac{\pi_{\tau,2}(\set{x,y})}{2\pi_\tau(x)}.
\]




\subsection{Matrix trickle down on a broom}

Now we define the corresponding simplicial complex to the weighted edge coloring instance defined in \Cref{sec:weight-edge-coloring}.
Recall that we are dealing with a weighted edge coloring instance on a tree $T=(V, E)$
with $\beta$-extra color lists $\+L$. $K = E_i$ for some $i\in V$ and $|K| = d$.
We are going to show that the distribution of weighted colorings on $K$ can be
represented by a weighted simplicial complex.

Since any proper edge coloring  $\sigma:E\rightarrow [q]$ could be regarded as a set of pairs of edge and color, namely $\set{(e,c)\in E\times [q]\cmid \sigma(e)=c}$, the weighted edge-coloring instance restricted on $K$ can be naturally represented as a pure weighted simplicial complex $(\+C,\pi_{d})$ where $\+C$ consists of all proper partial colorings in $(K,\+L|_K)$ and $\pi_{d}=\mu_K$.

Before introducing the matrix trickle-down theorem, we define notations for matrices related to $\pi_\tau$. Define $\Pi_\tau \in \bb R^{\+C_1\times\+C_1}$ as $\Pi_\tau \defeq \operatorname{diag}(\pi_\tau)$ supported on $\+C_{\tau,1}\times \+C_{\tau,1}$,
and $\pi_\tau\defeq[\pi_\tau(x)]_{x\in \+C_1}$ be a vector supported on $C_{\tau, 1}$

For convenience, define the pseudo inverse $\Pi_\tau^{-1} \in \bb R^{\+C_1\times\+C_1}$ of $\Pi_\tau$ as $\Pi_\tau^{-1}(x,x)=\pi_\tau(x)^{-1}$ for $x\in \+C_{\tau,1}$ and $0$ otherwise. Similarly, the pseudo inverse square root $\Pi_\tau^{-1/2} \in \bb R^{\+C_1\times\+C_1}$is defined as $\Pi_\tau^{-1/2}(x,x)=\pi_\tau(x)^{-1/2}$ for $x\in \+C_{\tau,1}$ and $0$ otherwise. When $\tau=\emptyset$, we omit the subscript.

Recalling \Cref{def:covariance} and \Cref{def:diag_mean}, 
the following lemma relates the covariance of $\mu_K$ and the matrices defined in this section.
\begin{proposition}\label{lem:mtd-to-si}
    \[
    \Pi(\mu_K)=d\Pi
    \]
    and
    \[
    \!{Cov}(\mu_K) =d \tp{(d-1) \tp{\Pi P -\frac{d}{d-1}\pi \pi^\top} + \Pi}
    \]
    in the sense of padding with zeros.
\end{proposition}
The proof is by direct calculation.
We apply the matrix trickle-down theorem on $(\+C,\pi_d)$ to prove the following lemma. The main idea of the proof is almost the same as that in \cite{WZZ24} except for substituting the number of feasible colors to the weights of feasible colors w.r.t $\set{p_{e,c}}$ after pinning. And the construction of matrix upper bound is simpler since the line graph of $K$ is a clique. We include the details in \Cref{appendix-mtd}.
\begin{lemma}\label{lem:PiP-bound}
    If $K$ is not adjacent to boundaries, i.e. $\set{K_i}$ and $\beta \geq \Delta + 50$, then the simplicial complex $(\+C,\pi_d)$ defined as above satisfying
    \[
    \Pi P -\frac{d}{d-1}\pi \pi^\top \mle \frac{\eta_{\Delta}}{d-1} \Pi ,
    \]
    where $\eta_{\Delta}$ is $\+O\tp{\frac{\log^2 \Delta}{\Delta}}$.
\end{lemma}
Then \Cref{lem:SI-broom} is derived directly from \Cref{lem:PiP-bound} and \Cref{lem:mtd-to-si}.
 \section{Tight bound for weak spatial mixing}\label{sec:wsm}
In this section, we prove the tight bound for weak spatial mixing  of $q$-edge coloring instance on trees.
Note that the strong spatial mixing of $q$-edge coloring instance is a special case of spatial mixing of list instance (for list coloring instance, weak spatial mixing is equivalent to strong spatial mixing).
Therefore the theorem stated in this section is a weak version of spatial mixing conclusions and thus we can give a tight bound for trees. 

The main theorem for weak spatial mixing on trees is as follows.
\begin{theorem}\label{thm:tight_WSM}
    Given a tree $T = (V,E)$ with $n$ vertices, $m$ edges and maximum degree $\Delta$.
    Suppose that instance $(T,\+L)$ is a $q$-edge coloring instance (i.e. for any $e\in E$, $\+L(e) = [q]$). 
    Then we have that
    \begin{enumerate}
        \item If $q \geq 2\Delta - 1$, the edge coloring instance satisfies weak spatial mixing with rate $1 - \frac{1 - \eps}{2\Delta - (1+\eps)}$, where $\eps = \max\{\frac{\Delta - 1}{\Delta}, \frac {e - 1}e\}$.
        \item If $q \leq 2\Delta - 2$, there exists an instance that does not satisfy weak spatial mixing.
    \end{enumerate}
\end{theorem}
Consider the following example which simply shows that hardness of weak spatial mixing:
\begin{example}\label{eg:hardness_WSM}
    Consider a $(\Delta - 1)$-regular tree with depth $d$ (the depth of the root $r$ is $0$) and $d$ is an even number. Let $\Lambda$ be the edges between vertices of depth $d$ and $d-1$. Let $\tau_1$ be the pinning over $\Lambda$ which only uses $1,2,\dots,\Delta-1$ and $\tau_2$ be the pinning over $\Lambda$ which only uses $\Delta,\dots,2\Delta - 2$. It is easy to verify that for any $\{u,v\}\in E\setminus \Lambda$ and $\-{dep}(u) = \-{dep}(v) + 1$,
    $$
        \forall \sigma \in \Omega^{\tau_1}, , \sigma(\{u,v\}) \in 
        \begin{cases}
            \{1,\dots,\Delta-1\} &, 2\ |\ \-{dep}(u)
            \\\{\Delta,\dots,2\Delta-2\} &, 2 \nmid \-{dep}(u)
        \end{cases}
    $$
    $$
        \forall \sigma \in \Omega^{\tau_2}, \sigma(\{u,v\}) \in 
        \begin{cases}
            \{\Delta,\dots,2\Delta-2\} &, 2\ |\ \-{dep}(u)
            \\\{1,\dots,\Delta-1\} &, 2 \nmid \-{dep}(u)
        \end{cases}
    $$
    where $\-{dep}(u)$ is the depth of $u$. Therefore, for any $e\in E\setminus \Lambda$, we have that
    $$
        \|\mu_e^\sigma - \mu_e^\tau\|_{\-{TV}} = 1
    $$
    which demonstrates that the weak spatial mixing does not hold.
\end{example}
The proof scheme is also using the idea of correlation decay and we use the uniform distribution as bridge to prove the weak spatial mixing property. And we use another recursion which is different from that in strong spatial mixing.
Instead of considering a broom of edges, we specify the marginal probability of a pendant edge and then generalize to every edge.
Since the lists of feasible colors are clear, we use $\Pr[T]{\cdot}$ to denote $\Pr[T,\+L]{\cdot}$ for simplicity.
\begin{lemma}[One-step contraction]\label{lem:WSM_contraction}
Suppose $(T = (V,E), \+L)$ is a $q$-edge coloring instance, where $T$ is a tree with a pendant edge $e = \{r',r\}$ on its root $r$ (that is, $\deg(r')=1$) and $\tau$ is the pinning over a set of edges $\Lambda$ whose edges are incident to leaf vertices.  
If for any $e_i = \{v_i,r\}\in E$, the subtree $T_i$ with pendant edge $e_i$ satisfies that 
$$
    \forall c\in[q], \abs{\Pr[T_i\cup \{e_i\}]{c(e_i) = c\mid c(\Lambda) = \tau} - \frac 1q} \leq \delta
$$
where $\delta < \frac 1q$ is a universal constant, then we have that
$$
    \forall c\in [q], \abs{\Pr[T]{c(e) = c\mid c(\Lambda) = \tau} - \frac 1q} \leq \frac{2\Delta - 2}{q(1 - \delta\abs{q-2\Delta + 2})} \delta.
$$
\end{lemma}
\begin{proof}\textcolor{red}{TOPROVE 25}\end{proof}
\Cref{lem:marginal-bound-gkm} shows that the $q$-edge coloring instance admits the marginal lower bound, which is a start point of recursive contraction.
Now we can prove \Cref{thm:tight_WSM}.
\begin{proof}\textcolor{red}{TOPROVE 26}\end{proof}

 
\bibliographystyle{alpha}
\bibliography{edge_coloring}

\appendix

\section{Proofs for matrix trickle-down process}
\label{appendix-mtd}
In this section, we use the language of simplicial complexes as in \Cref{sec:covariance}.
That is, for a weighted edge coloring instance on a tree $T$ with $\beta$-extra
color losts $\+L$ and distribution $\mu$, we consider the colorings on a broom $K$ 
as a weighted simplicial complex $(\+C, \pi_{|K|})$ such that $\pi_{|K|} = \mu_K$.

Throughout this section, we consider $K$ as an edge set.
For a pinning $\tau\in \+C_{i}$ with $0\le i\le|K|-2$, we define
$K_\tau = \set{e\in K\mid e\notin \tau}$ and $\!{col}(\tau)=\set{c \mid \exists e\in K, \tau(e)=c}$. Let $\!{Id}_\tau \in \bb{R}^{\+C_1\times \+C_1}$ be the identity matrix restricted on $\+C_{\tau,1}$. Define 
$\!{Adj}_\tau \in \bb{R}^{\+C_1\times \+C_1}$ such that $\!{Adj}_\tau(ec,fc)=1$ if $ec,fc\in \+C_{\tau,1}$ and all other entries are $0$.
\subsection{Matrix trickle-down theorem}
The following proposition is the main tool we use in this section.
\begin{proposition}[Theorem 1.3 in \cite{ALOG21}]
	\label{thm:mtd-inductive}
	Given a pure $d$-dimensional weighted simplicial complex $(\+C,\pi_d)$, if there exists a family of matrices $\set{M_\tau\in\bb R^{\+C_1\times \+C_1}}$ satisfying
	\begin{itemize}
		\item For every $\tau\in\+C_{d-2}$, 
		\[
			\Pi_\tau P_\tau -2 \pi_\tau \pi_\tau^\top \mle M_\tau \mle \frac{1}{5}\Pi_\tau;
		\]
		\item For every face $\tau\in \+C_{d-k}$ with $k\geq 3$, one of the following two conditions hold:
		\begin{enumerate}
			\item 
			\[
				M_\tau \mle \frac{k-1}{3k-1}\Pi_\tau\quad\mbox{ and }\quad\E[x\sim\pi_\tau]{M_{\tau\cup\set{x}}}\mle M_\tau -\frac{k-1}{k-2}M_\tau\Pi^{-1}_\tau M_\tau .
			\]
			\item $(\+C_\tau,\pi_{\tau,k})$ is the product of $M$ pure weighted simplicial complexes $(\+C^{(1)},\pi^{(1)}), \dots (\+C^{(M)},\pi^{(M)})$ of dimension $n_1,\dots,n_M$ respectively and
			\[
				M_\tau = \sum_{i\in [M]\colon n_i\ge 2} \frac{n_i(n_i-1)}{k(k-1)}\cdot M_{\tau\cup \eta_{-i}}
			\]
			where $\eta_{-i} = \eta\setminus \+C^{(i)}_1$ for an arbitrary $\eta\in \+C_{\tau,k}$.
			\end{enumerate}
	\end{itemize}
	Then for every face $\tau\in\+C_{d-k}$ with $k\geq 2$, it holds that
	\[
		\Pi_\tau P_\tau -\frac{k}{k-1}\pi_\tau \pi_\tau^\top \mle M_\tau \mle \frac{k-1}{3k-1}\Pi_\tau.
	\]
	In particular, $\lambda_2(P_\tau)\le \lambda_1(\Pi_\tau^{-1}M_\tau)$.
\end{proposition}

\subsection{Base case}\label{sec:base-case}
\newcommand{\revp}{\tilde{\*p}}
We do matrix trickle down on $\mu_K(\tau)$.
Consider the base case: Assume the free edges in $K$ are $e,f$ and other edges are pinned with assignment $\tau$. 
Let $\*p_{ef}=(p_{e,c},p_{f,c})_{c\in \+L^\tau(e)\cup \+L^\tau(f)}$ and $\*p_{fe}=(p_{f,c},p_{e,c})_{c\in \+L^\tau(e)\cup \+L^\tau(f)}$. We omit the superscript $\tau$ in $q_e^\tau$ and $q_{e,f}^\tau$ in base case part since it is clear in the context.
Moreover, let $\revp_e=(0, p_{e, c})_{c\in \+L^\tau(e)\cup \+L^\tau(f)}, \revp_f = (p_{f, c}, 0)_{c\in \+L^\tau(e)\cup \+L^\tau(f)}$,
and define $\bb 1_e, \bb 1_f\in \bb R^{\+C_\tau, 1}$ such that $\bb 1_e(i, c) = \1{i=e},\bb 1_f(i, c) = \1{i=f}$.
Finally, we define $\*1_{ef}\in \bb R^{\+C_{\tau, 1}\times \+C_{\tau, 1}}$ such that $\*1_{ef}((i, c_1), (j, c_2) = \1{c_1=c_2\wedge i\neq j}$.
\begin{align*}
    &\phantom{{}={}}\Pi_\tau P_\tau- 2\pi_\tau\pi_\tau^\top 
    \\
    &= \frac{1}{2(q_eq_f-q_{e,f})^2}\-{diag}(\*p_{ef})\tp{(q_eq_f-q_{e,f})(\bb{1}_e\bb{1}_f^\top + \bb{1}_f\bb{1}_e^\top-\*1_{ef})-\frac{(q_e\bb{1}_f+q_f\bb{1}_e)(q_e\bb{1}_f+q_f\bb{1}_e)^\top}{2}+\*p_{fe}\*p_{fe}^\top} \-{diag}(\*p_{ef})\\
    &\mle \frac{1}{2(q_eq_f-q_{e,f})^2}\-{diag}(\*p_{ef})\tp{\*p_{fe}\*p_{fe}^\top-(q_eq_f-q_{e,f})\*1_{ef})} \-{diag}(\*p_{ef})\\
    &\mle \frac{1}{2(q_eq_f-q_{e,f})^2}\-{diag}(\*p_{ef})\tp{2(\revp_{e}\revp_{e}^\top+\revp_{f}\revp_{f}^\top)-(q_eq_f-q_{e,f})\*1_{ef})} \-{diag}(\*p_{ef}) .
\end{align*}
We do a row summation to bound the first term. Firstly,
\begin{align*}
    \revp_{e}\revp_{e}^\top+\revp_{f}\revp_{f}^\top \mle q_e\-{diag}(\revp_e) + q_f\-{diag}(\revp_f).
\end{align*}
Then,
\begin{align*}
    \frac{1}{(q_eq_f-q_{e,f})^2}\-{diag}(\*p_{ef})(\revp_{e}\revp_{e}^\top+\revp_{f}\revp_{f}^\top)\-{diag}(\*p_{ef})
    \mle \frac{1}{(q_eq_f-q_{e,f})^2}\-{diag}(\*p_{ef})(q_e\-{diag}(\revp_e) + q_f\-{diag}(\revp_f))\-{diag}(\*p_{ef}),
\end{align*}
which is a diagonal matrix.
On the entry $(ec, ec)$, it equals
\begin{align*}
    \frac{q_fp_{ec}}{(q_eq_f-q_{e,f})^2}p_{fc}p_{ec}
   &=       \frac{2q_fq_e}{q_fq_e}
      \cdot \frac{p_{ec}}{q_e}
      \cdot \frac{q_fq_e}{q_fq_e-q_{fe}}
      \cdot \frac{(q_f-p_{fc})p_{ec}}{2(q_fq_e-q_{fe})}
      \cdot \frac{p_{fc}}{q_f-p_{fc}}
    \\&\le
            2
      \cdot \frac1\beta
      \cdot \frac{\beta}{\beta-1}
      \cdot \pi_\tau(ec)
      \cdot \frac{1}{\beta-1}
      & \text{\big(\Cref{lem:marginal-bound-weighted-1,lem:marginal-bound-weighted-2}\big)}
    \\&=\frac{2}{(\beta-1)^2}\pi_\tau(ec).
\end{align*}
Applying the same argument to $(fc, fc)$, we have
\begin{align*}
    \Pi_\tau P_\tau- 2\pi_\tau\pi_\tau^\top 
    \mle
    -\frac{1}{2(q_eq_f-q_{e,f})^2}\-{diag}(\*p_{ef})\tp{(q_eq_f-q_{e,f})\*1_{ef})} \-{diag}(\*p_{ef})
    +
    \frac{2}{(\beta-1)^2}\Pi_\tau.
\end{align*}
Let $M_\tau$ be a block diagonal matrix with blocks $M_\tau^c$:
\begin{equation}\label{eqn:base-case-def-ol}
    M_\tau^c=\frac{p_{e,c}p_{f,c}}{2(q_e q_f-q_{e,f})}\tp{\begin{matrix}
    0 & -1\\
    -1 & 0
\end{matrix}}
+
\frac{2}{(\beta-1)^2}\Pi^c_\tau.
\end{equation}
Then we have the base case inequality
\begin{align*}
    \Pi_\tau P_\tau- 2\pi_\tau\pi_\tau^\top \mle \-{diag}(M_\tau^c).
\end{align*}

\subsection{Induction}
The induction step in \Cref{thm:mtd-inductive} is to show that for every $\tau$ with $\!{codim}(\tau) = k>2$ and connected $G_\tau$,
\begin{equation}\label{eqn:induction-main}
	\E[x\sim\pi_\tau]{M_{\tau\cup \set{x}}}\mle M_\tau - \frac{k-1}{k-2}M_\tau \Pi_\tau^{-1} M_\tau.
\end{equation}
For every $\tau$ and $c\in [q]$, we will define a matrix $M_\tau^c \in \bb R^{K^c\times K^c}$ and let $M_\tau$ be the block diagonal matrix with block $M_\tau^c$ for every $c\in [q]$. 
It is not hard to see that we only require 
\begin{equation}\label{eqn:induction-main-c}
	\E[x\sim\pi_\tau]{M_{\tau\cup \set{x}}^c}\mle M_\tau^c - \frac{k-1}{k-2}M_\tau^c (\Pi_\tau^c)^{-1} M_\tau^c
\end{equation}
to hold for every $c$ and $\tau$, where $(\Pi_\tau^c)^{-1}$ is $\Pi_\tau^{-1}$ restricted on $K^c\times K^c$.
We now describe our construction of $M^c_\tau$ for a fixed color $c$.
We write $M_\tau^c$ into the sum of a diagonal matrix and an off-diagonal matrix, i.e.,
\begin{equation}\label{eqn:N-decompose}
	M_\tau^c = \frac{1}{k-1}(A_\tau^c+\Pi_\tau^c B_\tau^c),
\end{equation}
where $A_\tau^c$ is an off-diagonal matrix and $B_\tau^c$ is a diagonal matrix.

From now on, when $c$ is clear from the context, we will omit the superscript $c$ for matrices.
For example, we will write $M_\tau$, $\Pi_\tau$, $\!{Adj}_\tau$, $\!{Id}_\tau$, $A_\tau$, $B_\tau$, $\dots$ instead of
                           $M^c_\tau$, $\Pi^c_\tau$, $\!{Adj}_\tau^{c}$, $\!{Id}_\tau^{c}$, $A_\tau^c$, $B_\tau^c$, $\dots$ respectively.
Plugging the above construction of $M_\tau$ into \eqref{eqn:induction-main-c} and remembering that the superscript $c$ has been omitted, we obtain
 \[
 (k-1)\cdot\E[x\sim\pi_\tau]{A_{\tau\cup\set{x}}+\Pi_{\tau\cup\set{x}}B_{\tau\cup\set{x}}} \mle (k-2)\cdot\tp{A_\tau+\Pi_\tau B_\tau} -\tp{A_\tau+\Pi_\tau B_\tau}\Pi_\tau^{-1}\tp{A_\tau+\Pi_\tau B_\tau}.
 \]
Here we need the following inequality of matrices.
\begin{lemma}[Corollary 12 in \cite{WZZ24}]
	\label{lem:matrix-squared-sum}
Let $A_1,\dots,A_n$ be a collection of symmetric matrices and $\Pi\mge 0$. Then
\[
	\tp{\sum_{i=1}^n A_i}\Pi \tp{\sum_{i=1}^n A_i} \mle n\sum_{i=1}^n A_i\Pi A_i.
\]	
\end{lemma}
 It follows from \Cref{lem:matrix-squared-sum} that
 \[
 \tp{A_\tau+\Pi_\tau B_\tau}\Pi_\tau^{-1}\tp{A_\tau+\Pi_\tau B_\tau}\mle 2A_\tau\Pi_\tau^{-1}A_\tau + 2\Pi_\tau B_\tau^2.
 \]
 As a result, in order for \eqref{eqn:induction-main} to hold, we only need to design $A_\tau$ and $B_\tau$  satisfying
\begin{equation}\label{eqn:condition-main}
 	(k-1)\cdot \E[x\sim\pi_\tau]{A_{\tau\cup\set{x}}} - (k-2) \cdot A_\tau+2A_\tau \Pi_\tau^{-1} A_\tau  \mle (k-2)\Pi_\tau B_\tau -(k-1)\cdot \E[x\sim\pi_\tau]{\Pi_{\tau\cup\set{x}} B_{\tau\cup\set{x}}}-2\Pi_\tau\tp{B_\tau}^2.
\end{equation}

\subsection{Construction of $A_\tau^i$}\label{sss:Atau}
We define
\begin{equation}\label{eqn:A-def}
	A_\tau = a_{k}\cdot (k-1)\cdot \E[\sigma\sim \pi_{\tau, k-2}]{A_{\tau\cup\sigma}}.
\end{equation}
Then we can deduce the following relation between $A_\tau$'s whose co-dimensions differ by one.
\begin{lemma}
	\[
		\E[x\sim \pi_\tau]{A_{\tau\cup\set{x}}} = \frac{k-2}{k-1}\cdot \frac{a_{k-1}}{a_{k}} A_\tau(ec, fc).
	\]
	where $h = h_\tau \geq 1$.
\end{lemma}
\begin{proof}\textcolor{red}{TOPROVE 27}\end{proof}

It follows from the definition that $A_\tau$ is proportional to the expectation of the base cases when the boundary is drawn from $\pi_{\tau,k-2}$. For some technical reasons, we would like to isolate those boundaries containing the color $c$. This leads us to the following lemma.

\begin{lemma}~\label{lem:A-tau-i}
    \newcommand{\taur}{\tau\cup\omega|_{K_\tau\setminus\set{e, f}}}
	\[
		A_\tau = \frac{2a_k}{k}\sum_{\substack{\omega\in \+C_{\tau,k}\\ c\notin\!{col}(\omega)}}\pi_{\tau,k}(\omega)A^{i,\omega}_\tau,
	\]
	where $A^{i,\omega}_\tau$ is the matrix supported on $K_\tau^c\times K_\tau^c$ such that
	\[
		A_\tau^{\omega}(uc,vc) = -\frac{p^{\taur}_{e, c}p^{\taur}_{f, c}}{\ol q^{\taur}_{e}\ol q^{\taur}_{f} - \ol q^{\taur}_{ef}}, 
	\]
	and $\ol q^{\cdot}_{e}\defeq q^\cdot_{e} - p^\cdot_{ec}$,
    $\ol q^{\cdot}_{f}\defeq q^\cdot_{f} - p^\cdot_{fc}$, and
    $\ol q^{\cdot}_{ef}\defeq q^\cdot_{ef} - p^\cdot_{ec}p^\cdot_{fc}$.
\end{lemma}

\begin{proof}\textcolor{red}{TOPROVE 28}\end{proof}

\subsection{Spectral analysis of $A_\tau$}



For every $\omega\in\+C_{\tau,k}$ such that $c\not\in \!{col}((\omega\cup\tau)|_{K_\tau})$,
define $\Xi_\tau^{\omega} \in \bb R^{K^c\times K^c}$ as the diagonal matrix such that for every $ec \in K_\tau^{c}$:
\[
	\Xi_\tau^{\omega}(ec,ec) =
    \frac{p^{\tau\cup\omega|_{K\setminus \set e}}_{ec}}
         {\ol q^{\tau\cup\omega|_{K\setminus \set e}}_e}.
\]
\begin{lemma}\label{lem:A-tau-i-omega}
	\[
	A_\tau^{\omega} = \Xi_\tau^{\omega} (-\!{Adj}_\tau + \+R_\tau^{\omega}) \Xi_{\tau}^{\omega} ,
	\]
	where $\rho(\+R_\tau^{i,\omega}) \le  \frac{2(k-1)}{\beta - 1}$.
\end{lemma}
\begin{proof}\textcolor{red}{TOPROVE 29}\end{proof}

\begin{proposition}\label{prop:matrix-sq-coeff}
    Consider non-zero coefficients $\lambda_i$, $i\in [N]$, matrix $A = \sum_{i\in [N]}\lambda_i A_i$ and 
    $\Sigma\mle 0$, and all matrices are square, of the same size and symemtric. Then
    \[
    A\Sigma A \mle
    \big(\sum_{i\in [N]} \lambda_i\big)
    \bigg( \sum_{i\in [N]}\lambda_i A_i\Sigma A_i \bigg).
    \]
\end{proposition}
\begin{proof}\textcolor{red}{TOPROVE 30}\end{proof}

Define $C_\tau\defeq \sum_{\substack{\omega\in \+C_\tau} \\ c\notin \omega}\pi_\tau(\omega)$,
and $\+C'_{\tau, k}\defeq \set{\omega\in \+C_{\tau, k} \mid c\notin\omega}$,
then the following lemma holds.
\begin{lemma}\label{lem:bound-A-tau-i}
 $A_\tau\Pi_\tau^{-1}A_\tau
 \mle
 \frac{4a_k^2C_\tau}{k^2} \sum_{\omega\in\+C'_{\tau, k}} \pi_\tau(\omega) A_\tau^{\omega}\Pi^{-1}_\tau A_\tau^{\omega}
 \mle
 \frac{4a_k^2}{k^2} \sum_{\omega\in\+C'_{\tau, k}} \pi_\tau(\omega) A_\tau^{\omega}\Pi^{-1}_\tau A_\tau^{\omega}$.
\end{lemma}
\begin{proof}\textcolor{red}{TOPROVE 31}\end{proof}

In the following discussion,
let $\gamma=\bigg( 1+ \frac{\Delta-1}{\beta-1} \bigg)^3\frac{1}{\beta-1}$.
\begin{lemma}\label{lem:bound-A-tau-i-omega-square}
	$ A_\tau^{\omega} \Pi_\tau^{-1} A_\tau^{\omega}
    \mle \gamma k\cdot \Xi_\tau^{\omega}\tp{\tp{\!{Adj}_\tau}^2
    +
    \frac{4(k-1)^2}{(\beta-1)^2}\!{Id}_\tau}\Xi_\tau^{i,\omega}$.
\end{lemma}
\begin{proof}\textcolor{red}{TOPROVE 32}\end{proof}

\begin{lemma}\label{lem:bound-Xi-Pi}
$ \frac{1}{k}\sum_{\omega\in \+C_{\tau, k}}\pi_{\tau, k}(\omega)\Xi^\omega_\tau\Pi^{-1}_\tau = \!{Id}_\tau$.
\end{lemma}
\begin{proof}\textcolor{red}{TOPROVE 33}\end{proof}

We are now ready to bound $\tp{(k-1)\cdot \E[x\sim\pi_\tau]{A_{\tau\cup\set{x}}} - (k-2) \cdot A_\tau+4A_\tau \Pi_\tau^{-1} A_\tau}$ in the LHS of \Cref{eqn:condition-main}.
\begin{lemma}
	\label{lem:bound-A-tau}
	There exists a sequence of non-negative numbers $\set{a_h}_{0\le h\le \Delta}$ such that
	\[
		\Pi_\tau^{-\frac{1}{2}} \tp{(k-1)\cdot \E[x\sim\pi_\tau]{A_{\tau\cup\set{x}}}
        - (k-2) \cdot A_\tau+2A_\tau \Pi_\tau^{-1} A_\tau}
        \Pi_\tau^{-\frac{1}{2}} \mle
        \frac{8\gamma(k-1)}{\beta-1}\Big(1 + \frac{\Delta}{\beta-1}\big(1+\frac{2}{\beta-1}\big)\Big).
	\]
\end{lemma}
\begin{proof}\textcolor{red}{TOPROVE 34}\end{proof}

\subsection{Construction of $B_\tau$}
\label{sss:Btau}
For $\tau$ of co-dimension $k > 2$,
we introduce coefficients $\set{b_k}_{3 \leq h \leq \Delta}$
whose values will be determined later, and define $B_\tau$ as follows:
\begin{equation} \label{eqn:B-def}
	B_\tau(ec,ec) = b_{k}
\end{equation}
for any $e \in K_\tau$ and all other entries are $0$
When $k=2$, this is exactly the base case considered in \Cref{sec:base-case}.
According to~\eqref{eqn:base-case-def-ol}, we have $b_1=\frac1{\tp{\beta-1}^2}$.

Notice that if $\!{codim}(\tau) = k\ge 3$, then
\begin{align}
\E[x\sim\pi_\tau]{\Pi_{\tau\cup\set{x}} b_k}
=
\pi_\tau(ec)^{-1}\sum_{x\in \+C_\tau}{\pi_\tau(x)\pi_{\tau\cup \set{x}}(ec)} b_{k-1}
=
\sum_{x\in \+C_\tau}{\pi_{\tau\cup \set{ec}}(x) b_{k-1}} = b_{k-1}.
\label{eqn:contraint-B-entry}
\end{align}
where the second equality follows from the fact that $\pi_\tau(x)\pi_{\tau\cup \set{x}}(vc)=\pi_{\tau\cup\set{vc}}(x)\pi_\tau(vc)$. 

By the discussion in the last section and the above definition, now \cref{eqn:condition-main} 
becomes
\[
(k-2)b_k - (k-1)b_{k-1} - 2b_k^2 \ge 
    \frac{8\gamma(k-1)\Delta}{(\beta-1)^2}\Big(\frac{2}{\beta-1} + 1\Big)
\]
for all $3\le k \le \Delta$.

Assume $\beta \geq 11$. Since 
\begin{align}\label{eqn:A-tau-i-upper-bound}
\begin{split}
		\Pi_\tau^{-1/2}A_\tau\Pi_\tau^{-1/2}
		&=  \frac{2a_{k}}{k}\cdot \Pi_\tau^{-1/2} \sum_{\omega\in \+C'_{\tau,k}}\pi_\tau(\omega) A^{\omega}_\tau \Pi_\tau^{-1/2} \\
		&=  \frac{2a_{k}}{k}\cdot \Pi_\tau^{-1/2} \sum_{\omega\in \+C_{\tau,k}'}\pi_\tau(\omega) \Xi_\tau^{\omega}(-\!{Adj}_\tau +\+R_\tau^{\omega})\Xi_\tau^{\omega}\Pi_\tau^{-1/2}\\
		&\mle \frac{2a_{k}}{(\beta-1)}\tp{1+\frac{2(k-1)}{\beta-1}}\!{Id}_\tau\\
		&\mle \frac{1}{(\beta-1)}\frac{1+\frac{2(k-1)}{\beta-1}}{1+\frac{4(k-2) \tp{1+\frac{\Delta-1}{\beta-1}}^3} {\beta-1}}\!{Id}_\tau\\
        &\mle \frac{1}{\beta-1} \!{Id}_\tau\\
		&\mle \frac{1}{10}\!{Id}_\tau,
\end{split}
\end{align}
we have $M_\tau=\frac{\sum_i A_\tau + \Pi_\tau B_\tau}{k-1} \mle \frac{k-1}{3k-1}\Pi_\tau$ as long as $B_\tau \mle \tp{\frac{(k-1)^2}{3k-1}-\frac{1}{10}}\!{Id}_\tau$.
We strengthen this constraint to $B_\tau \mle \tp{\frac{1}{5}-\frac{1}{10}}\!{Id}_\tau=\frac{1}{10}\!{Id}_\tau$.

For brevity, we denote ${8\gamma\Delta}\Big(\frac{2}{\beta-1} + 1\Big)$ by $C(\Delta)$ in the following calculation. Therefore, our constraints for $\set{b_k}_{1\leq k\leq \Delta}$ are
\begin{equation}
	\label{eqn:constraint-B}\tag{$\blacktriangle$}
	\begin{cases}
		(k-2) b_k - (k-1)b_{k-2} \ge 2b_k^2+\frac{C(\Delta)(k-1)}{(\beta-1)^2},& 3\le k\le \Delta; \\
		b_k \le \frac1{10}, & 2\le k\le \Delta.
	\end{cases}
\end{equation}
It follows from Lemma 26 in~\cite{WZZ24} that there is a feasible solution of \cref{eqn:constraint-B}
as long as $\beta\ge c\sqrt\Delta\log^2\Delta + 2c$, where $c = \sqrt{20(1+2C(\Delta))}$. And the solution $b_k \leq \frac{1}{(\beta-1)^2}\tp{1+(6+16 C(\Delta))\Delta \log^2 \Delta}$.
Notice that if $\beta - 1\ge \max\set{\Delta, 10}$, then $C(\Delta)\le \frac{10}{\Delta-1}$,
and the solution exists if $\beta - 1\ge 20\log^2\Delta+2\sqrt{\frac{200}{\Delta-1}}$.

Putting all constraints to $\beta$ together, we have
\[\beta-1\ge \max\set{\Delta, 10, 20\log^2\Delta+2\sqrt{\frac{200}{\Delta-1}}},\]
which can be unified to a single bound that $\beta\ge \Delta + 50$.

\subsection{Proof of \Cref{lem:PiP-bound}}
\begin{proof}\textcolor{red}{TOPROVE 35}\end{proof}
 
\end{document}